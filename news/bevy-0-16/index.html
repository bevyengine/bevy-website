<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Bevy 0.16" property=og:title><meta content=website property=og:type><meta content=https://bevy.org//news/bevy-0-16/ property=og:url><meta content=https://bevy.org/assets/bevy_logo_fill.png property=og:image><meta content="Bevy is a refreshingly simple data-driven game engine built in Rust. It is free and open-source forever!" property=og:description><link rel="shortcut icon" href=/assets/favicon.png type=image/png><link href=/site.css rel=stylesheet><link href=/atom.xml rel=alternate type=application/atom+xml><title>Bevy 0.16</title><script defer src=/highlight-intrapage-link.js></script><body><div class=layout><input class=hidden id=mobile-menu-state type=checkbox><header class="layout__header header print:hidden" data-mobile-menu-state-container><div class=header__content><label class=main-menu-backdrop for=mobile-menu-state></label><label class="header__hamburger button-square button-square--header" for=mobile-menu-state><img alt="Three horizontal lines stacked on top of eachother" height=16 src=/assets/icon-hamburger.svg width=20></label><div class=header__left-block><a class=header__logo href=/> <picture class=logo><img alt="Bevy logo" class=logo height=130 src=/assets/bevy_logo_dark.svg width=520></picture> </a><div class=header__message>News</div></div><input checked class=hidden id=page-menu-switch-state type=checkbox><nav class="header__menu main-menu main-menu--with-page-menu" data-page-menu-switch-state-container role=navigation><div class=main-menu__header><a href=/> <picture class=logo><img alt="Bevy Engine" class=logo height=130 src=/assets/bevy_logo_dark.svg width=520></picture> </a><label class="button-square button-square--header" for=mobile-menu-state><img alt="A saltire or x-cross" height=16 src=/assets/icon-times.svg width=16></label></div><div class=main-menu__page-menu-switch><label class=menu-switch for=page-menu-switch-state><div class="menu-switch__option menu-switch__option--main-menu">Main Menu</div> <div class="menu-switch__option menu-switch__option--page-menu">Post</div></label></div><div class=main-menu__content><div class=main-menu__page-menu><ul class=tree-menu data-highlight-intrapage-link><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#gpu-driven-rendering>GPU-Driven Rendering</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#procedural-atmospheric-scattering>Procedural Atmospheric Scattering</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#decals>Decals</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#experimental-occlusion-culling>Experimental Occlusion Culling</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#anamorphic-bloom>Anamorphic Bloom</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#ecs-relationships>ECS Relationships</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#improved-spawn-api>Improved Spawn API</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#unified-ecs-error-handling>Unified ECS Error Handling</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#bevy-no-std-support>Bevy no_std Support</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#faster-transform-propagation>Faster Transform Propagation</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#specular-tints-and-maps>Specular Tints and Maps</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#experimental-wesl-shaders>Experimental WESL Shaders</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#virtual-geometry-improvements>Virtual Geometry Improvements</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#immutable-components>Immutable Components</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#entity-cloning>Entity Cloning</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#entity-disabling-default-query-filters>Entity Disabling / Default Query Filters</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#better-location-tracking>Better Location Tracking</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#text-shadows>Text Shadows</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#input-focus-improvements>Input Focus Improvements</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#retained-gizmos>Retained Gizmos</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#transparent-sprite-picking>Transparent Sprite Picking</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#reflection-function-overloading-generic-variadic-functions>Reflection: Function Overloading (Generic & Variadic Functions)</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#curve-derivatives>Curve Derivatives</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#assetchanged-query-filter>AssetChanged Query Filter</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#asset-processing-no-longer-auto-generates-meta-files>Asset Processing no longer auto-generates .meta files</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#mesh-tags>Mesh Tags</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#gpu-timestamps-in-traces>GPU Timestamps in Traces</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#trait-tags-on-docs-rs>Trait Tags on docs.rs</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#what-s-next>What's Next?</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#support-bevy>Support Bevy</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#contributors>Contributors</a></div></ul></div><ul class=main-menu__menu><li class="main-menu__entry main-menu__entry--getting-started"><a class=main-menu__link href=/learn/quick-start/getting-started/> <span>Getting Started</span> </a><li class=main-menu__entry><a class=main-menu__link href=/learn/> <span>Learn</span> </a><li class=main-menu__entry><a class="main-menu__link main-menu__link--active" href=/news/> <span>News</span> </a><li class=main-menu__entry><a class=main-menu__link href=/community/> <span>Community</span> </a><li class=main-menu__entry><a class=main-menu__link href=/foundation/> <span>Foundation</span> </a><li class=main-menu__entry><a class=main-menu__link href=/assets/> <span>Assets</span> </a><li class=main-menu__entry><a class=main-menu__link href=/examples/> <span>Examples</span> </a></ul></div></nav><div class=header__cta-container><a class="button button--pink header__cta" href=/donate>Donate <img alt="heart icon" class=button__icon height=512 src=/assets/heart.svg width=512> </a><a class="header__cta header__cta--github" href=https://github.com/bevyengine/bevy> <img alt="GitHub repo" height=96 src=/assets/github-mark-white.svg width=98> </a></div></div></header><main class=layout__content><div class=container><div class="page-with-menu page-with-menu--news"><div class="page-with-menu__menu-wrapper print:hidden"><div class=page-with-menu__menu><ul class=tree-menu data-highlight-intrapage-link><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#gpu-driven-rendering>GPU-Driven Rendering</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#procedural-atmospheric-scattering>Procedural Atmospheric Scattering</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#decals>Decals</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#experimental-occlusion-culling>Experimental Occlusion Culling</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#anamorphic-bloom>Anamorphic Bloom</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#ecs-relationships>ECS Relationships</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#improved-spawn-api>Improved Spawn API</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#unified-ecs-error-handling>Unified ECS Error Handling</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#bevy-no-std-support>Bevy no_std Support</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#faster-transform-propagation>Faster Transform Propagation</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#specular-tints-and-maps>Specular Tints and Maps</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#experimental-wesl-shaders>Experimental WESL Shaders</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#virtual-geometry-improvements>Virtual Geometry Improvements</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#immutable-components>Immutable Components</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#entity-cloning>Entity Cloning</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#entity-disabling-default-query-filters>Entity Disabling / Default Query Filters</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#better-location-tracking>Better Location Tracking</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#text-shadows>Text Shadows</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#input-focus-improvements>Input Focus Improvements</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#retained-gizmos>Retained Gizmos</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#transparent-sprite-picking>Transparent Sprite Picking</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#reflection-function-overloading-generic-variadic-functions>Reflection: Function Overloading (Generic & Variadic Functions)</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#curve-derivatives>Curve Derivatives</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#assetchanged-query-filter>AssetChanged Query Filter</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#asset-processing-no-longer-auto-generates-meta-files>Asset Processing no longer auto-generates .meta files</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#mesh-tags>Mesh Tags</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#gpu-timestamps-in-traces>GPU Timestamps in Traces</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#trait-tags-on-docs-rs>Trait Tags on docs.rs</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#what-s-next>What's Next?</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#support-bevy>Support Bevy</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=https://bevy.org/news/bevy-0-16/#contributors>Contributors</a></div></ul></div></div><div class=page-with-menu__content><h1 class=news-title>Bevy 0.16</h1><h2 class=news-subtitle>Posted on April 24, 2025 by Bevy Contributors</h2><div class="media-content news-content news-content__hero-image"><img alt="A planet from EmbersArc's in-development spaceflight simulation game, rendered with custom shaders in Bevy" style="aspect-ratio:auto 16/9" src=planet.jpg><div class=news-image-subtitle><a href=https://bsky.app/profile/embersarc.bsky.social>A planet from EmbersArc's in-development spaceflight simulation game, rendered with custom shaders in Bevy</a></div></div><div class="media-content news-content"><p>Thanks to <strong>261</strong> contributors, <strong>1244</strong> pull requests, community reviewers, and our <a href=/donate><strong>generous donors</strong></a>, we're happy to announce the <strong>Bevy 0.16</strong> release on <a href=https://crates.io/crates/bevy>crates.io</a>!<p>For those who don't know, Bevy is a refreshingly simple data-driven game engine built in Rust. You can check out our <a href=/learn/quick-start>Quick Start Guide</a> to try it today. It's free and open source forever! You can grab the full <a href=https://github.com/bevyengine/bevy>source code</a> on GitHub. Check out <a href=https://bevy.org/assets>Bevy Assets</a> for a collection of community-developed plugins, games, and learning resources.<p>To update an existing Bevy App or Plugin to <strong>Bevy 0.16</strong>, check out our <a href=/learn/migration-guides/0-15-to-0-16/>0.15 to 0.16 Migration Guide</a>.<p>Since our last release a few months ago we've added a <em>ton</em> of new features, bug fixes, and quality of life tweaks, but here are some of the highlights:<ul><li><strong>GPU-Driven Rendering:</strong> Bevy now does even more rendering work on the GPU (where possible), making Bevy dramatically faster on big, complex scenes.<li><strong>Procedural Atmospheric Scattering:</strong> Simulate realistic physically-based Earth-like sky at any time of day at a low performance cost.<li><strong>Decals</strong>: Dynamically layer textures onto rendered meshes.<li><strong>Occlusion Culling</strong>: Improve performance by not rendering objects that are obscured by other objects.<li><strong>ECS Relationships:</strong> One of the hottest ECS features is finally here: allowing you to easily and robustly model and work with entity-entity connections. Some caveats apply, but we're excited to get a simple and robust solution to users today.<li><strong>Improved Spawn API:</strong> Spawning entity hierarchies is now significantly easier!<li><strong>Unified Error Handling:</strong> Bevy now has first class error handling support, making it easy, flexible, and ergonomic, while also making debugging easier!<li><strong><code>no_std</code> Support:</strong> <code>bevy</code> itself and a ton of our subcrates no longer rely on Rust's standard library, letting you use the same engine on everything from a modern gaming rig to a Gameboy Advance.<li><strong>Faster Transform Propagation:</strong> We've dramatically improved the performance of transform propagation for more objects at once, especially if they are static.</ul><span id=continue-reading></span><h2 id=gpu-driven-rendering>GPU-Driven Rendering <a class=anchor-link href=#gpu-driven-rendering>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/pcwalton>@pcwalton</a>, <a class=heading-meta__item href=https://github.com/tychedelia>@tychedelia</a>, <a class=heading-meta__item href=https://github.com/robswain>@robswain</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16427>#16427</a></div></div><p>Over the years, the trend in real-time rendering has increasingly been to move work from the CPU to the GPU. One of the latest developments in this area has been <em>GPU-driven rendering</em>, in which the GPU takes a representation of the scene and essentially works out what to draw on its own.<p><strong>Bevy 0.16</strong> adds GPU-driven rendering support for most "standard" 3D mesh rendering, including skinned meshes. This dramatically reduces the amount of CPU time that the renderer needs for larger scenes. It's automatically enabled on platforms that support it; unless your application hooks into the rendering pipeline, upgrading to <strong>Bevy 0.16</strong> will automatically enable GPU-driven rendering for your meshes. This joins the support that <strong>Bevy 0.14</strong> and <strong>0.15</strong> added for GPU-driven rendering of <a href=/news/bevy-0-14/#virtual-geometry-experimental>Virtual Geometry</a>.<p>On Activision's "heavy" hotel section of the <a href=https://github.com/Activision/caldera>Caldera scene</a> from Call of Duty Warzone, <strong>Bevy 0.16</strong> with GPU-driven rendering performs roughly 3x better than <strong>Bevy 0.15</strong>! (this includes <em>all</em> optimizations between these releases)<p><img alt="Caldera scene rendered in Bevy" src=caldera.jpg><p>On a mobile Nvidia 4090 with Vulkan / Linux, <strong>Bevy 0.16</strong> runs the scene at 10.16ms (~101 FPS), compared to 33.55ms (~30 FPS) on <strong>Bevy 0.15</strong>. Massive wins!<h3 id=overview-cpu-driven-rendering>Overview: CPU-Driven Rendering</h3><p>To explain how GPU-driven rendering operates, it's easiest to first describe how CPU-driven rendering works:<ol><li>The CPU determines the objects that are visible, via frustum culling and perhaps occlusion culling.<li>For each such object: <ul><li>The CPU sends the object's transform to the GPU, possibly in addition to other data such as joint weights.<li>The CPU tells the GPU where the mesh data is.<li>The CPU writes the material data to the GPU.<li>The CPU tells the GPU where textures and other buffers needed to render the objects are (light data, etc.)<li>The CPU issues a drawcall.<li>The GPU renders the object.</ul></ol><h3 id=overview-gpu-driven-rendering>Overview: GPU-Driven Rendering</h3><p>In contrast, GPU-driven rendering in Bevy works like this:<ol><li>The CPU supplies a single buffer containing transform information for all objects to the GPU, so that shaders can process many objects at once.<li>If new objects have been spawned since the last frame, the CPU fills out tables specifying where the mesh data for the new objects are.<li>If materials have been modified since the last frame, the CPU uploads information about those materials to the GPU.<li>The CPU creates lists of objects to be rendered this frame. Each object is simply referenced by an integer ID, so these lists are small. The number of lists depends on the size and complexity of the scene, but there are rarely more than 15 such lists even for large scenes.<li>For each such list: <ul><li>The CPU issues a <em>single</em> drawcall.<li>The GPU processes all objects in the list, determining which ones are truly visible.<li>The GPU renders each such visible object.</ul></ol><p>For large scenes that may have tens of thousands of objects, GPU-driven rendering frequently results in a reduction in CPU rendering overhead of 3× or more. It's also necessary for occlusion culling, because of the GPU transform step (5(b) above).<h3 id=gpu-driven-rendering-techniques>GPU-Driven Rendering Techniques</h3><p>Internally, GPU-driven rendering is less a single technique than a combination of several techniques. These include:<ul><li><em>Multi-draw indirect</em> (MDI), a GPU API that allows multiple meshes to be drawn in a single drawcall, the details of which the GPU provides by filling out tables in GPU memory. In order to use MDI effectively, Bevy uses a new subsystem, the <em>mesh allocator</em>, which manages the details of packing meshes together in GPU memory. <ul><li><em>Multi-draw indirect count</em> (MDIC), an extension to multi-draw indirect that allows the GPU to determine the <em>number</em> of meshes to draw with minimal overhead.</ul><li><em>Bindless resources</em>, which allow Bevy to supply the textures (and other resources) for many objects as a group, instead of having to bind textures one-by-one on the CPU. These resources are managed by a new subsystem known as the <em>material allocator</em>.<li><em>GPU transform and cull</em>, which allows Bevy to compute the position and visibility of every object from the camera's perspective on the GPU instead of on the CPU.<li>The <em>retained render world</em>, which allows the CPU to avoid processing and uploading data that hasn't changed since the last frame.<li><em>Cached pipeline specialization</em>, which leverages Bevy's component-level change detection to more quickly determine when the rendering state for meshes is unchanged from the previous frame.</ul><h3 id=gpu-driven-platform-compatibility>GPU-Driven Platform Compatibility</h3><p>At the moment, not all platforms offer full support for this feature. The following table summarizes the platform support for the various parts of GPU-driven rendering:<table><thead><tr><th>OS<th>Graphics API<th>GPU transform<th>Multi-draw & GPU cull<th>Bindless resources<tbody><tr><td>Windows<td>Vulkan<td>✅<td>✅<td>✅<tr><td>Windows<td>Direct3D 12<td>✅<td>❌<td>❌<tr><td>Windows<td>OpenGL<td>✅<td>❌<td>❌<tr><td>Linux<td>Vulkan<td>✅<td>✅<td>✅<tr><td>Linux<td>OpenGL<td>✅<td>❌<td>❌<tr><td>macOS<td>Metal<td>✅<td>❌<td>➖¹<tr><td>iOS<td>Metal<td>✅<td>❌<td>➖¹<tr><td>Android<td>Vulkan<td>➖²<td>➖²<td>➖²<tr><td>Web<td>WebGPU<td>✅<td>❌<td>❌<tr><td>Web<td>WebGL 2<td>❌<td>❌<td>❌</table><p>¹ Bevy does support bindless resources on Metal, but the limits are currently significantly lower, potentially resulting in more drawcalls.<p>² Some Android drivers that are known to exhibit bugs in Bevy's workloads are denylisted and will cause Bevy to fall back to CPU-driven rendering.<p>In most cases, you don't need to do anything special in order for your application to support GPU-driven rendering. There are two main exceptions:<ol><li>Materials with custom WGSL shaders will continue to use CPU-driven rendering by default. In order for your materials to use GPU-driven rendering, you'll want to use the new <code>#[bindless]</code> feature on <code>AsBindGroup</code>. See the <code>AsBindGroup</code> documentation and the <code>shader_material_bindless</code> example for more details. If you're using <code>ExtendedMaterial</code>, check out the new <code>extended_material_bindless</code> example.<li>Applications and plugins that hook into the renderer at a low level will need to be updated to support GPU-driven rendering. The newly-updated <code>custom_phase_item</code> and <code>specialized_mesh_pipeline</code> examples may prove useful as a guide to do this.</ol><h3 id=what-s-next-for-gpu-driven-rendering>What's Next for GPU-Driven Rendering?</h3><p>Bevy's current GPU-driven rendering isn't the end of the story. There's a sizable amount of potential future work to be done:<ul><li><strong>Bevy 0.16</strong> only supports GPU-driven rendering for the 3D pipeline, but the techniques are equally applicable to the 2D pipeline. Future versions of Bevy should support GPU-driven rendering for 2D mesh rendering, sprites, UI, and so on.<li>Bevy currently draws objects with morph targets using CPU-driven rendering. This is something we plan to address in the future. Note that the presence of objects with morph targets doesn't prevent objects that don't have morph targets from being drawn with GPU-driven rendering.<li>In the future, a portion of the GPU-driven rendering infrastructure could be ported to platforms that don't support the full set of features, offering some performance improvements on those platforms. For example, even on WebGL 2 the renderer could make use of the material allocator to pack data more efficiently.<li>We're watching new API features, such as <a href=https://www.supergoodcode.com/device-generated-commands/>Vulkan device generated commands</a> and <a href=https://devblogs.microsoft.com/directx/d3d12-work-graphs/>Direct3D 12 work graphs</a>, with interest. These would allow future versions of Bevy to offload even more work to the GPU, such as sorting of transparent objects. While figuring out how to unify these disparate APIs in a single renderer will be a challenge, the future possibilities in this space are exciting.</ul><p>If you're interested in any of these tasks, feel free to ask <a href=https://discord.gg/bevy>in our Discord</a> or via <a href=https://github.com/bevyengine/bevy/issues>GitHub issues</a>.<h2 id=procedural-atmospheric-scattering>Procedural Atmospheric Scattering <a class=anchor-link href=#procedural-atmospheric-scattering>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/ecoskey>@ecoskey</a>, <a class=heading-meta__item href=https://github.com/mate-h>@mate-h</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16314>#16314</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17555>#17555</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17672>#17672</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18582>#18582</a></div></div><p><strong>Bevy 0.16</strong> introduces procedural atmospheric scattering, a customizable system for simulating sunsets, sunrises, and dynamic day/night cycles in real time:<p><video aria-label="A showcase of simulated sunrises and sunsets made in Bevy" controls loop><source src=atmosphere-showcase.mp4 type=video/mp4></video> Credit to <code>@aevyrie</code> for their amazing <a href=https://github.com/aevyrie/bevy/tree/atmosphere_showcase>atmosphere showcase</a>! It uses a fancy custom exposure curve to accentuate the near-dusk colors.<p>Enabling atmosphere rendering is simple, just add the new <a href=https://docs.rs/bevy/0.16/bevy/pbr/struct.Atmosphere.html><code>Atmosphere</code></a> component to your camera!<pre class="language-rs z-code" data-lang=rs><code class=language-rs data-lang=rs><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">Camera3d<span class="z-punctuation z-accessor z-rust">::</span></span>default<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">Atmosphere<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-constant z-other z-rust">EARTH</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> the atmosphere will consider all directional lights in the scene as "suns"
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">DirectionalLight<span class="z-punctuation z-accessor z-rust">::</span></span>default<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>When it is enabled, the primary Bevy skybox is overlaid with one that updates in real-time based on the directional lights in the scene, and the default distance fog is replaced with one that takes into account directional lights and the other atmosphere parameters. Distant objects will fade to blue on a clear day, and will be tinged orange and pink at sunset! Also, because the atmosphere is composited on <em>top</em> of the skybox, creating a nighttime starscape is easy ... just spawn the skybox and it'll naturally fade away as the sky grows brighter at dawn.<p>As with most PBR techniques, it's <em>correct</em>, but it can take some tweaking to look its best. All of the atmosphere parameters can also be customized: for example, a high desert sky might exhibit less Mie scattering due to the lack of humidity. The included example at <code>examples/3d/atmosphere.rs</code> includes some recommendations for lighting and camera settings.<p>There's some current limitations to be aware of: the atmosphere currently doesn't affect the <a href=https://docs.rs/bevy/0.16/bevy/pbr/environment_map/struct.EnvironmentMapLight.html><code>EnvironmentMapLight</code></a> or the direct lighting from directional lights on surfaces, so reflections might not be fully accurate. We're also working on integrating atmospheric scattering with volumetric fog (see the <a href=#what-s-next>What's Next?</a> section for our ambitious plans!).<p>Because of a number of optimizations described in Sébastien Hillaire's <a href=https://sebh.github.io/publications/egsr2020.pdf>EGSR 2020 paper</a>, our implementation is super fast, and should work great even on mobile devices and WebGPU. The secret sauce is that because the atmosphere is mostly symmetric, we can precalculate most of the ray marching inner loop ahead of time.<h2 id=decals>Decals <a class=anchor-link href=#decals>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/naasblod>@naasblod</a>, <a class=heading-meta__item href=https://github.com/JMS55>@JMS55</a>, <a class=heading-meta__item href=https://github.com/pcwalton>@pcwalton</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16600>#16600</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17315>#17315</a></div></div><p><strong>Decals</strong> are textures which can be dynamically layered on top of existing meshes, conforming to their geometry. This has two benefits over simply changing a mesh's texture:<ol><li>You can add them dynamically in response to player actions. Most famously, bullet holes in FPS games use decals for this.<li>You don't need to create an entirely new texture for every combination, which makes them more efficient and flexible when creating levels with details like graffiti or cracks in building facades.</ol><p>Like many things in rendering, there are a huge number of ways to implement this feature, each with their own tradeoffs. In <strong>Bevy 0.16</strong>, we've selected two complementary approaches: <strong>forward decals</strong> and <strong>clustered decals</strong>.<h3 id=forward-decals>Forward Decals</h3><p><img alt=decals src=decals.jpg><p>Our implementation of forward decals (or to be more precise, contact projective decals) was inspired by <a href="https://www.youtube.com/watch?v=TrHHTQqmAaM">Alexander Sannikovs talk on the rendering techniques of Path of Exile 2</a>, and was upstreamed from the <a href=https://github.com/naasblod/bevy_contact_projective_decals><code>bevy_contact_projective_decals</code></a> ecosystem crate. Due to the nature of this technique, looking at the decal from very steep angles will cause distortion. This can be mitigated by creating textures that are bigger than the effect, giving the decal more space to stretch. To create a forward decal, spawn a <a href=https://docs.rs/bevy/0.16/bevy/pbr/decal/struct.ForwardDecal.html><code>ForwardDecal</code></a> entity, which uses a <a href=https://docs.rs/bevy/0.16/bevy/pbr/decal/type.ForwardDecalMaterial.html><code>ForwardDecalMaterial</code></a> using the <a href=https://docs.rs/bevy/0.16/bevy/pbr/decal/struct.ForwardDecalMaterialExt.html><code>ForwardDecalMaterialExt</code></a> material extension.<h3 id=clustered-decals>Clustered Decals</h3><p><img alt="clustered decals" src=clustered-decals.jpg><p>Clustered decals (or decal projectors) work by projecting images from a 1x1x1 cube onto surfaces found in the +Z direction. They are clusterable objects, just like point lights and light probes, which means that decals are only evaluated for objects within the bounds of the projector. To create a clustered decal, spawn a <a href=https://docs.rs/bevy/0.16/bevy/pbr/decal/clustered/struct.ClusteredDecal.html><code>ClusteredDecal</code></a> entity.<p>Ultimately, forward decals offer broader hardware and driver support, while clustered decals are higher quality and don't require the creation of bounding geometry, improving performance. Currently clustered decals require bindless textures and thus don't support WebGL2, WebGPU, iOS and Mac targets. Forward decals <em>are</em> available on these targets.<h2 id=experimental-occlusion-culling>Experimental Occlusion Culling <a class=anchor-link href=#experimental-occlusion-culling>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/pcwalton>@pcwalton</a>, <a class=heading-meta__item href=https://github.com/JMS55>@JMS55</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/12755>#12755</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17413>#17413</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17934>#17934</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17951>#17951</a></div></div><p><strong>Occlusion culling</strong> is the idea that we don't need to draw something that's completely blocked by other opaque objects, from the perspective of the camera. For example: we don't need to draw a person hidden behind a wall, even if they're within the range used for frustum culling.<p>Bevy already has an optional <a href=/news/bevy-0-10/#depth-and-normal-prepass>Depth Prepass</a>, which renders a simple version of the scene and captures a 2D depth buffer. This can then be used to skip hidden objects in the more expensive main pass. However this doesn't skip the vertex shading overhead, and the depth checks in the fragment shader also add overhead.<p>In <strong>Bevy 0.16</strong>, we've added modern <a href=https://medium.com/@mil_kru/two-pass-occlusion-culling-4100edcad501>two-phase occlusion culling</a> (in contrast to a traditional "potentially visible sets" design). This approach was already used by our <a href=/news/bevy-0-14/#virtual-geometry-experimental>virtual geometry</a> rendering system, and works quite well with the GPU-driven rendering architecture that we've established during this cycle! For more details on our implementation, <a href=https://github.com/bevyengine/bevy/pull/17413>check out this PR</a>.<p>For now, this feature is marked as experimental, due to known precision issues that can mark meshes as occluded even when they're not. In practice, we're not convinced that this is a serious concern, so please let us know how it goes! To try out the new mesh occlusion culling, add the <a href=https://docs.rs/bevy/0.16/bevy/core_pipeline/prepass/struct.DepthPrepass.html><code>DepthPrepass</code></a> and <a href=https://docs.rs/bevy/0.16/bevy/render/experimental/occlusion_culling/struct.OcclusionCulling.html><code>OcclusionCulling</code></a> components to your camera.<p>An important note: occlusion culling won't be faster on all scenes. Small scenes, or those using simpler non-PBR rendering are particularly likely to be slower with occlusion culling turned on. Enabling occlusion culling incurs overhead ... the work that it skips must be more expensive than the cost of running the checks for it to be worth it!<p>Like always: you need to measure your performance to improve it.<p>If you're a rendering engineer who'd like to help us resolve these precision issues and stabilize this feature, we're looking to borrow from Hans-Kristian Arntzen's design in <a href=https://github.com/Themaister/Granite>Granite</a>. Chime in at <a href=https://github.com/bevyengine/bevy/issues/14062>issue #14062</a> (and read our <a href=https://bevy.org/learn/contribute/introduction/>Contributing Guide</a>) and we can help you get started.<h2 id=anamorphic-bloom>Anamorphic Bloom <a class=anchor-link href=#anamorphic-bloom>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/aevyrie>@aevyrie</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17096>#17096</a></div></div><p>Bloom is that soft glow bleeding out from bright areas of light: in the real world, this is caused by sensors on your camera (or eyes) becoming fully saturated. In games, it's a powerful artistic tool for creating everything from cyberpunk neon signs to tastefully glowing windows to juicy geometrically-inspired arcade games.<p>Bevy has had bloom since version 0.9, but we're giving artists another simple lever to tweak: the ability to stretch, squash and otherwise distort the effect by setting the 2-dimensional <code>scale</code> parameter on the <a href=https://docs.rs/bevy/0.16/bevy/core_pipeline/bloom/struct.Bloom.html><code>Bloom</code></a> component on your camera.<p><img alt="A realistic high-polygon model of a fancy black Porsche 911 demonstrating anamorphic bloom in its stretched-out tail light glow. Rendered in Bevy 0.16!" src=anamorphic-car-bloom.jpg><p>When heavily skewed (usually horizontally), this effect is known as <strong>anamorphic bloom</strong>. This effect is associated with a cinematic, futuristic vibe, and emulates the unusual geometry of certain film cameras as they compress a wider image onto narrower film. But, regardless of why it occurs, it simply looks neat!<h2 id=ecs-relationships>ECS Relationships <a class=anchor-link href=#ecs-relationships>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/cart>@cart</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17398>#17398</a></div></div><p>When building Bevy apps, it is often useful to "link" entities together. The most common case in Bevy is connecting parent and child entities together. In previous Bevy versions, a child would have a <code>Parent</code> component, which stored a reference to the parent entity, and the parent entity would have a <code>Children</code> component, which stored a list of all of its children entities. To ensure these connections remained valid, developers were not allowed to modify these components directly. Instead, all changes had to be done via specialized commands.<p>This worked, but it had some pretty glaring downsides:<ol><li>Maintaining hierarchies was "separate" from the core ECS data model. This made it hard to improve our spawn APIs, and made interacting with hierarchies less natural.<li>The system was specialized and not reusable. Developers wanting to define their own relationship types had to reinvent the wheel.<li>To ensure data integrity, expensive scans were required to avoid duplicates.</ol><p>In <strong>Bevy 0.16</strong> we have added initial support for <strong>relationships</strong>: a generalized and efficient component-driven system for linking entities together bidirectionally. This is what defining a new <a href=https://docs.rs/bevy/0.16/bevy/ecs/relationship/trait.Relationship.html><code>Relationship</code></a> looks like:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> This is a "relationship" component.
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Add it to an entity that "likes" another entity.
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">relationship</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">relationship_target <span class="z-keyword z-operator z-rust">=</span> LikedBy</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Likes</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>pub Entity</span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> This is the "relationship target" component.
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> It will be automatically inserted and updated to contain
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> all entities that currently "like" this entity.
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component<span class="z-punctuation z-separator z-rust">,</span> Deref</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">relationship_target</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">relationship <span class="z-keyword z-operator z-rust">=</span> Likes</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">LikedBy</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Vec</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Entity<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Later in your app
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> e1 <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn_empty</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">id</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> e2 <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Likes<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>e1</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">id</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> e3 <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Likes<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>e1</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">id</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> e1 is liked by e2 and e3 
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> liked_by <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>e1</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">get<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>LikedBy<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">assert_eq!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-keyword z-operator z-arithmetic z-rust">*</span>liked_by<span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>e2<span class="z-punctuation z-separator z-rust">,</span> e3<span class="z-punctuation z-section z-group z-end z-rust">]</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>The <a href=https://docs.rs/bevy/0.16/bevy/ecs/relationship/trait.Relationship.html><code>Relationship</code></a> component is the "source of truth", and the <a href=https://docs.rs/bevy/0.16/bevy/prelude/trait.RelationshipTarget.html><code>RelationshipTarget</code></a> component is updated to reflect that source of truth. This means that adding/removing relationships should always be done via the <a href=https://docs.rs/bevy/0.16/bevy/ecs/relationship/trait.Relationship.html><code>Relationship</code></a> component.<p>We use this "source of truth" model instead of allowing both components to "drive" for performance reasons. Allowing writes to both sides would require expensive scanning during inserts to ensure they are in sync and have no duplicates. The "relationships as the source of truth" approach allows us to make adding relationships constant-time (which is an improvement over the old Bevy parent/child approach!).<p>Relationships are built on top of Bevy's <a href=/news/bevy-0-14/#ecs-hooks-and-observers>Component Hooks</a>, which immediately and efficiently maintain the connection between the <a href=https://docs.rs/bevy/0.16/bevy/ecs/relationship/trait.Relationship.html><code>Relationship</code></a> and the <a href=https://docs.rs/bevy/0.16/bevy/prelude/trait.RelationshipTarget.html><code>RelationshipTarget</code></a> by plugging directly into the component add/remove/update lifecycle. In combination with the new <a href=#immutable-components>Immutable Components</a> feature (relationship components are immutable), this ensures data integrity is maintained no matter what developers do!<p>Bevy's existing hierarchy system has been fully replaced by the new <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.ChildOf.html><code>ChildOf</code></a> <a href=https://docs.rs/bevy/0.16/bevy/ecs/relationship/trait.Relationship.html><code>Relationship</code></a> and <a href=https://docs.rs/bevy/0.16/bevy/ecs/hierarchy/struct.Children.html><code>Children</code></a> <a href=https://docs.rs/bevy/0.16/bevy/prelude/trait.RelationshipTarget.html><code>RelationshipTarget</code></a>. Adding a child is now as simple as:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>ChildOf<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>some_parent</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Likewise reparenting an entity is as simple as:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>some_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">insert</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>ChildOf<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>new_parent</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>We also took this chance to improve our spawn APIs more generally. Read the next section for details!<p>Note that this is just the first step for relationships. We have plans to expand their capabilities:<ol><li><strong>Many-To-Many Relationships</strong>: The current system is one-to-many (ex: The <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.ChildOf.html><code>ChildOf</code></a> <a href=https://docs.rs/bevy/0.16/bevy/ecs/relationship/trait.Relationship.html><code>Relationship</code></a> points to "one" target entity and the <a href=https://docs.rs/bevy/0.16/bevy/ecs/hierarchy/struct.Children.html><code>Children</code></a> <a href=https://docs.rs/bevy/0.16/bevy/prelude/trait.RelationshipTarget.html><code>RelationshipTarget</code></a> can be targeted by "many" child entities). Some relationships could benefit from supporting many relationship targets.<li><strong>Fragmenting Relationships</strong>: In the current system, relationship components "fragment" ECS archetypes based on their <em>type</em>, just like a normal component (Ex: <code>(Player, ChildOf(e1))</code>, and <code>(Player, ChildOf(e2))</code> exist in the same archetype). Fragmenting relationships would be an opt-in system that fragment archetypes based on their <em>value</em> as well, which would result in entities with the same relationship targets being stored next to each other. This serves as an index, making querying by value faster, and making some access patterns more cache friendly.</ol><h2 id=improved-spawn-api>Improved Spawn API <a class=anchor-link href=#improved-spawn-api>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/cart>@cart</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17521>#17521</a></div></div><p>Spawning hierarchies in Bevy has historically been a bit cumbersome:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">commands
</span><span class="z-source z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Player</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_children</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">p</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">        p<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>RightHand</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_children</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">p</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">            p<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Glove</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">            p<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Sword</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">        p<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>LeftHand</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_children</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">p</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">            p<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Glove</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">            p<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Shield</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>We have big plans to improve Bevy's spawning experience with our <a href=https://github.com/bevyengine/bevy/discussions/14437>Next Generation Scene / UI System</a> (BSN). An important stepping stone on that path is making it possible to express hierarchies directly via data, rather than using builder methods. The addition of Relationships further increases the value of building such a system, as <em>all</em> relationships can benefit from it.<p>In <strong>Bevy 0.16</strong> we have vastly improved the ergonomics of spawning hierarchies:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    Player<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-support z-macro z-rust">children!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>RightHand<span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-macro z-rust">children!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>Glove<span class="z-punctuation z-separator z-rust">,</span> Sword<span class="z-punctuation z-section z-group z-end z-rust">]</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>LeftHand<span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-macro z-rust">children!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>Glove<span class="z-punctuation z-separator z-rust">,</span> Shield<span class="z-punctuation z-section z-group z-end z-rust">]</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-punctuation z-section z-group z-end z-rust">]</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>This builds on the existing Bundle API by adding support for "bundle effects", which are applied immediately after a Bundle is inserted. Notably, this enables developers to define functions that return a hierarchy like this:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">player</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">name</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-type z-rust">str</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> impl Bundle</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        Player<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>name</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        <span class="z-support z-macro z-rust">children!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">            <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>RightHand<span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-macro z-rust">children!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>Glove<span class="z-punctuation z-separator z-rust">,</span> Sword<span class="z-punctuation z-section z-group z-end z-rust">]</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">            <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>LeftHand<span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-macro z-rust">children!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>Glove<span class="z-punctuation z-separator z-rust">,</span> Shield<span class="z-punctuation z-section z-group z-end z-rust">]</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        <span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">    </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> later in your app
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-support z-function z-rust">player</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Bob<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>In most cases the <code>children!</code> macro should be preferred for ergonomics reasons. It expands to the following API:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    Player<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">Children<span class="z-punctuation z-accessor z-rust">::</span></span>spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">            RightHand<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">            <span class="z-meta z-path z-rust">Children<span class="z-punctuation z-accessor z-rust">::</span></span>spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Glove</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Sword</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">            LeftHand<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">            <span class="z-meta z-path z-rust">Children<span class="z-punctuation z-accessor z-rust">::</span></span>spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Glove</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Shield</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>There are a number of spawn wrapper variants, which provide additional flexibility:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Root<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">Children<span class="z-punctuation z-accessor z-rust">::</span></span>spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Child1<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>   
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        SpawnIter<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Child2<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Child3<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_iter</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">map</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        SpawnWith<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">parent</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> ChildSpawner<span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">            parent<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Child4<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">            parent<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Child5<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre><p>Notably, this API works for <em>all</em> relationship types. For example, you could spawn a <code>Likes</code> / <code>LikedBy</code> relationship hierarchy (as defined in the relationships section above) like this:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Monica<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">LikedBy<span class="z-punctuation z-accessor z-rust">::</span></span>spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Naomi<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Dwight<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre><p>There is also a <code>related!</code> macro, which does the same thing as <code>children!</code>, but for any relationship type:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Monica<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-support z-macro z-rust">related!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>LikedBy<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Naomi<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">        <span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Dwight<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-punctuation z-section z-group z-end z-rust">]</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre><p>This API also allows us to optimize hierarchy construction time by cutting down on re-allocations, as we can generally (with the exception of cases like <code>SpawnWith</code>) statically determine how many related entities an entity will have and preallocate space for them in the <code>RelationshipTarget</code> component (ex: <code>Children</code>).<h2 id=unified-ecs-error-handling>Unified ECS Error Handling <a class=anchor-link href=#unified-ecs-error-handling>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/NthTensor>@NthTensor</a>, <a class=heading-meta__item href=https://github.com/JeanMertz>@JeanMertz</a>, <a class=heading-meta__item href=https://github.com/JaySpruce>@JaySpruce</a>, <a class=heading-meta__item href=https://github.com/cart>@cart</a>, <a class=heading-meta__item href=https://github.com/alice-i-cecile>@alice-i-cecile</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16589>#16589</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17043>#17043</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17753>#17753</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18144>#18144</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18454>#18454</a></div></div><p>Bevy has historically left error handling as an exercise for the user. Many Bevy APIs return Results / errors, but Bevy ECS systems and commands did not themselves support returning Results / errors. Additionally, Bevy provides some "shorthand" panicking APIs that require less typing than unwrapping results. These things encouraged developers to write overly panick-ey behavior, even when that wasn't desired.<p>Ideally developers can <em>choose</em> whether or not their systems should panic. For example, panic while you are developing to discover errors quickly (and force you to solve them), but when deploying to production just print errors to a console to avoid disrupting the user's experience.<p><strong>Bevy 0.16</strong> introduces a new unified paradigm for error handling to help you ship crash-free games (and other applications!) without sacrificing the loud-and-fast development that panics enable.<p>We've prioritized a simple and consistent design, with a few bells and whistles for easier debugging:<ul><li>Bevy systems, observers, and commands now support returning <a href=https://docs.rs/bevy/0.16/bevy/ecs/error/type.Result.html><code>Result</code></a>, which is a type alias for <code>Result<(), BevyError></code><li><a href=https://docs.rs/bevy/0.16/bevy/ecs/error/type.Result.html><code>Result</code></a> expects the new <a href=https://docs.rs/bevy/0.16/bevy/ecs/error/struct.BevyError.html><code>BevyError</code></a>, which accepts any error type (much like <a href=https://docs.rs/anyhow/latest/anyhow/><code>anyhow</code></a>). This makes it easy and ergonomic to use the <a href=https://doc.rust-lang.org/rust-by-example/std/result/question_mark.html><code>?</code> operator</a> in systems / observers / commands to capture and return errors.<li><a href=https://docs.rs/bevy/0.16/bevy/ecs/error/struct.BevyError.html><code>BevyError</code></a> automatically captures <a href=https://github.com/bevyengine/bevy/pull/18144>high quality custom backtraces</a>. By default these are filtered down to just the essentials, cutting down on a lot of the noise from Rust and Bevy internals.<li>Errors returned by systems, observers, and commands are now handled by the <a href=https://docs.rs/bevy/0.16/bevy/ecs/error/static.GLOBAL_ERROR_HANDLER.html><code>GLOBAL_ERROR_HANDLER</code></a>. This defaults to panicking, but can be set to anything (log, panic, custom logic, etc). We generally encourage developing with the panicking default, then switching to logging errors when deploying to production.</ul><p>We now encourage developers to bubble up errors whenever possible, rather than panicking immediately where the error occurs.<p>Instead of:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">prelude<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">move_player</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> Transform, <span class="z-meta z-generic z-rust">With<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> player_transform <span class="z-keyword z-operator z-assignment z-rust">=</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">single_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    player_transform<span class="z-punctuation z-accessor z-dot z-rust">.</span>translation<span class="z-punctuation z-accessor z-dot z-rust">.</span>x <span class="z-keyword z-operator z-assignment z-rust">+=</span> <span class="z-constant z-numeric z-float z-rust">1.</span><span class="z-constant z-numeric z-float z-rust">0</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>Try:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">prelude<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">move_player</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> Transform, <span class="z-meta z-generic z-rust">With<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> Result</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> player_transform <span class="z-keyword z-operator z-assignment z-rust">=</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">single_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    player_transform<span class="z-punctuation z-accessor z-dot z-rust">.</span>translation<span class="z-punctuation z-accessor z-dot z-rust">.</span>x <span class="z-keyword z-operator z-assignment z-rust">+=</span> <span class="z-constant z-numeric z-float z-rust">1.</span><span class="z-constant z-numeric z-float z-rust">0</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h2 id=bevy-no-std-support>Bevy <code>no_std</code> Support <a class=anchor-link href=#bevy-no-std-support>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/bushrat011899>@bushrat011899</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15281>#15281</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15463>#15463</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15464>#15464</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15465>#15465</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15528>#15528</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15810>#15810</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16256>#16256</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16633>#16633</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16758>#16758</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16874>#16874</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16995>#16995</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16998>#16998</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17027>#17027</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17028>#17028</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17030>#17030</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17031>#17031</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17086>#17086</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17470>#17470</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17490>#17490</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17491>#17491</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17505>#17505</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17507>#17507</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17955>#17955</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18061>#18061</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18333>#18333</a></div></div><p>Bevy now has support for <code>no_std</code> targets, allowing it to be used on a much wider range of platforms.<p>Early reports from users have shown Bevy working on bare-metal desktops, embedded devices, and even retro consoles such as the GameBoy Advance:<p><video aria-label="A purple GameBoy Advance running a game made using Bevy" controls loop><source src=bevy-gba.mp4 type=video/mp4></video><p>Credit to <a href=https://www.youtube.com/@chrisbiscardi>Chris Biscardi</a> for creating this awesome demo!<p>Bevy <code>no_std</code> support has been <a href=https://github.com/bevyengine/bevy/discussions/705>discussed</a> going back over 4 years, but was initially dropped to avoid the added complexity managing <code>no_std</code> support can bring. To be <code>no_std</code> compatible, your crate and <em>all</em> of its dependencies must also be <code>no_std</code>. Coordinating that kind of support across over a hundred dependencies was just not feasible, let alone losing access to Rust's standard library.<p>Since then, Rust's support for <code>no_std</code> has evolved dramatically with support for critical APIs such as <a href=https://doc.rust-lang.org/stable/core/error/trait.Error.html><code>Error</code></a> coming in <a href=https://releases.rs/docs/1.81.0/#stabilized-apis>Rust 1.81</a>. Starting with tracking issue <a href=https://github.com/bevyengine/bevy/issues/15460>#15460</a> and a <a href=https://discord.com/channels/691052431525675048/1303128171352293410><code>no_std</code> Working Group</a>, Bevy's various crates were individually made <code>no_std</code> compatible where possible. To aid this effort, <a href=https://crates.io/crates/bevy_platform/><code>bevy_platform</code></a> was developed with the goal of providing opinionated alternatives to <code>std</code> items.<p>This effort reached a substantial milestone during the development of <strong>Bevy 0.16</strong>: support for <code>no_std</code> in our main <code>bevy</code> crate. To use Bevy on a <code>no_std</code> platform, simply disable default features and use Bevy just like any other <code>no_std</code> dependency.<pre class="language-toml z-code" data-lang=toml><code class=language-toml data-lang=toml><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">dependencies</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">bevy</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>0.16<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">default-features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-constant z-language z-toml">false</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span></code></pre><p>Note that not all of Bevy's features are compatible with <code>no_std</code> yet. Rendering, audio, and assets are notable missing APIs that you will need to find an alternative for that's suitable for your platform. But, Bevy's powerful <a href=https://docs.rs/bevy/latest/bevy/app/trait.Plugin.html><code>Plugin</code></a> system allows the community to build back support for that functionality for their particular platforms.<p>For those community members working on libraries for Bevy, we encourage you to try out <code>no_std</code> support if you can! There's a new <a href=https://github.com/bevyengine/bevy/tree/main/examples/no_std/library><code>no_std</code> library</a> example which demonstrates how to make a crate that is compatible with <code>std</code> and <code>no_std</code> users, with detailed comments and advice. During the release candidate period, quite a few libraries have successfully experimented with <code>no_std</code> support, such as <a href=https://github.com/Bluefinger/bevy_rand><code>bevy_rand</code></a> and <a href=https://github.com/projectharmonia/bevy_replicon/tree/bevy-0.16-dev><code>bevy_replicon</code></a>.<p>Determining what <code>no_std</code> targets support Bevy is still a work in progress. If you have an unusual platform you'd like to try getting Bevy working on, check out the <a href=https://discord.com/channels/691052431525675048/1284885928837517432><code>#unusual-platforms</code></a> channel on Bevy's Discord server for advice!<h2 id=faster-transform-propagation>Faster Transform Propagation <a class=anchor-link href=#faster-transform-propagation>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/aevyrie>@aevyrie</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17840>#17840</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18589>#18589</a></div></div><p>Transforms in Bevy (and other 3D software) come in two flavors:<ol><li><a href=https://docs.rs/bevy/0.16.0/bevy/transform/components/struct.GlobalTransform.html><code>GlobalTransform</code></a>: represents the absolute world-space position, scale and rotation of an object.<li><a href=https://docs.rs/bevy/0.16.0/bevy/transform/components/struct.Transform.html><code>Transform</code></a>: represent the position, scale, and rotation of an object relative to its parent. This is also known as the "local" transform.</ol><p>In order to compute the <a href=https://docs.rs/bevy/0.16.0/bevy/transform/components/struct.GlobalTransform.html><code>GlobalTransform</code></a> of each object (which is what rendering and physics care about!), we need to recursively combine the <a href=https://docs.rs/bevy/0.16.0/bevy/transform/components/struct.Transform.html><code>Transform</code></a> of all of our objects down the parent-child hierarchy. This process, known as transform propagation, can be pretty expensive, especially with many entities in a scene.<p><strong>Bevy 0.16</strong> comes with <em>two</em> impressive performance optimizations:<ol><li><strong>Improved parallelization strategies</strong>: While we were already splitting the work across threads, better work sharing, parallelization across trees and a leaf vs non-leaf split to optimize cache coherency made a huge difference.<li><strong>Saving work for trees where none of the objects have moved</strong>: Level geometry and props are not typically moving around each frame, so this optimization applies to <em>many</em> cases! We're now propagating a "dirty bit" up the hierarchy towards ancestors; allowing transform propagation to ignore entire subtrees of the hierarchy if they encounter an entity without the dirty bit.</ol><p>The results speak for themselves: taken together, our testing on the huge (127,515 objects) <a href=https://github.com/Activision/caldera>Caldera Hotel</a> scene from Call of Duty: Warzone shows that transform propagation took 1.1 ms in <strong>Bevy 0.15</strong> on an M4 Max Macbook, and 0.1 ms after these changes in <strong>Bevy 0.16</strong>. Even fully dynamic scenes (like our <a href=https://github.com/bevyengine/bevy/blob/main/examples/stress_tests/many_foxes.rs><code>many_foxes</code></a> stress test) are substantially faster due to the improved parallelism. Nice! This work matters even more for more typical hardware: on large scenes on mid or low-end hardware transform propagation could eat an entire 25% of the frame budget. Ouch!<p>While that's an impressive 11x performance improvement, the absolute magnitude of the time saved is the key metric. With about 16 ms per frame at 60 FPS, that's 6% of your <em>entire</em> game's CPU budget saved. making huge open worlds or incredibly complex CAD assemblies more viable than ever before.<p><img alt="A screenshot of a tracy histogram showing the effects of these changes on Caldera. 0.15 peaks at 1.1 ms, while 0.16 peaks at 0.1 ms." src=caldera-transform-propagation-bench.jpg><p>If you're interested in the gory technical details of these optimizations, take a look at <a href=https://github.com/bevyengine/bevy/blob/b0c446739888705d3e95b640e9d13e0f1f53f06d/crates/bevy_transform/src/systems.rs#L12>the code itself</a>. It's incredibly well-commented and great to learn from.<p>These optimizations were upstreamed from the <a href=https://github.com/aevyrie/big_space><code>big_space</code></a> crate (by the author of that crate!)<h2 id=specular-tints-and-maps>Specular Tints and Maps <a class=anchor-link href=#specular-tints-and-maps>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/pcwalton>@pcwalton</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/14069>#14069</a></div></div><p>If you have an eye for light (or training in visual arts), you'll notice that shiny curved surfaces get extra-bright spots of light. That's a specular highlight! In <strong>Bevy 0.16</strong>, we've implemented a standard physically-based rendering (PBR) feature of specular highlights: the ability to tint their color.<p><img alt="A shiny floating sphere with an iridescent multicolored sheen. It reminds you of a Christmas tree ornament. You can see a reflection of a city scene in it." src=specular-tint-sphere.jpg><p>This can be done uniformly across the material, by simply setting the <code>specular_tint</code> field on the <a href=https://docs.rs/bevy/0.16/bevy/pbr/struct.StandardMaterial.html><code>StandardMaterial</code></a> for your object.<p>Like many other material properties (color, normals, emissiveness, roughness etc), this can be varied over the material via the use of a texture map, which describes how this property varies via a 2-dimensional UV-space image.<p>Maps are relatively expensive: you need an entire 2D image, rather than a single float or color, and GPUs have limits on the number of textures you can use per material, unless they support bindless textures. As a result, specular maps are off by default, and gated behind the <code>pbr_specular_textures</code> Cargo feature.<p>To support this work, we now support the KHR_materials_specular glTF extension, allowing artists to set these properties in 3D modelling tools like Blender, then import them into Bevy.<h2 id=experimental-wesl-shaders>Experimental WESL Shaders <a class=anchor-link href=#experimental-wesl-shaders>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/tychedelia>@tychedelia</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17953>#17953</a></div></div><p>Bevy continues to live life on the edge, the bleeding edge, of graphics technology. Today, Bevy supports <a href=https://wesl-lang.dev/>WESL</a> shaders!<p>Most Bevy shaders are written in <a href=https://www.w3.org/TR/WGSL/>WGSL</a>, a modern shader language built for simplicity. But while WGSL is pretty simple as far as shader languages go, it also leaves a lot to be desired in terms of higher level features. Currently, Bevy has its own extended version of WGSL, which adds support for conditional compiling, importing between files, and other useful features.<p>WESL is a brand new shader language that extends WGSL (often in ways similar to Bevy's approach) and aims to bring common language conveniences to the GPU. WESL not only includes conditional compiling and importing between files, but it is also growing to support generics, package managers, and more.<p>It's important to note that WESL is still relatively early in development, and not all of its features are fully functional yet, nor are all its features supported in Bevy (yet). For that reason, WESL support is gated behind the cargo feature <code>shader_format_wesl</code>, which is disabled by default.<p>Despite the additional features, WESL is easy to layer on top of existing WGSL shaders. This is because it is a superset of WGSL (WGSL is valid WESL). That makes it easy to migrate existing WGSL to WESL, though it's worth mentioning that the Bevy's own "extended WGSL syntax" will need to be ported to its WESL counterparts. The WESL team (who helped write these notes!) is actively listening to feedback, and so is Bevy. If you do choose to use WESL in addition to or in replacement of WGSL, your thoughts, feature requests, and any pain points you encounter can be shared <a href=https://github.com/wgsl-tooling-wg/wesl-rs>here</a>.<p>If you're interested in trying WESL, check out the new <a href=https://bevy.org/examples/shaders/shader-material-wesl/>Material - WESL</a> example. Before using this in a production environment, be sure to check out the original <a href=https://github.com/bevyengine/bevy/pull/17953>PR</a> for a full list of caveats.<p>WESL is an exciting frontier for shader languages. You can track their progress and plans <a href=https://wesl-lang.dev/>here</a>.<h2 id=virtual-geometry-improvements>Virtual Geometry Improvements <a class=anchor-link href=#virtual-geometry-improvements>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/JMS55>@JMS55</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17765>#17765</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16947>#16947</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16941>#16941</a></div></div><p>Virtual geometry (the <code>meshlet</code> cargo feature) is Bevy's Nanite-like rendering system, allowing much greater levels of geometry density than is otherwise possible, and freeing artists from manually creating LODs.<p>In <strong>Bevy 0.16</strong>, virtual geometry got some performance improvements thanks to new algorithms and GPU APIs.<p>Read more details on the <a href=https://jms55.github.io/posts/2025-03-27-virtual-geometry-bevy-0-16>author's blog post</a>.<p>Users are not required to regenerate their <a href=https://docs.rs/bevy/0.16/bevy/pbr/experimental/meshlet/struct.MeshletMesh.html><code>MeshletMesh</code></a> assets, but doing so is recommended in order to take advantage of the improved clustering algorithm in <strong>Bevy 0.16</strong>.<p><img alt="Screenshot of the meshlet example" src=meshlet_bunnies.jpg><h2 id=immutable-components>Immutable Components <a class=anchor-link href=#immutable-components>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/bushrat011899>@bushrat011899</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16372>#16372</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16668>#16668</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18532>#18532</a></div></div><p><strong>Bevy 0.16</strong> adds the concept of <strong>immutable components</strong>: data that cannot be mutated once it is inserted (ex: you cannot query for <code>&mut MyComponent</code>). The only way to modify an immutable component is to insert a new instance on top.<p>A component can be made immutable by adding the <code>#[component(immutable)]</code> attribute:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">component</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">immutable</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MyComponent</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>pub <span class="z-storage z-type z-rust">u32</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>By embracing this restriction, we can ensure that component lifecycle hooks and observers (add/remove/insert/replace) capture <em>every</em> change that occurs, enabling them to uphold complex invariants.<p>To illustrate this, consider the following example, where we track the global sum of all <code>SumMe</code> components:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">component</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">immutable</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">SumMe</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>pub <span class="z-storage z-type z-rust">u32</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This will always hold the sum of all `SumMe` components on entities.
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Resource</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">TotalSum</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-storage z-type z-rust">u32</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This observer will trigger when spawning or inserting a SumMe component
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">add_when_inserting</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">trigger</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Trigger<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>OnInsert, SumMe<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span>SumMe<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">total_sum</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">ResMut<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>TotalSum<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> sum_me <span class="z-keyword z-operator z-assignment z-rust">=</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>trigger<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">target</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    total_sum<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-integer z-decimal z-rust">0</span> <span class="z-keyword z-operator z-assignment z-rust">+=</span> sum_me<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-integer z-decimal z-rust">0</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This observer will trigger when despawning or removing a SumMe component
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">subtract_when_removing</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">trigger</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Trigger<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>OnRemove, SumMe<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span>SumMe<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">total_sum</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">ResMut<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>TotalSum<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> sum_me <span class="z-keyword z-operator z-assignment z-rust">=</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>trigger<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">target</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    total_sum<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-integer z-decimal z-rust">0</span> <span class="z-keyword z-operator z-assignment z-rust">-=</span> sum_me<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-integer z-decimal z-rust">0</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Changing this to `&mut SumMe` would fail to compile!
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">modify_values</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">commands</span><span class="z-punctuation z-separator z-rust">:</span> Commands, <span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Entity, <span class="z-keyword z-operator z-rust">&</span>SumMe<span class="z-punctuation z-section z-group z-end z-rust">)</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">for</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity<span class="z-punctuation z-separator z-rust">,</span> sum_me</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-rust">in</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">iter</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> We can read the value, but not write to it.
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> current_value <span class="z-keyword z-operator z-assignment z-rust">=</span> sum_me<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-integer z-decimal z-rust">0</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This will overwrite: indirectly mutating the value
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> and triggering both observers: removal first, then insertion
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">insert</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>sum_me<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-integer z-decimal z-rust">0</span> <span class="z-keyword z-operator z-arithmetic z-rust">+</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>While immutable components are a niche tool, they're a great fit for rarely mutated (or small count) components where correctness is key. For example, <strong>Bevy 0.16</strong> uses immutable components (and hooks!) as the foundation of our shiny new <strong>relationships</strong> to ensure that both sides of the relationship (e.g. <a href=https://docs.rs/bevy/0.16/bevy/ecs/hierarchy/struct.ChildOf.html><code>ChildOf</code></a> and <a href=https://docs.rs/bevy/0.16/bevy/ecs/hierarchy/struct.Children.html><code>Children</code></a>) stay in sync.<p>We're keen to develop a first-class indexing solution using these new tools, and excited to hear about your ideas. Stay tuned; we've only scratched the surface here!<h2 id=entity-cloning>Entity Cloning <a class=anchor-link href=#entity-cloning>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/eugineerd>@eugineerd</a>, <a class=heading-meta__item href=https://github.com/JaySpruce>@JaySpruce</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16132>#16132</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16826>#16826</a></div></div><p>Bevy now has first-class support for cloning entities. While it was possible to do this before using reflection and <code>ReflectComponent</code> functionality, the common implementation was slow and required registering all cloneable components. With <strong>Bevy 0.16</strong>, entity cloning is supported natively and is as simple as adding <code>#[derive(Clone)]</code> to a component to make it cloneable.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component<span class="z-punctuation z-separator z-rust">,</span> Clone</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">require</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">MagicalIngredient</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Potion</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component<span class="z-punctuation z-separator z-rust">,</span> Default<span class="z-punctuation z-separator z-rust">,</span> Clone</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MagicalIngredient</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">amount</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">f32</span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">process_potions</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">input</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Res<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">ButtonInput<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>KeyCode<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">commands</span><span class="z-punctuation z-separator z-rust">:</span> Commands,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">potions</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Entity, <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> MagicalIngredient<span class="z-punctuation z-section z-group z-end z-rust">)</span>, <span class="z-meta z-generic z-rust">With<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Potion<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Create a new potion
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">if</span> input<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">just_pressed</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">KeyCode<span class="z-punctuation z-accessor z-rust">::</span></span>KeyS</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">            <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Name<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Simple Potion<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> Potion</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Add as much magic as we want
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">else</span> <span class="z-keyword z-control z-rust">if</span> input<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">just_pressed</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">KeyCode<span class="z-punctuation z-accessor z-rust">::</span></span>KeyM</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">for</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-storage z-modifier z-rust">mut</span> ingredient</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-rust">in</span> potions<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">iter_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            ingredient<span class="z-punctuation z-accessor z-dot z-rust">.</span>amount <span class="z-keyword z-operator z-assignment z-rust">+=</span> <span class="z-constant z-numeric z-float z-rust">1.</span><span class="z-constant z-numeric z-float z-rust">0</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> And then duplicate all the potions!
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">else</span> <span class="z-keyword z-control z-rust">if</span> input<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">just_pressed</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">KeyCode<span class="z-punctuation z-accessor z-rust">::</span></span>KeyD</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">for</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>potion<span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-rust">_</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-rust">in</span> potions<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">iter</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>potion</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone_and_spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span></code></pre><p><code>clone_and_spawn</code> spawns a new entity with all cloneable components, skipping those that can't be cloned. If your use case requires different behavior, there are more specialized methods:<ul><li><code>clone_components</code> clones components from the source entity to a specified target entity instead of spawning a new one.<li><code>move_components</code> removes components from the source entity after cloning them to the target entity.<li><code>clone_and_spawn_with</code> and <code>clone_with</code> allow customization of the cloning behavior by providing access to <code>EntityClonerBuilder</code> before performing the clone.</ul><p><code>EntityClonerBuilder</code> can be used to configure how cloning is performed - for example, by filtering which components should be cloned, modifying how <code>required</code> components are cloned, or controlling whether entities linked by relationships should be cloned recursively.<p>An important note: components with generic type parameters will not be cloneable by default. For these cases, you should add <code>#[derive(Reflect)]</code> and <code>#[reflect(Component)]</code> to the component and register it for the entity cloning functionality to work properly.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component<span class="z-punctuation z-separator z-rust">,</span> Reflect<span class="z-punctuation z-separator z-rust">,</span> Clone</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">reflect</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-generic z-rust"><span class="z-entity z-name z-struct z-rust">GenericComponent</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>T<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span></span><span class="z-meta z-struct z-rust"> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ...
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">main</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ...
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">register_type<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">GenericComponent<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">i32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ...
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>See documentation for <code>EntityCloner</code> if you're planing on implementing custom clone behaviors for components or need further explanation on how this works.<h2 id=entity-disabling-default-query-filters>Entity Disabling / Default Query Filters <a class=anchor-link href=#entity-disabling-default-query-filters>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/NiseVoid>@NiseVoid</a>, <a class=heading-meta__item href=https://github.com/alice-i-cecile>@alice-i-cecile</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/13120>#13120</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17514>#17514</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17768>#17768</a></div></div><p><strong>Bevy 0.16</strong> adds the ability to disable entities by adding the <a href=https://docs.rs/bevy/0.16/bevy/ecs/entity_disabling/struct.Disabled.html><code>Disabled</code></a> component. This (by default) will hide the entity (and all of its components) from systems and queries that are looking for it.<p>This is implemented using the newly added <strong>default query filters</strong>. These do what they say on the tin: every query will act as if they have a <code>Without&LTDisabled></code> filter, unless they explicitly mention <a href=https://docs.rs/bevy/0.16/bevy/ecs/entity_disabling/struct.Disabled.html><code>Disabled</code></a> (generally via a <code>With&LTDisabled></code> or <code>Has&LTDisabled></code> argument).<p>Because this is generic, developers can also define additional disabling components, which can be registered via [<code>App::register_disabling_component</code>]. Having multiple distinct disabling components can be useful if you want each form of disabling to have its own semantics / behaviors: you might use this feature for hiding networked entities, freezing entities in an off-screen chunk, creating a collection of prefab entities loaded and ready to spawn, or something else entirely.<p>Note that for maximum control and explicitness, only the entities that you directly add disabling components to are disabled. Their children or other related entities are not automatically disabled!<p>To disable an entity <em>and</em> its children, consider the new <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.EntityCommands.html#method.insert_recursive><code>Commands::insert_recursive</code></a> and <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.EntityCommands.html#method.remove_recursive><code>Commands::remove_recursive</code></a>.<h2 id=better-location-tracking>Better Location Tracking <a class=anchor-link href=#better-location-tracking>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/SpecificProtagonist>@SpecificProtagonist</a>, <a class=heading-meta__item href=https://github.com/chescock>@chescock</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15607>#15607</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16047>#16047</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16778>#16778</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17075>#17075</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17602>#17602</a></div></div><p>Bevy's unified data model allows introspection and debugging tools to work for the entire engine: For example, last release's <code>track_change_detection</code> feature flag lets you <a href=/news/bevy-0-15/#change-detection-source-location-tracking>automatically track</a> which which line of source code inserted or mutated any component or resource.<p>Now it also tracks which code<ul><li>triggered a hook or observer: <code>HookContext.caller</code>, <code>Trigger::caller()</code><li>sent an event: <code>EventId.caller</code><li>spawned or despawned an entity (until the entity index is reused): <code>EntityRef::spawned_by()</code>, <code>Entities::entity_get_spawned_or_despawned_by()</code></ul><p>And as a side effect, this leads to nicer error messages in some cases, such as this nicely improved despawn message:<p><code>Entity 0v1 was despawned by src/main.rs:10:11</code><p>Having outgrown its old name, the feature flag is now called <code>track_location</code>.<h2 id=text-shadows>Text Shadows <a class=anchor-link href=#text-shadows>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/ickshonpe>@ickshonpe</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17559>#17559</a></div></div><p>Bevy UI now supports text shadows:<p><img alt="image of button with text shadow" src=text_shadow.jpg><p>Just add the <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.TextShadow.html><code>TextShadow</code></a> component to any <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.Text.html><code>Text</code></a> entity. <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.TextShadow.html><code>TextShadow</code></a> can be used to configure the offset and the color of the shadow.<h2 id=input-focus-improvements>Input Focus Improvements <a class=anchor-link href=#input-focus-improvements>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/viridia>@viridia</a>, <a class=heading-meta__item href=https://github.com/alice-i-cecile>@alice-i-cecile</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15611>#15611</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16795>#16795</a></div></div><p>The concept of "input focus" is important for accessibility. Visually or motor-impaired users may have trouble using mice; with focus navigation they can control the UI using only the keyboard. This not only helps disabled users, but power users as well.<p>The same general idea can be applied to game controllers and other input devices. This is often seen in games where the number of controls on the screen exceeds the number of buttons on the gamepad, or for complex "inventory" pages with a grid of items.<p>The <code>bevy_a11y</code> crate has had a <code>Focus</code> resource for a long time, but it was situated in a way that made it hard to use. This has been replaced by an <code>InputFocus</code> resource which lives in a new crate, <code>bevy_input_focus</code>, and now includes a bunch of helper functions that make it easier to implement widgets that are focus-aware.<p>This new crate also supports "pluggable focus navigation strategies", of which there are currently two: there's a "tab navigation" strategy, which implements the traditional desktop sequential navigation using the TAB key, and a more "console-like" 2D navigation strategy that uses a hybrid of spatial searching and explicit navigation links.<h2 id=retained-gizmos>Retained <code>Gizmo</code>s <a class=anchor-link href=#retained-gizmos>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/tim-blackbird>@tim-blackbird</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15473>#15473</a></div></div><p>In previous versions of Bevy, gizmos were always rendered in an "immediate mode" style: they were rendered for a single frame before disappearing. This is great for prototyping but also has a performance cost.<p>With retained gizmos, you can now spawn gizmos that persist, enabling higher performance! For a static set of lines, we've measured a ~65-80x improvement in performance!<p>As an example, here's how to spawn a sphere that persists:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">setup</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">commands</span><span class="z-punctuation z-separator z-rust">:</span> Commands,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">gizmo_assets</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">ResMut<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">Assets<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>GizmoAsset<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> gizmo <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">GizmoAsset<span class="z-punctuation z-accessor z-rust">::</span></span>default<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> A sphere made out of one million lines!
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    gizmo
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">sphere</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-float z-rust">1.</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-other z-rust">CRIMSON</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">resolution</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">1_000_000</span> <span class="z-keyword z-operator z-arithmetic z-rust">/</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">3</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Gizmo <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        handle<span class="z-punctuation z-separator z-rust">:</span> gizmo_assets<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>gizmo</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>The immediate mode <code>Gizmos</code> API is still there if you want it though. It is still a great choice for easy debugging.<h2 id=transparent-sprite-picking>Transparent Sprite Picking <a class=anchor-link href=#transparent-sprite-picking>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/vandie>@vandie</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16388>#16388</a></div></div><p>In most cases when working on a game, you don't want clicks over the transparent part of sprites to count as a click on that sprite. This is especially true if you're working on a 2D game with a lot of overlapping sprites which have transparent regions.<p>In previous versions of bevy, sprite interactions were handled as simple bounding box checks. If your cursor was within the boundary of the sprite's box, it would block interactions with the sprites behind it, even if the area of the sprite is fully transparent.<p>In <strong>Bevy 0.16</strong>, when interacting with transparent sections of an entity sprite, those interactions will pass through to the entities beneath it. No changes required to your codebase!<p>By default passthrough will occur for any part of a sprite which has an alpha value of <code>0.1</code> or lower. If you wish to revert back to rect-checking for sprites or change the cutoff, you can do so by overwriting <code>SpritePickingSettings</code>.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Change the alpha value cutoff to 0.2 instead of the default 0.1
</span></span><span class="z-source z-rust">app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">insert_resource</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>SpritePickingSettings <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">  picking_mode<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">SpritePickingMode<span class="z-punctuation z-accessor z-rust">::</span></span>AlphaThreshold<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">2</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Revert to Bounding Box picking mode
</span></span><span class="z-source z-rust">app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">insert_resource</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>SpritePickingSettings <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">  picking_mode<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">SpritePickingMode<span class="z-punctuation z-accessor z-rust">::</span></span>BoundingBox
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h2 id=reflection-function-overloading-generic-variadic-functions>Reflection: Function Overloading (Generic & Variadic Functions) <a class=anchor-link href=#reflection-function-overloading-generic-variadic-functions>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/MrGVSV>@MrGVSV</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15074>#15074</a></div></div><p><strong>Bevy 0.15</strong> added support for reflecting functions to <code>bevy_reflect</code>, Bevy's type reflection crate. This allows Rust functions to be called dynamically with a list of arguments generated at runtime—and safely!<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">add</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">a</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">i32</span>, <span class="z-variable z-parameter z-rust">b</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">i32</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">i32</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    a <span class="z-keyword z-operator z-arithmetic z-rust">+</span> b
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> reflect_add<span class="z-punctuation z-separator z-rust">:</span> DynamicFunction <span class="z-keyword z-operator z-assignment z-rust">=</span> add<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_function</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> args <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">ArgList<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">  <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">push_owned</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">25_</span><span class="z-storage z-type z-numeric z-rust">i32</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">  <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">push_owned</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">75_</span><span class="z-storage z-type z-numeric z-rust">i32</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> result <span class="z-keyword z-operator z-assignment z-rust">=</span> reflect_add<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">call</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>args</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> sum <span class="z-keyword z-operator z-assignment z-rust">=</span> result<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap_owned</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">try_take<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">i32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">assert_eq!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>sum<span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">100</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>However, due to limitations in Rust, it was not possible to make these dynamic functions generic. This meant individual functions had to be created for all desired monomorphizations and manually mapped to at runtime.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">add</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>T<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Add<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Output=T<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">a</span><span class="z-punctuation z-separator z-rust">:</span> T, <span class="z-variable z-parameter z-rust">b</span><span class="z-punctuation z-separator z-rust">:</span> T</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> T</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    a <span class="z-keyword z-operator z-arithmetic z-rust">+</span> b
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> reflect_add_i32 <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">add<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">i32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_function</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> reflect_add_u32 <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">add<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">u32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_function</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> reflect_add_f32 <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">add<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">f32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_function</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ...
</span></span></code></pre><p>While the original Rust limitations still exist, Bevy 0.16 improves the developer experience by adding support for function overloading. The term "function overloading" might be familiar to developers from other programming languages, but essentially it means that one function can have multiple argument signatures.<p>This allows us to simplify the previous example:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> reflect_add <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">add<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">i32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_function</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">  <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_overload</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">add<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">u32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">  <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_overload</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">add<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">f32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>The first <code>add::&LTi32></code> acts as the base case, with each overload acting on top of it. When the function is called, the corresponding overload is selected based on the types of the provided arguments.<p>And by extension of the fact that function overloading allows for multiple argument signatures, this also means that we can define functions that take a variable number of arguments, commonly known as "variadic functions."<p>This allows for some interesting use cases:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Reflect</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Player</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">name</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">health</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">u32</span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Creates a `Player` with one of the following based on the provided arguments:  
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> - No name and 100 health  
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> - A name and 100 health  
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> - No name and custom health  
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> - A name and custom health
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> create_player <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust">Player <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    name<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">None</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    health<span class="z-punctuation z-separator z-rust">:</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">100</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">  <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into_function</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">  <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_overload</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">name</span><span class="z-punctuation z-separator z-rust">:</span> String<span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust">Player <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    name<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>name</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    health<span class="z-punctuation z-separator z-rust">:</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">100</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">  <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_overload</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">health</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">u32</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust">Player <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    name<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">None</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    health
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">  <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_overload</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">name</span><span class="z-punctuation z-separator z-rust">:</span> String<span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-parameter z-rust">health</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">u32</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust">Player <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    name<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>name</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    health<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h2 id=curve-derivatives>Curve Derivatives <a class=anchor-link href=#curve-derivatives>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/mweatherley>@mweatherley</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16503>#16503</a></div></div><p><code>bevy_math</code> has collected a sizable collection of curves and methods for working with curves, which are useful for everything from animations to color gradients to gameplay logic.<p>One of the most natural and important things you might want to do with a curve is to inspect its <strong>derivative</strong>: the rate at which it's changing. You might even be after its <strong>second derivative</strong>: the rate at which the rate of change is changing.<p>In <strong>Bevy 0.16</strong> you can now easily calculate these things!<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> points <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-support z-function z-rust">vec2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-arithmetic z-rust">-</span><span class="z-constant z-numeric z-float z-rust">1.</span><span class="z-constant z-numeric z-float z-rust">0</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-arithmetic z-rust">-</span><span class="z-constant z-numeric z-float z-rust">20.</span><span class="z-constant z-numeric z-float z-rust">0</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-support z-function z-rust">vec2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">3.</span><span class="z-constant z-numeric z-float z-rust">0</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-float z-rust">2.</span><span class="z-constant z-numeric z-float z-rust">0</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-support z-function z-rust">vec2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">5.</span><span class="z-constant z-numeric z-float z-rust">0</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-float z-rust">3.</span><span class="z-constant z-numeric z-float z-rust">0</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust">    <span class="z-support z-function z-rust">vec2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">9.</span><span class="z-constant z-numeric z-float z-rust">0</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-float z-rust">8.</span><span class="z-constant z-numeric z-float z-rust">0</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">]</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> A cubic spline curve that goes through `points`.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> curve <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">CubicCardinalSpline<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">3</span><span class="z-punctuation z-separator z-rust">,</span> points</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_curve</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Calling `with_derivative` causes derivative output to be included in the output of the curve API.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> curve_with_derivative <span class="z-keyword z-operator z-assignment z-rust">=</span> curve<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_derivative</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> A `Curve&LTf32>` that outputs the speed of the original.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> speed_curve <span class="z-keyword z-operator z-assignment z-rust">=</span> curve_with_derivative<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">map</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">x</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust">x<span class="z-punctuation z-accessor z-dot z-rust">.</span>derivative<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">norm</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>We've implemented the required traits for most of our native curve types: splines, lines, and all manner of compound curves. Curves which accept arbitrary functions are not covered (build your own specialized curve types), as Rust does not have a first-class notion of a differentiable function!<h2 id=assetchanged-query-filter><code>AssetChanged</code> Query Filter <a class=anchor-link href=#assetchanged-query-filter>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/tychedelia>@tychedelia</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16810>#16810</a></div></div><p>In Bevy, "assets" are data we want to hold a single copy of, even when used by many entities: things like sounds, images and 3D models. Assets like <code>Image</code> are stored in the [<code>Assets&LTImage></code>] resource. Entities then have components like <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.Sprite.html><code>Sprite</code></a>, which hold a [<code>Handle&LTImage></code>] inside of it, identifying which asset to use for that entity.<p>While this works great for avoiding storing ten thousands ogre meshes in memory when you're making a tower defense, this relatively indirect pattern makes it hard to figure out when an asset that you're relying on has changed. That's because the <a href=https://docs.rs/bevy/0.16/bevy/asset/enum.Handle.html><code>Handle&LTT></code></a> could change, pointing to a new asset, or the underlying asset in <a href=https://docs.rs/bevy/0.16/bevy/asset/struct.Assets.html><code>Assets&LTT></code></a> could change, modifying the underlying data.<p>While querying for <code>Changed&LTSprite></code> will catch changes to the handle, it <em>won't</em> catch changes to the underlying asset, resulting in frustrating bugs that are hard to detect, as they only occur when things change in an unusual way.<p>To solve this, we've added an <a href=https://docs.rs/bevy/0.16/bevy/asset/prelude/struct.AssetChanged.html><code>AssetChanged</code></a> query filter, which works for any type (like <a href=https://docs.rs/bevy/0.16/bevy/prelude/struct.Sprite.html><code>Sprite</code></a>) which implements the new <a href=https://docs.rs/bevy/0.16/bevy/asset/trait.AsAssetId.html><code>AsAssetId</code></a> trait. Something like <code>Query<&mut Aabb, With&LTAssetChanged&LTMesh3d>>></code> now Just Works™, allowing you to recompute data whenever the underlying asset is changed for any reason.<h2 id=asset-processing-no-longer-auto-generates-meta-files>Asset Processing no longer auto-generates .meta files <a class=anchor-link href=#asset-processing-no-longer-auto-generates-meta-files>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/andriyDev>@andriyDev</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17216>#17216</a></div></div><p>In <strong>Bevy 0.12</strong>, we <a href=/news/bevy-0-12/#bevy-asset-v2>introduced Assets V2</a>. This was a complete rewrite of our asset system, which added features like "asset preprocessing" (the ability to process assets into more efficient forms at development time, prior to deploying your game). This however created "meta files" for every asset in your project - meaning when you started using asset preprocessing <em>at all</em>, your entire <code>assets</code> folder would be filled with these meta files automatically (even for assets that don't need any preprocessing).<p>To alleviate this pain, enabling asset preprocessing no longer automatically writes meta files! This makes it easier to enable asset preprocessing and adopt it gradually.<p>In addition, we've added <code>AssetServer::write_default_loader_meta_file_for_path</code> and <code>AssetProcessor::write_default_meta_file_for_path</code> to allow users to explicitly generate the default meta files for assets when necessary.<p>Consider enabling asset processing with:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_plugins</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>DefaultPlugins<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">set</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    AssetPlugin <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        mode<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">AssetMode<span class="z-punctuation z-accessor z-rust">::</span></span>Processed<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Enabling the <code>bevy/asset_processor</code> feature will then process files automatically for you. See <a href=https://github.com/bevyengine/bevy/blob/main/examples/asset/processing/asset_processing.rs>the asset processing example</a> for more details!<h2 id=mesh-tags>Mesh Tags <a class=anchor-link href=#mesh-tags>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/tychedelia>@tychedelia</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17648>#17648</a></div></div><p>Bevy has powerful support for <a href=https://bevy.org/examples/shaders/automatic-instancing/>automatic instancing</a> for any entities that share the same mesh and material. However, sometimes it can still be useful to reference data that is not the same across all instances of a material. Previously, this required either writing significant amount of custom rendering code or giving up the performance benefits of automatic instancing by creating more materials.<p>The new <code>MeshTag</code> component allows adding a custom <code>u32</code> tag to mesh-material entities that can be referenced in the vertex shader for a material. In combination with storage textures or the <a href=https://bevy.org/news/bevy-0-15/#shader-storage-buffer-asset><code>ShaderStorageBuffer</code> asset</a> added in <strong>Bevy 0.15</strong>, this provides a flexible new mechanism to access external data on a per-instance basis or otherwise tag your mesh instances.<p>Spawn a mesh tag with a mesh-material entity:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Clone a mesh and material handle to enable automatic instancing 
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    Mesh3d<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>mesh_handle<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    MeshMaterial3d<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>material_handle<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> The mesh tag can be any `u32` that is meaningful to your application, like
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> a particular variant of an enum or an index into some external data 
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust">    MeshTag<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">1234</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> 
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Lookup the tag in a vertex shader:<pre class="language-wgsl z-code" data-lang=wgsl><code class=language-wgsl data-lang=wgsl><span class="z-source z-wgsl"><span class="z-invalid z-deprecated z-wgsl">#import</span> <span class="z-variable z-other z-wgsl">bevy_pbr</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-variable z-other z-wgsl">mesh_functions</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-punctuation z-attribute z-wgsl">@</span><span class="z-entity z-other z-attribute z-wgsl">vertex</span>
</span><span class="z-source z-wgsl"><span class="z-meta z-function z-definition z-wgsl"><span class="z-keyword z-fn z-wgsl">fn</span> <span class="z-entity z-name z-function z-definition z-wgsl">vertex</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">vertex</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span> <span class="z-entity z-name z-type z-wgsl">Vertex</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span> <span class="z-keyword z-operator z-arrow z-skinny z-wgsl">-></span> <span class="z-entity z-name z-type z-wgsl">VertexOutput</span> <span class="z-punctuation z-brackets z-curly z-wgsl">{</span></span>
</span><span class="z-source z-wgsl"><span class="z-comment z-line z-double-slash z-wgsl">    // Lookup the tag for the given mesh</span>
</span><span class="z-source z-wgsl">    <span class="z-keyword z-other z-declarations-and-types z-wgsl">let</span> <span class="z-variable z-other z-wgsl">tag</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-variable z-other z-wgsl">mesh_functions</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-meta z-function z-wgsl"><span class="z-entity z-name z-function z-wgsl">get_tag</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">vertex</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span><span class="z-variable z-other z-wgsl">instance_index</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-comment z-line z-double-slash z-wgsl">    // Index into a storage buffer, read a storage texture texel, etc...</span>
</span><span class="z-source z-wgsl"><span class="z-punctuation z-brackets z-curly z-wgsl">}</span>
</span><span class="z-source z-wgsl">
</span></code></pre><h2 id=gpu-timestamps-in-traces>GPU Timestamps in Traces <a class=anchor-link href=#gpu-timestamps-in-traces>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/JMS55>@JMS55</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18490>#18490</a></div></div><p>If you wish to optimize something, you must first measure and understand it. When looking at the performance of applications, <a href=https://github.com/wolfpld/tracy>tracy</a> is our tool of choice. It gives us a clear understanding of how long work takes, when it happens relative to other work each frame, and how various threads are used. Read our <a href=https://github.com/bevyengine/bevy/blob/main/docs/profiling.md>profiling docs</a> to get started!<p>But until now, it's had a critical limitation: work done on the GPU wasn't shown, forcing devs to pull up dedicated GPU-focused tools (like <a href=https://developer.nvidia.com/nsight-systems>NSight</a> or <a href=https://renderdoc.org/>RenderDoc</a>) and struggle to piece together an intuition for how it all fits together.<p>In 0.16, we've connected the <a href=https://bevy.org/news/bevy-0-14/#tools-for-profiling-gpu-performance>rendering diagnostics added in Bevy 0.14</a> to <a href=https://github.com/wolfpld/tracy>tracy</a>, creating a cohesive picture of all of the work that's being done in a Bevy application in a single convenient place.<p>That said, we've only instrumented a few of our passes so far. While we will improve this in the future, you will need to add spans to your own custom rendering code, and specialized GPU diagnostic tools will always be more powerful: capturing all GPU-related work done, and providing more detailed information.<p>Special thanks to <a href=https://github.com/Wumpf>@wumpf</a> for trailblazing this work in the excellent <a href=https://github.com/Wumpf/wgpu-profiler>wgpu-profiler</a> tool, and demonstrating how to wire [wgpu] and <a href=https://github.com/wolfpld/tracy>tracy</a> together.<h2 id=trait-tags-on-docs-rs>Trait Tags on docs.rs <a class=anchor-link href=#trait-tags-on-docs-rs>#</a></h2><div class=heading-meta><div><span class=heading-meta__title>Authors:</span><a class=heading-meta__item href=https://github.com/SpecificProtagonist>@SpecificProtagonist</a>, <a class=heading-meta__item href=https://github.com/Jondolf>@Jondolf</a></div><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17758>#17758</a></div></div><p>Bevy provides several core traits that define how a type is used. For example, to attach data to an entity it must implement <code>Component</code>. When reading the Rust API docs, determining whether a type is a <code>Component</code> (or some other core Bevy trait) requires scrolling through all of the docs until you find the relevant trait. But in <strong>Bevy 0.16</strong>, on docs.rs Bevy now displays labels indicating which core Bevy traits a type implements:<p><img alt='Rustdoc showing a "Component" label below "Camera" type' src=trait-tags.jpg><p>This happens for the traits <code>Plugin</code> / <code>PluginGroup</code>, <code>Component</code>, <code>Resource</code>, <code>Asset</code>, <code>Event</code>, <code>ScheduleLabel</code>, <code>SystemSet</code>, <code>SystemParam</code>, <code>Relationship</code> and <code>RelationshipTarget</code>.<p>This is done for now through <a href=https://github.com/bevyengine/bevy/tree/release-0.16.0/docs-rs>javascript</a>. This should be useful for other Rust frameworks than Bevy, and we'll work with the rustdoc team on how to make this built in and more generic. Get in touch if you're interested so we can start a specification!<h2 id=what-s-next>What's Next? <a class=anchor-link href=#what-s-next>#</a></h2><p>The features above may be great, but what else does Bevy have in flight? Peering deep into the mists of time (predictions are <em>extra</em> hard when your team is almost all volunteers!), we can see some exciting work taking shape:<ul><li><strong>A revamped observers API:</strong> Observers are incredibly popular, but come with some weird quirks. We're looking to smooth those out, and make them the easiest way to write one-off logic for UI.<li><strong>Resources-as-entities:</strong> Sure would be nice if hooks, observers, relations and more worked with resources. Rather than duplicating all of the code, we'd like to <a href=https://github.com/bevyengine/bevy/pull/17485>make them components on singleton entities</a> under the hood.<li><strong>A .bsn file format and bsn! macro:</strong> With the foundations laid (required components, improved spawning and relations!), it's time to build out the terse and robust Bevy-native scene format (and matching macro) described in <a href=https://github.com/bevyengine/bevy/discussions/14437>bevy#14437</a>.<li><strong>Light textures:</strong> Also known as "light cookies", these are great for everything from dappled sunlight to shadow boxing.<li><strong>NVIDIA Deep Learning Super Sampling:</strong> DLSS is a neural-net powered approach to temporal anti-aliasing and upscaling for NVIDIA RTX GPUs. We're working on integrating DLSS into Bevy to provide a cheaper and higher quality anti-aliasing solution than Bevy's current TAA (on supported platforms).<li><strong>Unified volumetrics system:</strong> God rays, fogs, cascading shadow maps, and atmospheric scattering: there's a huge number of rendering features that fundamentally care about the optical properties of volumes of open air (or water!). We're hoping to unify and extend these features for easier to use, more beautiful physically-based rendering.<li><strong>Ray-tracing foundations:</strong> Hardware-accelerated ray-tracing is all the rage, and with <code>wgpu</code>'s help we're ready to start making the first steps, walking towards a world of dynamic ray-traced global illumination.<li><strong>More game-focused examples:</strong> New users continue to flock to Bevy, and need up-to-date learning materials. Our API-focused approach to examples isn't enough: we need to start demonstrating how to use Bevy to do common game dev tasks like making an inventory, saving user preferences or placing structures on a map.</ul><h2 id=support-bevy>Support Bevy <a class=anchor-link href=#support-bevy>#</a></h2><p>Bevy will always be free and open-source, but it isn't free to make! Because Bevy is free, we rely on the generosity of the Bevy community to fund our efforts. If you are a happy user of Bevy or you believe in our mission, please consider <a href=/donate>donating to the Bevy Foundation</a>... every bit helps!<p><a class="button button--pink" href=/donate>Donate <img alt="heart icon" class=button__icon src=/assets/heart.svg></a><h2 id=contributors>Contributors <a class=anchor-link href=#contributors>#</a></h2><p>A huge thanks to the 261 contributors that made this release (and associated docs) possible! In random order:<ul class=contributors><li>@jpbloom<li>@Nathan-Fenner<li>@lomirus<li>@MiniaczQ<li>@scottmcm<li>@hjklchan<li>@onkoe<li>@spectria-limina<li>@MinerSebas<li>@inodentry<li>@jakkos-net<li>@Emmet-v15<li>@Brezak<li>@joshua-holmes<li>@VictorElHajj<li>@cxreiff<li>@msvbg<li>@bjoernp116<li>@stepancheg<li>@copygirl<li>@brianreavis<li>@eugineerd<li>@kristoff3r<li>@jnhyatt<li>@benfrankel<li>@AlephCubed<li>@atornity<li>@szepeviktor<li>@urben1680<li>@globin<li>@jakobhellermann<li>@mysteriouslyseeing<li>@fjkorf<li>@superdump<li>@DasLixou<li>@dmyyy<li>@PPakalns<li>@AustinHellerRepo<li>@skimmedsquare<li>@andresovela<li>@aloucks<li>@lynn-lumen<li>@yrns<li>@krunchington<li>@akimakinai<li>@s-puig<li>@madsmtm<li>@Arend-Jan<li>@tbillington<li>@xuwaters<li>@couyit<li>@ilyvion<li>@yonzebu<li>@Threadzless<li>@berylllium<li>@pemattern<li>@nakedible<li>@chendaohan<li>@Kees-van-Beilen<li>@cBournhonesque<li>@tychedelia<li>@clarfonthey<li>@ad-kr<li>@ChristopherBiscardi<li>@IceSentry<li>@NiklasEi<li>@Wuketuke<li>@atlv24<li>@axlitEels<li>@Leinnan<li>@chronicl<li>@aevyrie<li>@silvestrpredko<li>@JMS55<li>@sirius94<li>@dependabot[bot]<li>@robtfm<li>@tim-blackbird<li>@Shatur<li>@MarcoMeijer<li>@mockersf<li>@venhelhardt<li>@Windsdon<li>@IQuick143<li>@andrewhickman<li>@hukasu<li>@johanhelsing<li>@mate-h<li>@DaAlbrecht<li>@Knar33<li>@greeble-dev<li>@RobWalt<li>@ldubos<li>@jiangheng90<li>@Freyja-moth<li>@nicoburns<li>@TomMD<li>@Bleachfuel<li>@JaySpruce<li>@alice-i-cecile<li>@shafferchance<li>@CrushedPixel<li>@Lege19<li>@andriyDev<li>@Peepo-Juice<li>@PixelDust22<li>@theotherphil<li>@Cyborus04<li>@Satellile<li>@notmd<li>@joseph-gio<li>@bas-ie<li>@GuillaumeGomez<li>@Vrixyz<li>@to-bak<li>@Jondolf<li>@ItsDoot<li>@alex5nader<li>@musjj<li>@MrGVSV<li>@bytemunch<li>@JeanMertz<li>@ickshonpe<li>@GglLfr<li>@inact1v1ty<li>@colepoirier<li>@TurtIeSocks<li>@villor<li>@OwlyCode<li>@Sorseg<li>@UkoeHB<li>@mwcampbell<li>@Henauxg<li>@darthLeviN<li>@MalekiRe<li>@jatimix<li>@Noxmore<li>@NyxAlexandra<li>@mgi388<li>@SludgePhD<li>@mweatherley<li>@shuoli84<li>@lcnr<li>Threadzless<li>@JusSchw<li>@terahlunah<li>@fatho<li>@rambip<li>@mintlu8<li>@tjlaxs<li>@dbeckwith<li>@raldone01<li>@hymm<li>Freya Pines<li>@fschlee<li>@spvky<li>@arunke<li>@DGriffin91<li>@sophrosyne97<li>@SparkyPotato<li>@Zoomulator<li>@djeedai<li>@StrikeForceZero<li>@newclarityex<li>@nicopap<li>@ndarilek<li>@james-j-obrien<li>@eckz<li>@Soulghost<li>@Novakasa<li>@hocop<li>@andristarr<li>@chescock<li>@pcwalton<li>@bushrat011899<li>@mdickopp<li>@ethereumdegen<li>@Victoronz<li>@omaskery<li>@vandie<li>@RCoder01<li>@DataTriny<li>@CrazyRoka<li>@anlumo<li>@shanecelis<li>@doup<li>@Lyndon-Mackay<li>@nicholasc<li>@scvalex<li>@bash<li>@SpecificProtagonist<li>@SolarLiner<li>@foxzool<li>@SOF3<li>@Jaso333<li>@moonheart08<li>@romamik<li>@HugoPeters1024<li>@flokli<li>@harun-ibram<li>@wolf-in-space<li>@NiseVoid<li>@jf908<li>@ecoskey<li>@Friz64<li>@janis-bhm<li>@LogicFan<li>@mnmaita<li>@TimJentzsch<li>@chamaloriz<li>AxiomaticSemantics<li>@HyperCodec<li>@alphastrata<li>@Phoqinu<li>@NthTensor<li>@Azorlogh<li>@cart<li>@pin3-free<li>@younes-io<li>@LikeLakers2<li>@rendaoer<li>@vil-mo<li>@Trashtalk217<li>@rparrett<li>@purplg<li>@homersimpsons<li>@Mathspy<li>@Carter0<li>@VitalyAnkh<li>@komadori<li>@ElliottjPierce<li>@brookman<li>@Weshnaw<li>@Mclilzee<li>@boondocklabs<li>@BenjaminBrienen<li>@Sigma-dev<li>@aecsocket<li>@chompaa<li>@Wcubed<li>@SilentSpaceTraveller<li>@VictorKoenders<li>@772<li>@grind086<li>@repnop<li>@coreh<li>@eero-lehtinen<li>@EmbersArc<li>@BD103<li>@viridia<li>@Person-93<li>@attila-lin<li>@hexroll<li>@SmakoszJan<li>@LucDrenth<li>@ghost<li>@mamekoro<li>@RJ<li>@super-saturn<li>@nandee95<li>@Kanabenki</ul><p>For those interested in a complete changelog, you can see the entire log (and linked pull requests) via the <a href=https://github.com/bevyengine/bevy/compare/v0.15.0...v0.16.0-rc.5>relevant commit history</a>.</div><script type=module>import{enable_image_compare as a}from"/components.js";document.addEventListener(`DOMContentLoaded`,(()=>{a()}))</script></div></div></div></main><footer class=print:hidden><div class=footer__social-container><a class=footer__social href=https://github.com/bevyengine/bevy title=GitHub> <img alt="GitHub logo" height=24 src=/assets/github-mark-white.svg width=24> </a><a class=footer__social href=https://discord.gg/bevy title=Discord> <img alt="Discord logo" height=24 src=/assets/discord.svg width=24> </a><a class=footer__social href=https://bsky.app/profile/bevy.org title=Bluesky> <img alt="Bluesky logo" height=24 src=/assets/bluesky.svg width=24> </a><a class=footer__social href=https://mastodon.social/@bevy title=Mastodon> <img alt="Mastodon logo" height=24 src=/assets/mastodon-logo-purple.svg width=24> </a><a class=footer__social href=https://www.reddit.com/r/bevy/ title=Reddit> <img alt="Reddit logo" height=24 src=/assets/reddit.svg width=24> </a><a class=footer__social href=https://itch.io/games/tag-bevy title=itch.io> <img alt="itch.io logo" height=24 src=/assets/itchio-textless.svg width=24> </a><a title="Bevy news feed" class=footer__social href=/atom.xml> <img alt="Bevy news feed" height=24 src=/assets/feed.svg width=24> </a></div></footer></div><script>const search_params=new URLSearchParams(window.location.search);if(search_params.has(`show_drafts`)||document.cookie.indexOf(`show_drafts`)>=0){let a=`show_drafts`;if(search_params.get(a)===`0`){document.cookie=`show_drafts=;path=/;expires=Thu, 01 Jan 1970 00:00:00 UTC`}else{document.cookie=`show_drafts=1;path=/`;document.body.classList.add(a)}}</script>