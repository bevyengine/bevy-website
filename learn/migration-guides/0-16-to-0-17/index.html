<!doctype html><html class=light-mode lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="0.16 to 0.17" property=og:title><meta content=website property=og:type><meta content=https://bevy.org//learn/migration-guides/0-16-to-0-17/ property=og:url><meta content=https://bevy.org/assets/bevy_logo_fill.png property=og:image><meta content="The most important breaking changes to be aware of this release are:

Event has been split into Message (for buffered events) and Event (for observersâ€¦" property=og:description><link rel="shortcut icon" href=/assets/favicon.png type=image/png><link href=/site.css rel=stylesheet><link href=/atom.xml rel=alternate type=application/atom+xml><title>0.16 to 0.17</title><script src=/optional-helpers.js></script><script defer src=/highlight-intrapage-link.js></script><script defer src=/clipboard.js></script><body><div class=layout><input class=hidden id=mobile-menu-state type=checkbox><header class="layout__header header print:hidden" data-mobile-menu-state-container><div class=header__content><label class=main-menu-backdrop for=mobile-menu-state></label><label class="header__hamburger button-square button-square--header" for=mobile-menu-state><img alt="Three horizontal lines stacked on top of eachother" height=16 src=/assets/icon-hamburger.svg width=20></label><div class=header__left-block><a class=header__logo href=/> <picture class=logo><img alt="Bevy logo" class=logo height=130 src=/assets/bevy_logo_dark.svg width=520></picture> </a><div class=header__message>Migration Guides</div></div><input checked class=hidden id=page-menu-switch-state type=checkbox><nav class="header__menu main-menu main-menu--with-page-menu" data-page-menu-switch-state-container role=navigation><div class=main-menu__header><a href=/> <picture class=logo><img alt="Bevy Engine" class=logo height=130 src=/assets/bevy_logo_dark.svg width=520></picture> </a><label class="button-square button-square--header" for=mobile-menu-state><img alt="A saltire or x-cross" height=16 src=/assets/icon-times.svg width=16></label></div><div class=main-menu__page-menu-switch><label class=menu-switch for=page-menu-switch-state><div class="menu-switch__option menu-switch__option--main-menu">Main Menu</div> <div class="menu-switch__option menu-switch__option--page-menu">Migration Guides</div></label></div><div class=main-menu__content><div class=main-menu__page-menu><ul class=tree-menu><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/introduction/>Introduction</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-17-to-0-18/>0.17 to 0.18</a></div><li class="tree-menu__item tree-menu__item--active"><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-16-to-0-17/>0.16 to 0.17</a><nav aria-label="On This Page" class="on-this-page tree-menu__toc" data-highlight-intrapage-link><ul><li><a href=#handle-weak-has-been-replaced-by-handle-uuid>Handle::Weak has been replaced by Handle::Uuid.</a><li><a href=#deprecate-iter-entities-and-iter-entities-mut>Deprecate iter_entities and iter_entities_mut.</a><li><a href=#entityref-entitymut-and-option-disabled-no-longer-ignore-default-query-filters>EntityRef, EntityMut, and Option<&Disabled> no longer ignore default query filters</a><li><a href=#relativecursorposition-is-now-object-centered>RelativeCursorPosition is now object-centered</a><li><a href=#text2d-moved-to-bevy-sprite>Text2d moved to bevy_sprite</a><li><a href=#synccell-and-syncunsafecell-moved-to-bevy-platform>SyncCell and SyncUnsafeCell moved to bevy_platform</a><li><a href=#renamed-condition-to-systemcondition>Renamed Condition to SystemCondition</a><li><a href=#observers-and-one-shot-systems-are-now-marked-as-internal>Observers and one-shot systems are now marked as Internal</a><li><a href=#scenespawner-methods-have-been-renamed-and-replaced>SceneSpawner methods have been renamed and replaced</a><li><a href=#location-is-no-longer-a-component>Location is no longer a Component</a><li><a href=#remove-scale-value>Remove scale_value</a><li><a href=#assets-insert-and-assets-get-or-insert-with-now-return-result>Assets::insert and Assets::get_or_insert_with now return Result</a><li><a href=#enable-wayland-by-default>Enable Wayland by default</a><li><a href=#generic-option-parameter>Generic Option Parameter</a><li><a href=#stop-exposing-mp3-support-through-minimp3>Stop exposing mp3 support through minimp3</a><li><a href=#schedule-api-cleanup>Schedule API Cleanup</a><li><a href=#bevy-render-reorganization>bevy_render reorganization</a><li><a href=#rename-pointer-pressed-and-pointer-released-to-pointer-press-and-pointer-release>Rename Pointer&LTPressed> and Pointer&LTReleased> to Pointer&LTPress> and Pointer&LTRelease></a><li><a href=#yaxisorientation-has-been-removed>YAxisOrientation has been removed</a><li><a href=#renamed-timer-paused-to-timer-is-paused-and-timer-finished-to-timer-is-finished>Renamed Timer::paused to Timer::is_paused and Timer::finished to Timer::is_finished</a><li><a href=#gltf-animation-loading-is-now-optional>glTF animation loading is now optional</a><li><a href=#fixed-ui-draw-order-and-stack-z-offsets-changes>Fixed UI draw order and stack_z_offsets changes</a><li><a href=#removedcomponents-methods-renamed-to-match-event-to-message-rename>RemovedComponents methods renamed to match Event to Message rename</a><li><a href=#window-is-now-split-into-multiple-components>Window is now split into multiple components</a><li><a href=#removed-cosmic-text-re-exports>Removed cosmic_text re-exports</a><li><a href=#rename-send-event-and-similar-methods-to-write-message>Rename send_event and similar methods to write_message</a><li><a href=#move-ui-debug-options-from-bevy-ui-to-bevy-ui-render>Move UI Debug Options from bevy_ui to bevy_ui_render</a><li><a href=#clonebehavior-is-no-longer-partialeq-or-eq>CloneBehavior is no longer PartialEq or Eq</a><li><a href=#interned-labels-and-dyneq>Interned labels and DynEq</a><li><a href=#split-hdr-from-camera>Split Hdr from Camera</a><li><a href=#the-render-target-info-from-computeduitargetcamera-has-been-removed>The render target info from ComputedUiTargetCamera has been removed.</a><li><a href=#reflection-based-maps-are-now-unordered>Reflection-based maps are now unordered</a><li><a href=#rework-mergemesherror>Rework MergeMeshError</a><li><a href=#use-gltf-material-names-for-spawned-primitive-entities>Use glTF material names for spawned primitive entities</a><li><a href=#viewrangefinder3d-from-world-from-view-now-takes-affine3a-instead-of-mat4>ViewRangefinder3d::from_world_from_view now takes Affine3A instead of Mat4</a><li><a href=#original-target-of-pointer-picking-events-is-now-stored-on-observers>Original target of Pointer picking events is now stored on observers</a><li><a href=#remove-the-add-sub-impls-on-volume>Remove the Add/Sub impls on Volume</a><li><a href=#renamed-computednodetarget-and-update-ui-context-system>Renamed ComputedNodeTarget and update_ui_context_system</a><li><a href=#chromaticaberration-lut-is-now-option>ChromaticAberration LUT is now Option</a><li><a href=#extract-pointerinputplugin-members-into-pointerinputsettings>Extract PointerInputPlugin members into PointerInputSettings</a><li><a href=#dragenter-now-includes-the-dragged-entity>DragEnter now includes the dragged entity</a><li><a href=#separate-border-colors>Separate Border Colors</a><li><a href=#scrollposition-now-uses-logical-pixel-units-and-is-no-longer-overwritten-during-layout-updates>ScrollPosition now uses logical pixel units and is no longer overwritten during layout updates</a><li><a href=#combine-now-takes-an-extra-parameter>Combine now takes an extra parameter</a><li><a href=#fix-from-rot2-implementation-for-mat2>Fix From&LTRot2> implementation for Mat2</a><li><a href=#extract-pickingplugin-members-into-pickingsettings>Extract PickingPlugin members into PickingSettings</a><li><a href=#consistent-systems-naming-convention-for-system-sets>Consistent *Systems naming convention for system sets</a><li><a href=#system-run-returns-result>System::run returns Result</a><li><a href=#lightvisibilityclass-renamed-to-clustervisibilityclass>LightVisibilityClass renamed to ClusterVisibilityClass</a><li><a href=#renamed-state-scoped-entities-and-events>Renamed state scoped entities and events</a><li><a href=#renamed-justifytext-to-justify>Renamed JustifyText to Justify</a><li><a href=#remove-default-implementation-of-extend-from-iter-from-relationshipsourcecollection>Remove default implementation of extend_from_iter from RelationshipSourceCollection</a><li><a href=#animationgraph-no-longer-supports-raw-assetids>AnimationGraph no longer supports raw AssetIds</a><li><a href=#unify-observerstate-and-observer-components>Unify ObserverState and Observer components</a><li><a href=#take-extract-now-returns-dyn-fnmut-instead-of-dyn-fn>take_extract now returns dyn FnMut instead of dyn Fn</a><li><a href=#opengl-es-wgpu-backend-is-no-longer-supported-by-default>OpenGL ES wgpu backend is no longer supported by default</a><li><a href=#labeled-asset-scope-can-now-return-errors>labeled_asset_scope can now return errors</a><li><a href=#make-scrollposition-newtype-vec2>Make ScrollPosition newtype Vec2</a><li><a href=#move-cursor-related-types-from-bevy-winit-to-bevy-window>Move cursor-related types from bevy_winit to bevy_window</a><li><a href=#extracteduinode-s-stack-index-has-been-renamed-to-z-order-and-is-now-an-f32>ExtractedUiNode's stack_index has been renamed to z_order and is now an f32.</a><li><a href=#changes-to-bevy-s-system-parallelism-strategy>Changes to Bevy's system parallelism strategy</a><li><a href=#wgpu-25>wgpu 25</a><li><a href=#anchor-is-now-a-required-component-on-sprite>Anchor is now a required component on Sprite</a><li><a href=#many-render-resources-now-initialized-in-renderstartup>Many render resources now initialized in RenderStartup</a><li><a href=#gatedreader-and-gatedopener-are-now-private>GatedReader and GatedOpener are now private.</a><li><a href=#updated-glam-rand-and-getrandom-versions-with-new-failures-when-building-for-web>Updated glam, rand and getrandom versions with new failures when building for web</a><li><a href=#overflowclipbox-s-default-is-now-paddingbox>OverflowClipBox's default is now PaddingBox</a><li><a href=#event-trait-split-rename>Event trait split / Rename</a><li><a href=#deprecated-simple-executor>Deprecated Simple Executor</a><li><a href=#reflectasset-now-uses-untypedassetid-instead-of-untypedhandle>ReflectAsset now uses UntypedAssetId instead of UntypedHandle</a><li><a href=#replaced-textfont-constructor-methods-with-from-impls>Replaced TextFont constructor methods with From impls</a><li><a href=#vectorspace-implementations>VectorSpace implementations</a><li><a href=#improve-error-when-using-run-system-command-with-a-systemid-of-wrong-type>Improve error when using run_system command with a SystemId of wrong type</a><li><a href=#extract-ui-text-colors-per-glyph>Extract UI text colors per glyph</a><li><a href=#textureformat-pixel-size-now-returns-a-result>TextureFormat::pixel_size now returns a Result</a><li><a href=#entities-api-changes>Entities API changes</a><li><a href=#relationship-method-set-risky>Relationship method set_risky</a><li><a href=#unified-system-state-flag>Unified system state flag</a><li><a href=#dynamicbundle>DynamicBundle</a><li><a href=#exclusive-systems-may-not-be-used-as-observers>Exclusive systems may not be used as observers</a><li><a href=#entityclonerbuilder-split>EntityClonerBuilder Split</a> <ul><li><a href=#opt-out-variant>Opt-Out variant</a><li><a href=#opt-in-variant>Opt-In variant</a><li><a href=#common-methods>Common methods</a><li><a href=#unified-id-filtering>Unified id filtering</a><li><a href=#other-affected-apis>Other affected APIs</a></ul><li><a href=#changes-to-type-registration-for-reflection>Changes to type registration for reflection</a><li><a href=#composable-specialization>Composable Specialization</a> <ul><li><a href=#mutation-and-base-descriptors>Mutation and Base Descriptors</a><li><a href=#composing-specializers>Composing Specializers</a><li><a href=#misc-changes>Misc Changes</a><li><a href=#full-migration-example>Full Migration Example</a></ul><li><a href=#entry-enum-is-now-componententry>Entry enum is now ComponentEntry</a><li><a href=#state-scoped-entities-are-now-always-enabled-implicitly>State-scoped entities are now always enabled implicitly</a><li><a href=#required-components-refactor>Required components refactor</a><li><a href=#view-transformations-wgsl-deprecated-in-favor-of-view-wgsl>view_transformations.wgsl deprecated in favor of view.wgsl</a><li><a href=#replace-gilrs-accesskitadapters-and-winitwindows-non-send-resources>Replace Gilrs, AccessKitAdapters, and WinitWindows non-send resources</a> <ul><li><a href=#first-party-nonsend-resources-replaced>First-party NonSend Resources Replaced</a><li><a href=#nonsend-systems>NonSend Systems</a></ul><li><a href=#componentsregistrator-no-longer-implements-derefmut>ComponentsRegistrator no longer implements DerefMut</a><li><a href=#query-items-can-borrow-from-query-state>Query items can borrow from query state</a><li><a href=#non-generic-access>Non-generic Access</a><li><a href=#component-lifecycle-reorganization>Component lifecycle reorganization</a><li><a href=#polylines-and-polygons-are-no-longer-const-generic>Polylines and Polygons are no longer const-generic</a><li><a href=#changes-to-the-default-error-handler-mechanism>Changes to the default error handler mechanism</a><li><a href=#removed-deprecated-batch-spawning-methods>Removed Deprecated Batch Spawning Methods</a><li><a href=#stop-storing-access-in-systems>Stop storing access in systems</a><li><a href=#new-zstd-backend>New zstd backend</a> <ul><li><a href=#migration-guide>Migration Guide</a></ul><li><a href=#remove-archetypecomponentid>Remove ArchetypeComponentId</a><li><a href=#rendertarget-error-handling>RenderTarget error handling</a><li><a href=#renamed-brp-methods>Renamed BRP methods</a><li><a href=#taa-is-no-longer-experimental>TAA is no longer experimental</a><li><a href=#textshadow-has-been-moved-to-bevy-ui-widget-text>TextShadow has been moved to bevy::ui::widget::text</a><li><a href=#remove-bundle-register-required-components>Remove Bundle::register_required_components</a><li><a href=#observer-event-api-changes>Observer / Event API Changes</a><li><a href=#manual-entity-creation-and-representation>Manual Entity Creation and Representation</a> <ul><li><a href=#index>Index</a><li><a href=#generation>Generation</a><li><a href=#removed-interfaces>Removed Interfaces</a><li><a href=#functionality>Functionality</a><li><a href=#length-representation>Length Representation</a><li><a href=#other-kinds-of-entity-rows>Other kinds of entity rows</a></ul><li><a href=#rendertargetinfo-s-default-scale-factor-has-been-changed-to-1>RenderTargetInfo's default scale_factor has been changed to 1.</a><li><a href=#rendergraphapp-renamed-to-rendergraphext>RenderGraphApp renamed to RenderGraphExt</a><li><a href=#window-resolution-constructors>Window Resolution Constructors</a><li><a href=#specialized-ui-transform>Specialized UI transform</a><li><a href=#checkchangeticks-parameter-in-system-check-change-tick>CheckChangeTicks parameter in System::check_change_tick</a><li><a href=#transform-and-globaltransform-compute-matrix-rename>Transform and GlobalTransform::compute_matrix rename</a><li><a href=#compressed-image-saver-feature>Compressed image saver feature</a><li><a href=#change-filters-container-of-logdiagnosticsstate-to-hashset>Change filters container of LogDiagnosticsState to HashSet</a><li><a href=#fullscreen-shader-handle-replaced-with-fullscreenshader>FULLSCREEN_SHADER_HANDLE replaced with FullscreenShader</a><li><a href=#smooth-normals-implementation-changed>Smooth normals implementation changed</a><li><a href=#spawnablelist>SpawnableList</a><li><a href=#changes-to-bevy-tasks-feature-flags>Changes to bevy_tasks feature flags</a></ul></nav></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-15-to-0-16/>0.15 to 0.16</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-14-to-0-15/>0.14 to 0.15</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-13-to-0-14/>0.13 to 0.14</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-12-to-0-13/>0.12 to 0.13</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-11-to-0-12/>0.11 to 0.12</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-10-to-0-11/>0.10 to 0.11</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-9-to-0-10/>0.9 to 0.10</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-8-to-0-9/>0.8 to 0.9</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-7-to-0-8/>0.7 to 0.8</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-6-to-0-7/>0.6 to 0.7</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-5-to-0-6/>0.5 to 0.6</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-4-to-0-5/>0.4 to 0.5</a></div></ul></div><ul class=main-menu__menu><li class="main-menu__entry main-menu__entry--getting-started"><a class=main-menu__link href=/learn/quick-start/getting-started/> <span>Getting Started</span> </a><li class=main-menu__entry><a class="main-menu__link main-menu__link--active" href=/learn/> <span>Learn</span> </a><li class=main-menu__entry><a class=main-menu__link href=/news/> <span>News</span> </a><li class=main-menu__entry><a class=main-menu__link href=/community/> <span>Community</span> </a><li class=main-menu__entry><a class=main-menu__link href=/foundation/> <span>Foundation</span> </a><li class=main-menu__entry><a class=main-menu__link href=/assets/> <span>Assets</span> </a><li class=main-menu__entry><a class=main-menu__link href=/examples/> <span>Examples</span> </a></ul></div></nav><div class=header__cta-container><a class="button button--pink header__cta" href=/donate>Donate <img alt="heart icon" class=button__icon height=512 src=/assets/heart.svg width=512> </a><a class="header__cta header__cta--github" href=https://github.com/bevyengine/bevy> <img alt="GitHub repo" height=96 src=/assets/github-mark-white.svg width=98> </a></div></div></header><main class=layout__content><div class=container><div class=page-with-menu><div class="page-with-menu__menu-wrapper print:hidden"><div class=page-with-menu__menu><ul class=tree-menu><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/introduction/>Introduction</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-17-to-0-18/>0.17 to 0.18</a></div><li class="tree-menu__item tree-menu__item--active"><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-16-to-0-17/>0.16 to 0.17</a><nav aria-label="On This Page" class="on-this-page tree-menu__toc" data-highlight-intrapage-link><ul><li><a href=#handle-weak-has-been-replaced-by-handle-uuid>Handle::Weak has been replaced by Handle::Uuid.</a><li><a href=#deprecate-iter-entities-and-iter-entities-mut>Deprecate iter_entities and iter_entities_mut.</a><li><a href=#entityref-entitymut-and-option-disabled-no-longer-ignore-default-query-filters>EntityRef, EntityMut, and Option<&Disabled> no longer ignore default query filters</a><li><a href=#relativecursorposition-is-now-object-centered>RelativeCursorPosition is now object-centered</a><li><a href=#text2d-moved-to-bevy-sprite>Text2d moved to bevy_sprite</a><li><a href=#synccell-and-syncunsafecell-moved-to-bevy-platform>SyncCell and SyncUnsafeCell moved to bevy_platform</a><li><a href=#renamed-condition-to-systemcondition>Renamed Condition to SystemCondition</a><li><a href=#observers-and-one-shot-systems-are-now-marked-as-internal>Observers and one-shot systems are now marked as Internal</a><li><a href=#scenespawner-methods-have-been-renamed-and-replaced>SceneSpawner methods have been renamed and replaced</a><li><a href=#location-is-no-longer-a-component>Location is no longer a Component</a><li><a href=#remove-scale-value>Remove scale_value</a><li><a href=#assets-insert-and-assets-get-or-insert-with-now-return-result>Assets::insert and Assets::get_or_insert_with now return Result</a><li><a href=#enable-wayland-by-default>Enable Wayland by default</a><li><a href=#generic-option-parameter>Generic Option Parameter</a><li><a href=#stop-exposing-mp3-support-through-minimp3>Stop exposing mp3 support through minimp3</a><li><a href=#schedule-api-cleanup>Schedule API Cleanup</a><li><a href=#bevy-render-reorganization>bevy_render reorganization</a><li><a href=#rename-pointer-pressed-and-pointer-released-to-pointer-press-and-pointer-release>Rename Pointer&LTPressed> and Pointer&LTReleased> to Pointer&LTPress> and Pointer&LTRelease></a><li><a href=#yaxisorientation-has-been-removed>YAxisOrientation has been removed</a><li><a href=#renamed-timer-paused-to-timer-is-paused-and-timer-finished-to-timer-is-finished>Renamed Timer::paused to Timer::is_paused and Timer::finished to Timer::is_finished</a><li><a href=#gltf-animation-loading-is-now-optional>glTF animation loading is now optional</a><li><a href=#fixed-ui-draw-order-and-stack-z-offsets-changes>Fixed UI draw order and stack_z_offsets changes</a><li><a href=#removedcomponents-methods-renamed-to-match-event-to-message-rename>RemovedComponents methods renamed to match Event to Message rename</a><li><a href=#window-is-now-split-into-multiple-components>Window is now split into multiple components</a><li><a href=#removed-cosmic-text-re-exports>Removed cosmic_text re-exports</a><li><a href=#rename-send-event-and-similar-methods-to-write-message>Rename send_event and similar methods to write_message</a><li><a href=#move-ui-debug-options-from-bevy-ui-to-bevy-ui-render>Move UI Debug Options from bevy_ui to bevy_ui_render</a><li><a href=#clonebehavior-is-no-longer-partialeq-or-eq>CloneBehavior is no longer PartialEq or Eq</a><li><a href=#interned-labels-and-dyneq>Interned labels and DynEq</a><li><a href=#split-hdr-from-camera>Split Hdr from Camera</a><li><a href=#the-render-target-info-from-computeduitargetcamera-has-been-removed>The render target info from ComputedUiTargetCamera has been removed.</a><li><a href=#reflection-based-maps-are-now-unordered>Reflection-based maps are now unordered</a><li><a href=#rework-mergemesherror>Rework MergeMeshError</a><li><a href=#use-gltf-material-names-for-spawned-primitive-entities>Use glTF material names for spawned primitive entities</a><li><a href=#viewrangefinder3d-from-world-from-view-now-takes-affine3a-instead-of-mat4>ViewRangefinder3d::from_world_from_view now takes Affine3A instead of Mat4</a><li><a href=#original-target-of-pointer-picking-events-is-now-stored-on-observers>Original target of Pointer picking events is now stored on observers</a><li><a href=#remove-the-add-sub-impls-on-volume>Remove the Add/Sub impls on Volume</a><li><a href=#renamed-computednodetarget-and-update-ui-context-system>Renamed ComputedNodeTarget and update_ui_context_system</a><li><a href=#chromaticaberration-lut-is-now-option>ChromaticAberration LUT is now Option</a><li><a href=#extract-pointerinputplugin-members-into-pointerinputsettings>Extract PointerInputPlugin members into PointerInputSettings</a><li><a href=#dragenter-now-includes-the-dragged-entity>DragEnter now includes the dragged entity</a><li><a href=#separate-border-colors>Separate Border Colors</a><li><a href=#scrollposition-now-uses-logical-pixel-units-and-is-no-longer-overwritten-during-layout-updates>ScrollPosition now uses logical pixel units and is no longer overwritten during layout updates</a><li><a href=#combine-now-takes-an-extra-parameter>Combine now takes an extra parameter</a><li><a href=#fix-from-rot2-implementation-for-mat2>Fix From&LTRot2> implementation for Mat2</a><li><a href=#extract-pickingplugin-members-into-pickingsettings>Extract PickingPlugin members into PickingSettings</a><li><a href=#consistent-systems-naming-convention-for-system-sets>Consistent *Systems naming convention for system sets</a><li><a href=#system-run-returns-result>System::run returns Result</a><li><a href=#lightvisibilityclass-renamed-to-clustervisibilityclass>LightVisibilityClass renamed to ClusterVisibilityClass</a><li><a href=#renamed-state-scoped-entities-and-events>Renamed state scoped entities and events</a><li><a href=#renamed-justifytext-to-justify>Renamed JustifyText to Justify</a><li><a href=#remove-default-implementation-of-extend-from-iter-from-relationshipsourcecollection>Remove default implementation of extend_from_iter from RelationshipSourceCollection</a><li><a href=#animationgraph-no-longer-supports-raw-assetids>AnimationGraph no longer supports raw AssetIds</a><li><a href=#unify-observerstate-and-observer-components>Unify ObserverState and Observer components</a><li><a href=#take-extract-now-returns-dyn-fnmut-instead-of-dyn-fn>take_extract now returns dyn FnMut instead of dyn Fn</a><li><a href=#opengl-es-wgpu-backend-is-no-longer-supported-by-default>OpenGL ES wgpu backend is no longer supported by default</a><li><a href=#labeled-asset-scope-can-now-return-errors>labeled_asset_scope can now return errors</a><li><a href=#make-scrollposition-newtype-vec2>Make ScrollPosition newtype Vec2</a><li><a href=#move-cursor-related-types-from-bevy-winit-to-bevy-window>Move cursor-related types from bevy_winit to bevy_window</a><li><a href=#extracteduinode-s-stack-index-has-been-renamed-to-z-order-and-is-now-an-f32>ExtractedUiNode's stack_index has been renamed to z_order and is now an f32.</a><li><a href=#changes-to-bevy-s-system-parallelism-strategy>Changes to Bevy's system parallelism strategy</a><li><a href=#wgpu-25>wgpu 25</a><li><a href=#anchor-is-now-a-required-component-on-sprite>Anchor is now a required component on Sprite</a><li><a href=#many-render-resources-now-initialized-in-renderstartup>Many render resources now initialized in RenderStartup</a><li><a href=#gatedreader-and-gatedopener-are-now-private>GatedReader and GatedOpener are now private.</a><li><a href=#updated-glam-rand-and-getrandom-versions-with-new-failures-when-building-for-web>Updated glam, rand and getrandom versions with new failures when building for web</a><li><a href=#overflowclipbox-s-default-is-now-paddingbox>OverflowClipBox's default is now PaddingBox</a><li><a href=#event-trait-split-rename>Event trait split / Rename</a><li><a href=#deprecated-simple-executor>Deprecated Simple Executor</a><li><a href=#reflectasset-now-uses-untypedassetid-instead-of-untypedhandle>ReflectAsset now uses UntypedAssetId instead of UntypedHandle</a><li><a href=#replaced-textfont-constructor-methods-with-from-impls>Replaced TextFont constructor methods with From impls</a><li><a href=#vectorspace-implementations>VectorSpace implementations</a><li><a href=#improve-error-when-using-run-system-command-with-a-systemid-of-wrong-type>Improve error when using run_system command with a SystemId of wrong type</a><li><a href=#extract-ui-text-colors-per-glyph>Extract UI text colors per glyph</a><li><a href=#textureformat-pixel-size-now-returns-a-result>TextureFormat::pixel_size now returns a Result</a><li><a href=#entities-api-changes>Entities API changes</a><li><a href=#relationship-method-set-risky>Relationship method set_risky</a><li><a href=#unified-system-state-flag>Unified system state flag</a><li><a href=#dynamicbundle>DynamicBundle</a><li><a href=#exclusive-systems-may-not-be-used-as-observers>Exclusive systems may not be used as observers</a><li><a href=#entityclonerbuilder-split>EntityClonerBuilder Split</a> <ul><li><a href=#opt-out-variant>Opt-Out variant</a><li><a href=#opt-in-variant>Opt-In variant</a><li><a href=#common-methods>Common methods</a><li><a href=#unified-id-filtering>Unified id filtering</a><li><a href=#other-affected-apis>Other affected APIs</a></ul><li><a href=#changes-to-type-registration-for-reflection>Changes to type registration for reflection</a><li><a href=#composable-specialization>Composable Specialization</a> <ul><li><a href=#mutation-and-base-descriptors>Mutation and Base Descriptors</a><li><a href=#composing-specializers>Composing Specializers</a><li><a href=#misc-changes>Misc Changes</a><li><a href=#full-migration-example>Full Migration Example</a></ul><li><a href=#entry-enum-is-now-componententry>Entry enum is now ComponentEntry</a><li><a href=#state-scoped-entities-are-now-always-enabled-implicitly>State-scoped entities are now always enabled implicitly</a><li><a href=#required-components-refactor>Required components refactor</a><li><a href=#view-transformations-wgsl-deprecated-in-favor-of-view-wgsl>view_transformations.wgsl deprecated in favor of view.wgsl</a><li><a href=#replace-gilrs-accesskitadapters-and-winitwindows-non-send-resources>Replace Gilrs, AccessKitAdapters, and WinitWindows non-send resources</a> <ul><li><a href=#first-party-nonsend-resources-replaced>First-party NonSend Resources Replaced</a><li><a href=#nonsend-systems>NonSend Systems</a></ul><li><a href=#componentsregistrator-no-longer-implements-derefmut>ComponentsRegistrator no longer implements DerefMut</a><li><a href=#query-items-can-borrow-from-query-state>Query items can borrow from query state</a><li><a href=#non-generic-access>Non-generic Access</a><li><a href=#component-lifecycle-reorganization>Component lifecycle reorganization</a><li><a href=#polylines-and-polygons-are-no-longer-const-generic>Polylines and Polygons are no longer const-generic</a><li><a href=#changes-to-the-default-error-handler-mechanism>Changes to the default error handler mechanism</a><li><a href=#removed-deprecated-batch-spawning-methods>Removed Deprecated Batch Spawning Methods</a><li><a href=#stop-storing-access-in-systems>Stop storing access in systems</a><li><a href=#new-zstd-backend>New zstd backend</a> <ul><li><a href=#migration-guide>Migration Guide</a></ul><li><a href=#remove-archetypecomponentid>Remove ArchetypeComponentId</a><li><a href=#rendertarget-error-handling>RenderTarget error handling</a><li><a href=#renamed-brp-methods>Renamed BRP methods</a><li><a href=#taa-is-no-longer-experimental>TAA is no longer experimental</a><li><a href=#textshadow-has-been-moved-to-bevy-ui-widget-text>TextShadow has been moved to bevy::ui::widget::text</a><li><a href=#remove-bundle-register-required-components>Remove Bundle::register_required_components</a><li><a href=#observer-event-api-changes>Observer / Event API Changes</a><li><a href=#manual-entity-creation-and-representation>Manual Entity Creation and Representation</a> <ul><li><a href=#index>Index</a><li><a href=#generation>Generation</a><li><a href=#removed-interfaces>Removed Interfaces</a><li><a href=#functionality>Functionality</a><li><a href=#length-representation>Length Representation</a><li><a href=#other-kinds-of-entity-rows>Other kinds of entity rows</a></ul><li><a href=#rendertargetinfo-s-default-scale-factor-has-been-changed-to-1>RenderTargetInfo's default scale_factor has been changed to 1.</a><li><a href=#rendergraphapp-renamed-to-rendergraphext>RenderGraphApp renamed to RenderGraphExt</a><li><a href=#window-resolution-constructors>Window Resolution Constructors</a><li><a href=#specialized-ui-transform>Specialized UI transform</a><li><a href=#checkchangeticks-parameter-in-system-check-change-tick>CheckChangeTicks parameter in System::check_change_tick</a><li><a href=#transform-and-globaltransform-compute-matrix-rename>Transform and GlobalTransform::compute_matrix rename</a><li><a href=#compressed-image-saver-feature>Compressed image saver feature</a><li><a href=#change-filters-container-of-logdiagnosticsstate-to-hashset>Change filters container of LogDiagnosticsState to HashSet</a><li><a href=#fullscreen-shader-handle-replaced-with-fullscreenshader>FULLSCREEN_SHADER_HANDLE replaced with FullscreenShader</a><li><a href=#smooth-normals-implementation-changed>Smooth normals implementation changed</a><li><a href=#spawnablelist>SpawnableList</a><li><a href=#changes-to-bevy-tasks-feature-flags>Changes to bevy_tasks feature flags</a></ul></nav></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-15-to-0-16/>0.15 to 0.16</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-14-to-0-15/>0.14 to 0.15</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-13-to-0-14/>0.13 to 0.14</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-12-to-0-13/>0.12 to 0.13</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-11-to-0-12/>0.11 to 0.12</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-10-to-0-11/>0.10 to 0.11</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-9-to-0-10/>0.9 to 0.10</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-8-to-0-9/>0.8 to 0.9</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-7-to-0-8/>0.7 to 0.8</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-6-to-0-7/>0.6 to 0.7</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-5-to-0-6/>0.5 to 0.6</a></div><li class=tree-menu__item><div class=tree-menu__label><a class=tree-menu__link href=/learn/migration-guides/0-4-to-0-5/>0.4 to 0.5</a></div></ul></div></div><div class=page-with-menu__content><div class=docs-page><div class=docs-content><h1>Migration Guide: 0.16 to 0.17</h1><div class=media-content><p>The most important breaking changes to be aware of this release are:<ul><li><code>Event</code> has been split into <code>Message</code> (for buffered events) and <code>Event</code> (for observers) <ul><li>see <a href=https://bevy.org/learn/migration-guides/0-16-to-0-17/#event-trait-split-rename><code>Event</code> trait split / Rename</a></ul><li>various methods, types and calling patterns around observers have been renamed or slightly tweaked <ul><li>see <a href=https://bevy.org/learn/migration-guides/0-16-to-0-17/#observer-event-api-changes>Observer / Event API Changes</a></ul><li>many rendering related types have been moved to new crates as we've attempted to improve modularity, code organization and compile times <ul><li>see <a href=https://bevy.org/learn/migration-guides/0-16-to-0-17/#bevy-render-reorganization><code>bevy_render</code> reorganization</a></ul><li>web builds now require additional boilerplate in the form of a special <code>RUSTFLAGS</code> environment variable due to upstream changes in <code>getrandom</code> <ul><li>see <a href=https://bevy.org/learn/migration-guides/0-16-to-0-17/#updated-glam-rand-and-getrandom-versions-with-new-failures-when-building-for-web>Updated <code>glam</code>, <code>rand</code> and <code>getrandom</code> versions with new failures when building for web</a></ul><li>many systems sets have been renamed, standardizing on a <code>*Systems</code> naming convention <ul><li>see <a href=https://bevy.org/learn/migration-guides/0-16-to-0-17/#consistent-systems-naming-convention-for-system-sets>Consistent <code>*Systems</code> naming convention for system sets</a></ul></ul><p>For a full list of changes that may require migration, please see below. We recommend keeping this page open as you migrate your code base, and searching within it for any issues you encounter.<p>If you run into a problem while migrating that was not covered by this migration guide, please open an issue on the <a href=https://github.com/bevyengine/bevy-website><code>bevy-website</code></a> repo or file a PR directly with the correct migration advice.<h3 id=handle-weak-has-been-replaced-by-handle-uuid><code>Handle::Weak</code> has been replaced by <code>Handle::Uuid</code>. <a class=anchor-link href=#handle-weak-has-been-replaced-by-handle-uuid>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19896>#19896</a></div></div><p><code>Handle::Weak</code> had some weird behavior. It allowed for a sprite to be given a handle that is dropped <strong>while the sprite is still using it</strong>. This also resulted in more complexity in the asset system. The primary remaining use for <code>Handle::Weak</code> is to store asset UUIDs initialized through the <code>weak_handle!</code> macro. To address this, <code>Handle::Weak</code> has been replaced by <code>Handle::Uuid</code>!<p>Users using the <code>weak_handle!</code> macro should switch to the <code>uuid_handle!</code> macro.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Before
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">const</span> <span class="z-constant z-other z-rust">IMAGE</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Handle<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Image<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-macro z-rust">weak_handle!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>b20988e9-b1b9-4176-b5f3-a6fa73aa617f<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> After
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">const</span> <span class="z-constant z-other z-rust">IMAGE</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Handle<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Image<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-macro z-rust">uuid_handle!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>b20988e9-b1b9-4176-b5f3-a6fa73aa617f<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Users using <code>Handle::clone_weak</code> can (most likely) just call <code>Handle::clone</code> instead.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Somewhere in some startup system.
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> my_sprite_image <span class="z-keyword z-operator z-assignment z-rust">=</span> asset_server<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">load</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>monster.png<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> In game code...
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This sprite could be unloaded even if the sprite is still using it!
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Sprite<span class="z-punctuation z-accessor z-rust">::</span></span>from_image<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>my_sprite_image<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone_weak</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Just do this instead!
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">Sprite<span class="z-punctuation z-accessor z-rust">::</span></span>from_image<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>my_sprite_image<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Users using the <code>Handle::Weak</code> variant directly should consider replacing it with <code>AssetId</code> instead, accessible through <code>Handle::id</code>. These situations are very case-by-case migrations.<p>P.S., for users of the <code>weak_handle!</code> macro: If you are using it for shaders, consider switching to <code>load_shader_library</code>/<code>load_embedded_asset</code> instead (especially replacing <code>load_internal_asset</code>). This enables hot reloading for your shaders - which Bevy internally has done this cycle!<h3 id=deprecate-iter-entities-and-iter-entities-mut>Deprecate <code>iter_entities</code> and <code>iter_entities_mut</code>. <a class=anchor-link href=#deprecate-iter-entities-and-iter-entities-mut>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20260>#20260</a></div></div><p>In Bevy 0.17.0 we deprecate <code>world.iter_entities()</code> and <code>world.iter_entities_mut()</code>. Use <code>world.query::&LTEntityMut>().iter(&world)</code> and <code>world.query::&LTEntityRef>().iter(&mut world)</code> instead.<p>This may not return every single entity, because of <a href=https://docs.rs/bevy/latest/bevy/ecs/entity_disabling/index.html>default filter queries</a>. If you really intend to query disabled entities too, consider removing the <code>DefaultQueryFilters</code> resource from the world before querying the elements. You can also add an <code>Allow&LTComponent></code> filter to allow a specific disabled <code>Component</code> to show up in the query.<h3 id=entityref-entitymut-and-option-disabled-no-longer-ignore-default-query-filters><code>EntityRef</code>, <code>EntityMut</code>, and <code>Option<&Disabled></code> no longer ignore default query filters <a class=anchor-link href=#entityref-entitymut-and-option-disabled-no-longer-ignore-default-query-filters>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20163>#20163</a></div></div><p>Previously, <code>Query&LTEntityRef></code> would include entities with a <code>Disabled</code> component, even though queries like <code>Query&LTEntity></code> and <code>Query<()></code> would not. To make this more consistent, <code>EntityRef</code> and <code>EntityMut</code> no longer disable all default query filters. As a side-effect, <code>Option<&Disabled></code> will <em>also</em> no longer disable a default query filter.<p>If you want to include entities with a default query filter like <code>Disabled</code>, you will need to add an <code>Allows&LTDisabled></code> query filter or a <code>Has&LTDisabled></code> query data.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This query would include all entities, even `Disabled` ones
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">entity_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>EntityRef<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust">
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This query would include `Disabled` entities, but respect other filters
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">option_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span>Disabled<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust">
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> This dynamic query would include `Disabled` entities, but respect other filters
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"></span><span class="z-storage z-type z-rust">let</span> query <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">QueryBuilder<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Entity<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">optional</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">builder</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">        builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">data<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span>CustomDisabled<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">build</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Now we need to explicitly allow `Disabled` entities if we want to query them
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">entity_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>EntityRef, <span class="z-meta z-generic z-rust">Allows<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Disabled<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust">
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Consider replacing `Option<&Disabled>` with `Has&LTDisabled>`
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">option_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">Has<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Disabled<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust">
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Dynamic queries can also use `Allows` to include `Disabled` entities
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"></span><span class="z-storage z-type z-rust">let</span> query <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">QueryBuilder<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Entity<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">filter<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">Allows<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>CustomDisabled<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">build</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=relativecursorposition-is-now-object-centered><code>RelativeCursorPosition</code> is now object-centered <a class=anchor-link href=#relativecursorposition-is-now-object-centered>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16615>#16615</a></div></div><p>When picking objects, <code>RelativeCursorPosition</code>'s coordinates are now object-centered with (0,0) at the center of the node and the corners at (Â±0.5, Â±0.5). Its <code>normalized_visible_node_rect</code> field has been removed and replaced with a new <code>cursor_over: bool</code> field which is set to true when the cursor is hovering a visible section of the UI node.<h3 id=text2d-moved-to-bevy-sprite><code>Text2d</code> moved to <code>bevy_sprite</code> <a class=anchor-link href=#text2d-moved-to-bevy-sprite>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20594>#20594</a></div></div><p>The world-space text types <code>Text2d</code> and <code>Text2dShadow</code> have been moved to the <code>bevy_sprite</code> crate, along with their associated systems. Import them directly or from <code>bevy::sprite</code> now.<h3 id=synccell-and-syncunsafecell-moved-to-bevy-platform><code>SyncCell</code> and <code>SyncUnsafeCell</code> moved to bevy_platform <a class=anchor-link href=#synccell-and-syncunsafecell-moved-to-bevy-platform>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19305>#19305</a></div></div><p><code>bevy_utils::synccell::SyncCell</code> is now <code>bevy_platform::cell::SyncCell</code> <code>bevy_utils::syncunsafecell::SyncUnsafeCell</code> is now <code>bevy_platform::cell::SyncUnsafeCell</code><h3 id=renamed-condition-to-systemcondition>Renamed <code>Condition</code> to <code>SystemCondition</code> <a class=anchor-link href=#renamed-condition-to-systemcondition>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19328>#19328</a></div></div><p>The <code>Condition</code> trait is now called <code>SystemCondition</code>. Replace all references and imports.<p>This change was made because <code>Condition</code> is an overly generic name that collides too often and is rarely used directly, despite appearing in the prelude.<h3 id=observers-and-one-shot-systems-are-now-marked-as-internal>Observers and one-shot systems are now marked as <code>Internal</code> <a class=anchor-link href=#observers-and-one-shot-systems-are-now-marked-as-internal>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20204>#20204</a></div></div><p>Bevy 0.17 introduces internal entities. Entities tagged by the <code>Internal</code> component that are hidden from most queries using <a href=https://docs.rs/bevy/latest/bevy/ecs/entity_disabling/index.html><code>DefaultQueryFilters</code></a>.<p>Currently, both <a href=https://docs.rs/bevy/latest/bevy/ecs/observer/struct.Observer.html><code>Observer</code>s</a> and systems that are registered through <a href=https://docs.rs/bevy/latest/bevy/prelude/struct.World.html#method.register_system><code>World::register_system</code></a> are considered internal entities.<p>If you queried them before, add the <code>Allow&LTInternal></code> filter to the query to bypass the default filter.<h3 id=scenespawner-methods-have-been-renamed-and-replaced><code>SceneSpawner</code> methods have been renamed and replaced <a class=anchor-link href=#scenespawner-methods-have-been-renamed-and-replaced>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18358>#18358</a></div></div><p>Some methods on <code>SceneSpawner</code> have been renamed: - <code>despawn</code> -> <code>despawn_dynamic</code> - <code>despawn_sync</code> -> <code>despawn_dynamic_sync</code> - <code>update_spawned_scenes</code> -> <code>update_spawned_dynamic_scenes</code><p>In their place, we've added <code>despawn</code>, <code>despawn_sync</code>, and <code>update_spawned_scenes</code> which all act on <code>Scene</code>s (as opposed to <code>DynamicScene</code>s).<h3 id=location-is-no-longer-a-component><code>Location</code> is no longer a <code>Component</code> <a class=anchor-link href=#location-is-no-longer-a-component>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19306>#19306</a></div></div><p><code>bevy_picking::Location</code> was erroneously made a <code>Component</code>. It is no longer one. <code>bevy_picking::PointerLocation</code> wraps a <code>Location</code> and is the component you should be using instead.<h3 id=remove-scale-value>Remove <code>scale_value</code> <a class=anchor-link href=#remove-scale-value>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19143>#19143</a></div></div><p>The <code>scale_value</code> function from <code>bevy::text::text2d</code> has been removed. Multiply by the scale factor instead.<h3 id=assets-insert-and-assets-get-or-insert-with-now-return-result><code>Assets::insert</code> and <code>Assets::get_or_insert_with</code> now return <code>Result</code> <a class=anchor-link href=#assets-insert-and-assets-get-or-insert-with-now-return-result>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20439>#20439</a></div></div><p>In previous versions of Bevy, there was a bug where inserting an asset into an <code>AssetId</code> whose handle was dropped would result in a panic. Now this is an error! Calling <code>Assets::insert</code> and <code>Assets::get_or_insert_with</code> returns an error you can inspect.<p>To match the previous behavior, just <code>unwrap()</code> the result.<h3 id=enable-wayland-by-default>Enable Wayland by default <a class=anchor-link href=#enable-wayland-by-default>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19232>#19232</a></div></div><p>Wayland has now been added to the default features of the <code>bevy</code> crate.<pre class=z-code><code><span class="z-text z-plain">  called `Result::unwrap()` on an `Err` value:
</span><span class="z-text z-plain">  pkg-config exited with status code 1
</span><span class="z-text z-plain">  > PKG_CONFIG_ALLOW_SYSTEM_LIBS=1 PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=1 pkg-config --libs --cflags wayland-client
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">  The system library `wayland-client` required by crate `wayland-sys` was not found.
</span><span class="z-text z-plain">  The file `wayland-client.pc` needs to be installed and the PKG_CONFIG_PATH environment variable must contain its parent directory.
</span><span class="z-text z-plain">  The PKG_CONFIG_PATH environment variable is not set.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">  HINT: if you have installed the library, try setting PKG_CONFIG_PATH to the directory containing `wayland-client.pc`.
</span></code></pre><p>If you've encountered an error message similar to the one above, this means that you will want to make the <code>wayland-client</code> library available to your build system, or disable default features, in order to successfully build Bevy on Linux.<p>On Ubuntu, or other Debian-based distributions, install the <code>libwayland-dev</code> package:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt install libwayland-dev</span>
</span></code></pre><p>On Arch Linux:<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> pacman<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>S</span> wayland</span>
</span></code></pre><p>On Nix, add the <code>wayland</code> package to your <code>buildInputs</code>:<pre class="language-nix z-code" data-lang=nix><code class=language-nix data-lang=nix><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">buildInputs</span> <span class="z-invalid z-illegal">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">wayland</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-invalid z-illegal">;</span>
</span></code></pre><h3 id=generic-option-parameter>Generic <code>Option</code> Parameter <a class=anchor-link href=#generic-option-parameter>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18766>#18766</a></div></div><p><code>Option&LTSingle&LTD, F>></code> will now resolve to <code>None</code> if there are multiple entities matching the query. Previously, it would only resolve to <code>None</code> if there were no entities, and would skip the system if there were multiple.<p>We have introduced a blanket <code>impl SystemParam for Option</code> that resolves to <code>None</code> if the parameter is invalid. This allows third-party system parameters to work with <code>Option</code>, and makes the behavior more consistent.<p>If you want a system to run when there are no matching entities but skip when there are multiple, you will need to use <code>Query&LTD, F></code> and call <code>single()</code> yourself.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">my_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">single</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">Single<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span>Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">my_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span>Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> result <span class="z-keyword z-operator z-assignment z-rust">=</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">single</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">if</span> <span class="z-support z-macro z-rust">matches!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>result<span class="z-punctuation z-separator z-rust">,</span> <span class="z-support z-type z-rust">Err</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>QuerySingleError<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>MultipleEntities<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">_</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-control z-rust">return</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> single<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span>Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> result<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h3 id=stop-exposing-mp3-support-through-minimp3>Stop exposing mp3 support through minimp3 <a class=anchor-link href=#stop-exposing-mp3-support-through-minimp3>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20183>#20183</a></div></div><p>The <code>minimp3</code> feature is no longer exposed from Bevy. Bevy still supports mp3 through the <code>mp3</code> feature.<p>If you were relying on something specific to <code>minimp3</code>, you can still enable it by adding a dependency to <code>rodio</code> with the <code>minimp3</code> feature:<pre class="language-toml z-code" data-lang=toml><code class=language-toml data-lang=toml><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">dependencies</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">rodio</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>0.20<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-array z-begin z-toml">[</span><span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>minimp3<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-definition z-array z-end z-toml">]</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span></code></pre><p>This is best to avoid though, as <code>minimp3</code> is not actively maintained, doesn't work in wasm, has been known to cause application rejection from the Apple App Store, and has a few security vulnerabilities.<h3 id=schedule-api-cleanup>Schedule API Cleanup <a class=anchor-link href=#schedule-api-cleanup>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19352>#19352</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20119>#20119</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20172>#20172</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20256>#20256</a></div></div><p>In order to support removing systems from schedules, <code>Vec</code>s storing <code>System</code>s and <code>SystemSet</code>s have been replaced with <code>SlotMap</code>s which allow safely removing nodes and reusing indices. The maps are respectively keyed by <code>SystemKey</code>s and <code>SystemSetKey</code>s.<p>The following signatures were changed:<ul><li><code>DiGraph</code> and <code>UnGraph</code> now have an additional, required type parameter <code>N</code>, which is a <code>GraphNodeId</code>. Use <code>DiGraph&LTNodeId></code>/<code>UnGraph&LTNodeId></code> for the equivalent to the previous type.<li><code>NodeId::System</code>: Now stores a <code>SystemKey</code> instead of a plain <code>usize</code><li><code>NodeId::Set</code>: Now stores a <code>SystemSetKey</code> instead of a plain <code>usize</code><li><code>ScheduleBuildPass::collapse_set</code>: Now takes the type-specific keys. Wrap them back into a <code>NodeId</code> if necessary.<li><code>ScheduleBuildPass::build</code>: Now takes a <code>DiGraph&LTSystemKey></code> instead of <code>DiGraph&LTNodeId></code>. Re-wrap the keys back into <code>NodeId</code> if necessary.<li>The following functions now return the type-specific keys. Wrap them back into a <code>NodeId</code> if necessary. <ul><li><code>Schedule::systems</code><li><code>ScheduleGraph::conflicting_systems</code></ul><li><code>ScheduleBuildError</code> variants now contain <code>NodeId</code> or type-specific keys, rather than <code>String</code>s. Use <code>ScheduleBuildError::to_string</code> to render the nodes' names and get the old error messages.<li><code>ScheduleGraph::build_schedule</code> now returns a <code>Vec&LTScheduleBuildWarning></code> in addition to the built <code>SystemSchedule</code>. Use standard <code>Result</code> functions to grab just the <code>SystemSchedule</code>, if needed.</ul><p>The following functions were replaced. Those that took or returned <code>NodeId</code> now take or return <code>SystemKey</code> or <code>SystemSetKey</code>. Wrap/unwrap them as necessary.<ul><li><code>ScheduleGraph::contains_set</code>: Use <code>ScheduleGraph::system_sets</code> and <code>SystemSets::contains</code>.<li><code>ScheduleGraph::get_set_at</code>: Use <code>ScheduleGraph::system_sets</code> and <code>SystemSets::get</code>.<li><code>ScheduleGraph::set_at</code>: Use <code>ScheduleGraph::system_sets</code> and <code>SystemSets::index</code> (<code>system_sets[key]</code>).<li><code>ScheduleGraph::get_set_conditions_at</code>: Use <code>ScheduleGraph::system_sets</code> and <code>SystemSets::get_conditions</code>.<li><code>ScheduleGraph::system_sets</code>: Use <code>ScheduleGraph::system_sets</code> and <code>SystemSets::iter</code>.<li><code>ScheduleGraph::get_system_at</code>: Use <code>ScheduleGraph::systems</code> and <code>Systems::get</code>.<li><code>ScheduleGraph::system_at</code>: Use <code>ScheduleGraph::systems</code> and <code>Systems::index</code> (<code>systems[key]</code>).<li><code>ScheduleGraph::systems</code>: Use <code>ScheduleGraph::systems</code> and <code>Systems::iter</code>.</ul><p>The following enum variants were replaced:<ul><li><code>ScheduleBuildError::HierarchyRedundancy</code> with <code>ScheduleBuildError::Elevated(ScheduleBuildWarning::HierarchyRedundancy)</code><li><code>ScheduleBuildError::Ambiguity</code> with <code>ScheduleBuildError::Elevated(ScheduleBuildWarning::Ambiguity)</code></ul><p>The following functions were removed:<ul><li><code>NodeId::index</code>: You should match on and use the <code>SystemKey</code> and <code>SystemSetKey</code> instead.<li><code>NodeId::cmp</code>: Use the <code>PartialOrd</code> and <code>Ord</code> traits instead.<li><code>ScheduleGraph::set_conditions_at</code>: If needing to check presence of conditions, use <code>ScheduleGraph::system_sets</code> and <code>SystemSets::has_conditions</code>. Otherwise, use <code>SystemSets::get_conditions</code>.</ul><h3 id=bevy-render-reorganization><code>bevy_render</code> reorganization <a class=anchor-link href=#bevy-render-reorganization>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20485>#20485</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20330>#20330</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18703>#18703</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20587>#20587</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20502>#20502</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19997>#19997</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19991>#19991</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20000>#20000</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19949>#19949</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19943>#19943</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19953>#19953</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20498>#20498</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20496>#20496</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20493>#20493</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20492>#20492</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20491>#20491</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20488>#20488</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20487>#20487</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20486>#20486</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20483>#20483</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20480>#20480</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20479>#20479</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20478>#20478</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20477>#20477</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20473>#20473</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20472>#20472</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20471>#20471</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20470>#20470</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20392>#20392</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20390>#20390</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20388>#20388</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20345>#20345</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20344>#20344</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20051>#20051</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19985>#19985</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19973>#19973</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19965>#19965</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19963>#19963</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19962>#19962</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19960>#19960</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19959>#19959</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19958>#19958</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19957>#19957</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19956>#19956</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19955>#19955</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19954>#19954</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16620>#16620</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16619>#16619</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15700>#15700</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15666>#15666</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15650>#15650</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20778>#20778</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20857>#20857</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18323>#18323</a></div></div><p>You must now import <code>bevy_render::NormalizedRenderTargetExt</code> to use methods on <code>NormalizedRenderTarget</code> <code>ManualTextureViews</code> is now in <code>bevy_render::texture</code><p>Camera types such as <code>Camera</code>, <code>Camera3d</code>, <code>Camera2d</code>, <code>ClearColor</code>, <code>ClearColorConfig</code>, <code>Exposure</code>, <code>Projection</code>, <code>PerspectiveProjection</code>, and <code>OrthographicProjection</code> have been moved to a new crate, <code>bevy_camera</code>. Visibility types such as <code>Visibility</code>, <code>InheritedVisibility</code>, <code>ViewVisibility</code>, <code>VisibleEntities</code>, and <code>RenderLayers</code> have been moved to <code>bevy_camera::visibility</code>. Culling primitives such as <code>Frustum</code>, <code>HalfSpace</code>, <code>Aabb</code>, and <code>Sphere</code> have been moved to <code>bevy_camera::primitives</code>. Import them directly or from <code>bevy::camera</code> now.<p>Shader types such as <code>Shader</code>, <code>ShaderRef</code>, <code>ShaderDef</code>, <code>ShaderCache</code>, and <code>PipelineCompilationError</code> have been moved to a new crate, <code>bevy_shader</code>. Import them directly or from <code>bevy::shader</code> now.<p>Light types such <code>AmbientLight</code>, <code>PointLight</code>, <code>SpotLight</code>, <code>DirectionalLight</code>, <code>EnvironmentMapLight</code>, <code>GeneratedEnvironmentMapLight</code>, <code>LightProbe</code>, <code>IrradianceVolume</code>, <code>VolumetricFog</code>, <code>FogVolume</code>, <code>CascadeShadowConfigBuilder</code>, <code>NotShadowCaster</code>, <code>NotShadowReceiver</code> and <code>light_consts</code> have been moved to a new crate, <code>bevy_light</code>. Import them directly or from <code>bevy::light</code> now.<p>Mesh types such as <code>Mesh</code>, <code>Mesh3d</code>, <code>Mesh2d</code>, <code>MorphWeights</code>, <code>MeshBuilder</code>, <code>Indices</code>, and <code>Meshable</code> have been moved to a new crate, <code>bevy_mesh</code>. Import them directly or from <code>bevy::mesh</code> now. This crate is actually present in the previous release, but its <code>bevy_render</code> re-exports have now been removed.<p>Image types such as <code>Image</code>, <code>ImagePlugin</code>, <code>ImageFormat</code>, <code>ImageSampler</code>, <code>ImageAddressMode</code>, <code>ImageSamplerDescriptor</code>, <code>ImageCompareFunction</code>, and <code>ImageSamplerBorderColor</code> have been moved to a new crate, <code>bevy_image</code>. This crate is actually present in the previous release, but its <code>bevy_render</code> re-exports have now been removed. Import them directly or from <code>bevy::image</code> now.<p>Ui rendering types such as <code>MaterialNode</code>, <code>UiMaterial</code>, <code>UiMaterialKey</code>, and modules <code>bevy_ui::render</code> and <code>bevy_ui::ui_material</code> have been moved to a new crate, <code>bevy_ui_render</code>. Import them directly or from <code>bevy::ui_render</code> now. Furthermore, <code>UiPlugin</code> no longer has any fields. To control whether or not UI is rendered, enable or disable <code>UiRenderPlugin</code>, which is included in the DefaultPlugins. If you were manually enabling "bevy_ui" feature on bevy, you probably want to enable "bevy_ui_render" feature instead now if you are using rendering features.<p>Sprite rendering types such as <code>Material2d</code>, <code>Material2dPlugin</code>, <code>MeshMaterial2d</code>, <code>AlphaMode2d</code>, <code>Wireframe2d</code>, <code>TileData</code>, <code>TilemapChunk</code>, and <code>TilemapChunkTileData</code> have been moved to a new crate, <code>bevy_sprite_render</code>. Import them directly or from <code>bevy::sprite_render</code> now. If you were manually enabling "bevy_sprite" feature on bevy, you probably want to enable "bevy_sprite_render" feature instead now if you are using rendering features such as 2d gizmos.<p><code>RenderAssetUsages</code> is no longer re-exported by <code>bevy_render</code>. Import it from <code>bevy_asset</code> or <code>bevy::asset</code> instead.<p><code>bevy_core_pipeline</code> used to be home to many non-core things, including post process effects. They have now been given a new home in <code>bevy_anti_alias</code> and <code>bevy_post_process</code>.<p>If you were importing FxaaPlugin, SmaaPlugin, TemporalAntiAliasPlugin, or CasPlugin from <code>bevy_core_pipeline</code> or <code>bevy::core_pipeline</code>, you must now import them from <code>bevy_anti_alias</code> or <code>bevy::anti_alias</code>.<p>If you were importing Bloom, AutoExposure, ChromaticAberration, DepthOfField, or MotionBlur from <code>bevy_core_pipeline</code> or <code>bevy::core_pipeline</code>, you must now import them from <code>bevy_post_process</code> or <code>bevy::post_process</code>.<p>Additionally, you may now order rendering passes against the new <code>StartMainPassPostProcessing</code> node.<h3 id=rename-pointer-pressed-and-pointer-released-to-pointer-press-and-pointer-release>Rename <code>Pointer&LTPressed></code> and <code>Pointer&LTReleased></code> to <code>Pointer&LTPress></code> and <code>Pointer&LTRelease></code> <a class=anchor-link href=#rename-pointer-pressed-and-pointer-released-to-pointer-press-and-pointer-release>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19179>#19179</a></div></div><p>The <code>Pointer&LTPressed></code> and <code>Pointer&LTReleased></code> events have been renamed to <code>Pointer&LTPress></code> and <code>Pointer&LTRelease></code> for improved consistency. <code>Pressed</code> is now a marker component indicating that a button or other UI node is in a pressed or "held down" state.<h3 id=yaxisorientation-has-been-removed><code>YAxisOrientation</code> has been removed <a class=anchor-link href=#yaxisorientation-has-been-removed>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19077>#19077</a></div></div><p>The <code>YAxisOrientation</code> component has been removed from <code>bevy_text</code>. The correct y-axis orientation is now chosen automatically by the text systems.<h3 id=renamed-timer-paused-to-timer-is-paused-and-timer-finished-to-timer-is-finished>Renamed <code>Timer::paused</code> to <code>Timer::is_paused</code> and <code>Timer::finished</code> to <code>Timer::is_finished</code> <a class=anchor-link href=#renamed-timer-paused-to-timer-is-paused-and-timer-finished-to-timer-is-finished>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19386>#19386</a></div></div><p>The following changes were made:<ul><li><code>Timer::paused</code> is now <code>Timer::is_paused</code><li><code>Timer::finished</code> is now <code>Timer::is_finished</code></ul><p>This change was made to align the <code>Timer</code> public API with that of <code>Time</code> and <code>Stopwatch</code>.<h3 id=gltf-animation-loading-is-now-optional>glTF animation loading is now optional <a class=anchor-link href=#gltf-animation-loading-is-now-optional>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20750>#20750</a></div></div><p><code>GltfLoaderSettings</code> now has a <code>load_animations</code> field which allows controlling whether animations should load.<h3 id=fixed-ui-draw-order-and-stack-z-offsets-changes>Fixed UI draw order and <code>stack_z_offsets</code> changes <a class=anchor-link href=#fixed-ui-draw-order-and-stack-z-offsets-changes>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19691>#19691</a></div></div><p>The draw order of some renderable UI elements relative to others wasn't fixed and depended on system ordering. In particular the ordering of background colors and texture sliced images was sometimes swapped.<p>The UI draw order is now fixed. The new order is (back-to-front):<ol><li>Box shadows<li>Node background colors<li>Node borders<li>Gradients<li>Border Gradients<li>Images (including texture-sliced images)<li>Materials<li>Text (including text shadows)</ol><p>The values of the <code>stack_z_offsets</code> constants have been updated to enforce the new ordering. Other changes:<ul><li><code>NODE</code> is renamed to <code>BACKGROUND_COLOR</code><li><code>TEXTURE_SLICE</code> is removed, use <code>IMAGE</code>.<li>New <code>BORDER</code>, <code>BORDER_GRADIENT</code> and <code>TEXT</code> constants.</ul><h3 id=removedcomponents-methods-renamed-to-match-event-to-message-rename><code>RemovedComponents</code> methods renamed to match <code>Event</code> to <code>Message</code> rename <a class=anchor-link href=#removedcomponents-methods-renamed-to-match-event-to-message-rename>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20953>#20953</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20954>#20954</a></div></div><p>As part of the broader shift to differentiate between buffered events (0.16's <code>EventWriter</code>/<code>EventReader</code>) and observer-events, various methods and types related to <code>RemovedComponents</code> have been renamed.<p>The implementation of <code>RemovedComponents</code> uses buffered events (now, messages): and as a result, the following types and messages have been renamed:<table><thead><tr><th>Old<th>New<tbody><tr><td><code>RemovedComponents::events</code><td><code>RemovedComponents::messages</code><tr><td><code>RemovedComponents::reader_mut_with_events</code><td><code>RemovedComponents::reader_mut_with_messages</code><tr><td><code>RemovedComponentEvents</code><td><code>RemovedComponentMessages</code></table><h3 id=window-is-now-split-into-multiple-components>Window is now split into multiple components <a class=anchor-link href=#window-is-now-split-into-multiple-components>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19668>#19668</a></div></div><p><code>Window</code> has become a very large component over the last few releases. To improve our internal handling of it and to make it more approachable, we have split it into multiple components, all on the same entity. So far, this affects <code>CursorOptions</code>:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> old
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">lock_cursor</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">primary_window</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Single<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> Window, <span class="z-meta z-generic z-rust">With<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>PrimaryWindow<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    primary_window<span class="z-punctuation z-accessor z-dot z-rust">.</span>cursor_options<span class="z-punctuation z-accessor z-dot z-rust">.</span>grab_mode <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">CursorGrabMode<span class="z-punctuation z-accessor z-rust">::</span></span>Locked<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> new
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">lock_cursor</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">primary_cursor_options</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Single<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> CursorOptions, <span class="z-meta z-generic z-rust">With<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>PrimaryWindow<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    primary_cursor_options<span class="z-punctuation z-accessor z-dot z-rust">.</span>grab_mode <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">CursorGrabMode<span class="z-punctuation z-accessor z-rust">::</span></span>Locked<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>This split also applies when specifying the initial settings for the primary window:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> old
</span></span><span class="z-source z-rust">app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_plugins</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>DefaultPlugins<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">set</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>WindowPlugin <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    primary_window<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Window <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        cursor_options<span class="z-punctuation z-separator z-rust">:</span> CursorOptions <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            grab_mode<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">CursorGrabMode<span class="z-punctuation z-accessor z-rust">::</span></span>Locked<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> new
</span></span><span class="z-source z-rust">app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_plugins</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>DefaultPlugins<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">set</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>WindowPlugin <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    primary_cursor_options<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>CursorOptions <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        grab_mode<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">CursorGrabMode<span class="z-punctuation z-accessor z-rust">::</span></span>Locked<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=removed-cosmic-text-re-exports>Removed <code>cosmic_text</code> re-exports <a class=anchor-link href=#removed-cosmic-text-re-exports>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19516>#19516</a></div></div><p>Previously, <code>bevy_text</code> re-exported the entirety of <code>cosmic_text</code> while renaming a few of the most confusing re-exports, using the following code.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">cosmic_text<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-separator z-rust">,</span> FamilyOwned <span class="z-keyword z-operator z-rust">as</span> FontFamily<span class="z-punctuation z-separator z-rust">,</span> Stretch <span class="z-keyword z-operator z-rust">as</span> FontStretch<span class="z-punctuation z-separator z-rust">,</span> Style <span class="z-keyword z-operator z-rust">as</span> FontStyle<span class="z-punctuation z-separator z-rust">,</span> Weight <span class="z-keyword z-operator z-rust">as</span> FontWeight<span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>These re-exports commonly conflicted with other types (like <code>Query</code>!), leading to messy autocomplete errors. Ultimately, these are largely an implementation detail, and were not widely used.<p>We've completely removed these re-exports (including the renamed types): if you need to use these types, please rely on them directly from <code>cosmic_text</code>, being sure that the version number you are using matches the version used by your version of <code>bevy_text</code>.<h3 id=rename-send-event-and-similar-methods-to-write-message>Rename <code>send_event</code> and similar methods to <code>write_message</code> <a class=anchor-link href=#rename-send-event-and-similar-methods-to-write-message>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20017>#20017</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20953>#20953</a></div></div><p>Following up on the <code>EventWriter::send</code> being renamed to <code>EventWriter::write</code> in 0.16, many similar methods have been renamed. Note that "buffered events" are now known as <code>Messages</code>, and the naming reflects that here.<p>This includes both the <code>World</code> and <code>Commands</code> message methods. The old methods have been depreciated.<table><thead><tr><th>Old<th>New<tbody><tr><td><code>World::send_event</code><td><code>World::write_message</code><tr><td><code>World::send_event_default</code><td><code>World::write_message_default</code><tr><td><code>World::send_event_batch</code><td><code>World::write_message_batch</code><tr><td><code>DeferredWorld::send_event</code><td><code>DeferredWorld::write_message</code><tr><td><code>DeferredWorld::send_event_default</code><td><code>DeferredWorld::write_message_default</code><tr><td><code>DeferredWorld::send_event_batch</code><td><code>DeferredWorld::write_message_batch</code><tr><td><code>Commands::send_event</code><td><code>Commands::write_message</code><tr><td><code>Events::send</code><td><code>Messages::write</code><tr><td><code>Events::send_default</code><td><code>Messages::write_default</code><tr><td><code>Events::send_batch</code><td><code>Messages::write_batch</code><tr><td><code>RemovedComponentEvents::send</code><td><code>RemovedComponentEvents::write</code><tr><td><code>command::send_event</code><td><code>command::write_message</code><tr><td><code>SendBatchIds</code><td><code>WriteBatchIds</code></table><h3 id=move-ui-debug-options-from-bevy-ui-to-bevy-ui-render>Move UI Debug Options from <code>bevy_ui</code> to <code>bevy_ui_render</code> <a class=anchor-link href=#move-ui-debug-options-from-bevy-ui-to-bevy-ui-render>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18703>#18703</a></div></div><p>The <code>UiDebugOptions</code> resource used for controlling the UI Debug Overlay has been moved from the internal <code>bevy_ui</code> crate to the <code>bevy_ui_render</code> crate, and is now accessible from the prelude of <code>bevy_ui_render</code> and, as before, from the prelude of <code>bevy</code>:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">prelude<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> or
</span></span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">ui<span class="z-punctuation z-accessor z-rust">::</span></span>UiDebugOptions<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">prelude<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> or, if you are not using the full `bevy` crate:
</span></span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> use bevy_ui_render::prelude::*;
</span></span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> options <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource_mut<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>UiDebugOptions<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=clonebehavior-is-no-longer-partialeq-or-eq><code>CloneBehavior</code> is no longer <code>PartialEq</code> or <code>Eq</code> <a class=anchor-link href=#clonebehavior-is-no-longer-partialeq-or-eq>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18393>#18393</a></div></div><p><code>CloneBehavior</code> no longer implements <code>PartialEq</code> or <code>Eq</code> and thus does not work with the <code>==</code> and <code>!=</code> operators, as the internal comparisons involve comparing function pointers which may result in unexpected results.<p>Use pattern matching to check for equality instead:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-keyword z-control z-rust">if</span> clone_behavior <span class="z-keyword z-operator z-comparison z-rust">==</span> <span class="z-meta z-path z-rust">CloneBehavior<span class="z-punctuation z-accessor z-rust">::</span></span>Ignore <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">   <span class="z-keyword z-operator z-range z-rust">...</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-keyword z-control z-rust">if</span> <span class="z-support z-macro z-rust">matches!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>clone_behavior<span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">CloneBehavior<span class="z-punctuation z-accessor z-rust">::</span></span>Ignore</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">   <span class="z-keyword z-operator z-range z-rust">...</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></code></pre><h3 id=interned-labels-and-dyneq>Interned labels and <code>DynEq</code> <a class=anchor-link href=#interned-labels-and-dyneq>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18984>#18984</a></div></div><ul><li><code>DynEq::as_any</code> has been removed. Use <code>&value as &dyn Any</code> instead.<li><code>DynHash::as_dyn_eq</code> has been removed. Use <code>&value as &dyn DynEq</code> instead.<li><code>as_dyn_eq</code> has been removed from 'label' types such as <code>ScheduleLabel</code> and <code>SystemSet</code>. Call <code>DynEq::dyn_eq</code> directly on the label instead.</ul><h3 id=split-hdr-from-camera>Split <code>Hdr</code> from <code>Camera</code> <a class=anchor-link href=#split-hdr-from-camera>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18873>#18873</a></div></div><p><code>Camera.hdr</code> has been split out into a new marker component, <code>Hdr</code>, which can be found at <code>bevy::render::view::Hdr</code>.<ul><li>before: <code>commands.spawn((Camera3d, Camera { hdr: true, ..default() });</code><li>after: <code>commands.spawn((Camera3d, Hdr));</code><li>rendering effects can now <code>#[require(Hdr)]</code> if they only function with an HDR camera. This is currently implemented for <code>Bloom</code>, <code>AutoExposure</code>, and <code>Atmosphere</code></ul><h3 id=the-render-target-info-from-computeduitargetcamera-has-been-removed>The render target info from <code>ComputedUiTargetCamera</code> has been removed. <a class=anchor-link href=#the-render-target-info-from-computeduitargetcamera-has-been-removed>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20535>#20535</a></div></div><p>The render target info, scale factor and physical size, has been removed from <code>ComputedUiTargetCamera</code> and placed into a new component <code>ComputedUiRenderTargetInfo</code>.<h3 id=reflection-based-maps-are-now-unordered>Reflection-based maps are now unordered <a class=anchor-link href=#reflection-based-maps-are-now-unordered>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19802>#19802</a></div></div><p><code>DynamicMap</code> is now unordered, and the <code>Map</code> trait no longer assumes implementors to be ordered. If you previously relied on them being ordered, you should now store a list of keys (<code>Vec&LTBox&LTdyn PartialReflect>></code>) separately.<p><code>Map::get_at</code> and <code>Map::get_at_mut</code> are now removed. You should no longer use <code>usize</code> to index into the map, and instead use <code>&dyn PartialReflect</code> with <code>Map::get</code> and <code>Map::get_mut</code>.<p><code>PartialReflect::apply(self, other)</code> for maps now removes excess entries (entries present in <code>self</code> which are not present in <code>other</code>). If you need those entries to be preserved, you will need to re-insert them manually.<h3 id=rework-mergemesherror>Rework <code>MergeMeshError</code> <a class=anchor-link href=#rework-mergemesherror>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18561>#18561</a></div></div><p><code>MergeMeshError</code> was reworked to account for the possibility of the meshes being merged having two different <code>PrimitiveTopology</code>'s, and was renamed to <code>MeshMergeError</code> to align with the naming of other mesh errors.<ul><li>Users will need to rename <code>MergeMeshError</code> to <code>MeshMergeError</code><li>When handling <code>MergeMeshError</code> (now <code>MeshMergeError</code>), users will need to account for the new <code>IncompatiblePrimitiveTopology</code> variant, as it has been changed from a struct to an enum<li><code>Mesh::merge</code> now returns <code>Result<(), MeshMergeError></code> instead of the previous <code>Result<(), MergeMeshError></code></ul><h3 id=use-gltf-material-names-for-spawned-primitive-entities>Use glTF material names for spawned primitive entities <a class=anchor-link href=#use-gltf-material-names-for-spawned-primitive-entities>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19287>#19287</a></div></div><p>When loading a glTF scene in Bevy, each mesh primitive will generate an entity and store a <code>GltfMaterialName</code> component and <code>Name</code> component.<p>The <code>Name</code> components were previously stored as mesh name plus primitive index - for example, <code>MeshName.0</code> and <code>MeshName.1</code>. To make it easier to view these entities in Inspector-style tools, they are now stored as mesh name plus material name - for example, <code>MeshName.Material1Name</code> and <code>MeshName.Material2Name</code>.<p>If you were relying on the previous value of the <code>Name</code> component on meshes, use the new <code>GltfMeshName</code> component instead.<h3 id=viewrangefinder3d-from-world-from-view-now-takes-affine3a-instead-of-mat4><code>ViewRangefinder3d::from_world_from_view</code> now takes <code>Affine3A</code> instead of <code>Mat4</code> <a class=anchor-link href=#viewrangefinder3d-from-world-from-view-now-takes-affine3a-instead-of-mat4>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20707>#20707</a></div></div><p><code>ViewRangefinder3d::from_world_from_view</code> now takes <code>Affine3A</code> instead of <code>Mat4</code>. If you were supplying a <code>GlobalTransform::to_matrix()</code>, simply use <code>GlobalTransform::affine()</code> now. Performance will be better.<h3 id=original-target-of-pointer-picking-events-is-now-stored-on-observers>Original target of <code>Pointer</code> picking events is now stored on observers <a class=anchor-link href=#original-target-of-pointer-picking-events-is-now-stored-on-observers>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19663>#19663</a></div></div><p>The <code>Pointer.target</code> field, which tracks the original target of the pointer event before bubbling, has been removed. Instead, all "bubbling entity event" observers now track this information, available via the <code>On::original_event_target()</code> method.<p>If you were using this information via the Pointer API of picking, please migrate to observers. If you cannot for performance reasons, please open an issue explaining your exact use case!<p>As a workaround, you can transform any entity-event into a Message that contains the targeted entity using an observer than writes messages.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Message</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-generic z-rust"><span class="z-entity z-name z-struct z-rust">EntityEventMessage</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>E<span class="z-punctuation z-separator z-rust">:</span> EntityEvent<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span></span><span class="z-meta z-struct z-rust"> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">entity</span><span class="z-punctuation z-separator z-type z-rust">:</span> Entity,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">event</span><span class="z-punctuation z-separator z-type z-rust">:</span> E,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> A generic observer that handles this transformation
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">transform_entity_event</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>E<span class="z-punctuation z-separator z-rust">:</span> EntityEvent<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">event</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">On<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>E<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-variable z-parameter z-rust">message_writer</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MessageWriter<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">EntityEventMessage<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>E<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-keyword z-control z-rust">if</span> event<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-comparison z-rust">==</span> event<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">original_event_target</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        message_writer<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">send</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>EntityEventMessage <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">            event<span class="z-punctuation z-separator z-rust">:</span> event<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">event</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">            entity<span class="z-punctuation z-separator z-rust">:</span> event<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        )<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">}
</span></span></span></span></span></code></pre><h3 id=remove-the-add-sub-impls-on-volume>Remove the <code>Add</code>/<code>Sub</code> impls on <code>Volume</code> <a class=anchor-link href=#remove-the-add-sub-impls-on-volume>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19423>#19423</a></div></div><p>Linear volumes are like percentages, and it does not make sense to add or subtract percentages. As such, use the new <code>increase_by_percentage</code> function instead of addition or subtraction.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">audio_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> linear_a <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Volume<span class="z-punctuation z-accessor z-rust">::</span></span>Linear<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">5</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> linear_b <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Volume<span class="z-punctuation z-accessor z-rust">::</span></span>Linear<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">1</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> linear_c <span class="z-keyword z-operator z-assignment z-rust">=</span> linear_a <span class="z-keyword z-operator z-arithmetic z-rust">+</span> linear_b<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> linear_d <span class="z-keyword z-operator z-assignment z-rust">=</span> linear_a <span class="z-keyword z-operator z-arithmetic z-rust">-</span> linear_b<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">audio_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> linear_a <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Volume<span class="z-punctuation z-accessor z-rust">::</span></span>Linear<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">5</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> linear_b <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Volume<span class="z-punctuation z-accessor z-rust">::</span></span>Linear<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">1</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> linear_c <span class="z-keyword z-operator z-assignment z-rust">=</span> linear_a<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">increase_by_percentage</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">10.</span><span class="z-constant z-numeric z-float z-rust">0</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> linear_d <span class="z-keyword z-operator z-assignment z-rust">=</span> linear_a<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">increase_by_percentage</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-arithmetic z-rust">-</span><span class="z-constant z-numeric z-float z-rust">10.</span><span class="z-constant z-numeric z-float z-rust">0</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h3 id=renamed-computednodetarget-and-update-ui-context-system>Renamed <code>ComputedNodeTarget</code> and <code>update_ui_context_system</code> <a class=anchor-link href=#renamed-computednodetarget-and-update-ui-context-system>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20519>#20519</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20532>#20532</a></div></div><p><code>ComputedNodeTarget</code> has been renamed to <code>ComputedUiTargetCamera</code>. New name chosen because the component's value is derived from <code>UiTargetCamera</code>.<p><code>update_ui_context_system</code> has been renamed to <code>propagate_ui_target_cameras</code>.<h3 id=chromaticaberration-lut-is-now-option>ChromaticAberration LUT is now Option <a class=anchor-link href=#chromaticaberration-lut-is-now-option>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19408>#19408</a></div></div><p>The <code>ChromaticAberration</code> component <code>color_lut</code> field use to be a regular <code>Handle&LTImage></code>. Now, it is an <code>Option&LTHandle&LTImage>></code> which falls back to the default image when <code>None</code>. For users assigning a custom LUT, just wrap the value in <code>Some</code>.<h3 id=extract-pointerinputplugin-members-into-pointerinputsettings>Extract <code>PointerInputPlugin</code> members into <code>PointerInputSettings</code> <a class=anchor-link href=#extract-pointerinputplugin-members-into-pointerinputsettings>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19078>#19078</a></div></div><p>Toggling mouse and touch input update for picking should be done through the <code>PointerInputSettings</code> resource instead of <code>PointerInputPlugin</code>.<p>To initialize <code>PointerInputSettings</code> with non-default values, simply add the resource to the app using <code>insert_resource</code> with the desired value.<h3 id=dragenter-now-includes-the-dragged-entity><code>DragEnter</code> now includes the dragged entity <a class=anchor-link href=#dragenter-now-includes-the-dragged-entity>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19179>#19179</a></div></div><p><code>DragEnter</code> events are now triggered when entering any entity, even the originally dragged one. This makes the behavior more consistent.<p>The old behavior can be achieved by checking if trigger.entity != trigger.dragged<h3 id=separate-border-colors>Separate Border Colors <a class=anchor-link href=#separate-border-colors>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18682>#18682</a></div></div><p>The <code>BorderColor</code> struct now contains separate fields for each edge, <code>top</code>, <code>bottom</code>, <code>left</code>, <code>right</code>. To keep the existing behavior, replace <code>BorderColor(color)</code> with <code>BorderColor::all(color)</code>, and <code>border_color.0 = new_color</code> with <code>*border_color = BorderColor::all(new_color)</code>.<h3 id=scrollposition-now-uses-logical-pixel-units-and-is-no-longer-overwritten-during-layout-updates><code>ScrollPosition</code> now uses logical pixel units and is no longer overwritten during layout updates <a class=anchor-link href=#scrollposition-now-uses-logical-pixel-units-and-is-no-longer-overwritten-during-layout-updates>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20093>#20093</a></div></div><p><code>ScrollPosition</code> is no longer overwritten during layout updates. Instead the computed scroll position is stored in the new <code>scroll_position</code> field on <code>ComputedNode</code>.<h3 id=combine-now-takes-an-extra-parameter>Combine now takes an extra parameter <a class=anchor-link href=#combine-now-takes-an-extra-parameter>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20689>#20689</a></div></div><p>The <code>Combine::combine</code> method now takes an extra parameter that needs to be passed mutably to the two given closures. This allows fixing a soundness issue which manifested when the two closures were called re-entrantly.<h3 id=fix-from-rot2-implementation-for-mat2>Fix <code>From&LTRot2></code> implementation for <code>Mat2</code> <a class=anchor-link href=#fix-from-rot2-implementation-for-mat2>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20522>#20522</a></div></div><p>Past releases had an incorrect <code>From&LTRot2></code> implementation for <code>Mat2</code>, constructing a rotation matrix in the following form:<pre class=z-code><code><span class="z-text z-plain">[  cos, sin ]
</span><span class="z-text z-plain">[ -sin, cos ]
</span></code></pre><p>This was actually the <em>inverse</em> of the rotation matrix, resulting in clockwise rotation when transforming vectors. The correct version is the following:<pre class=z-code><code><span class="z-text z-plain">[ cos, -sin ]
</span><span class="z-text z-plain">[ sin,  cos ]
</span></code></pre><p>resulting in counterclockwise rotation.<p>This error has now been fixed. You may see that rotation matrices created using the <code>From&LTRot2></code> implementation produce different results than before, as the rotation happens counterclockwise (as intended) rather than clockwise. Invert either the input <code>Rot2</code> or the resulting <code>Mat2</code> to get the same results as before.<h3 id=extract-pickingplugin-members-into-pickingsettings>Extract <code>PickingPlugin</code> members into <code>PickingSettings</code> <a class=anchor-link href=#extract-pickingplugin-members-into-pickingsettings>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19078>#19078</a></div></div><p>Controlling the behavior of picking should be done through the <code>PickingSettings</code> resource instead of <code>PickingPlugin</code>.<p>To initialize <code>PickingSettings</code> with non-default values, simply add the resource to the app using <code>insert_resource</code> with the desired value.<h3 id=consistent-systems-naming-convention-for-system-sets>Consistent <code>*Systems</code> naming convention for system sets <a class=anchor-link href=#consistent-systems-naming-convention-for-system-sets>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18900>#18900</a></div></div><p>System sets in Bevy now more consistently use a <code>Systems</code> suffix. Renamed types include:<ul><li><code>AccessibilitySystem</code> â†’ <code>AccessibilitySystems</code><li><code>GizmoRenderSystem</code> â†’ <code>GizmoRenderSystems</code><li><code>PickSet</code> â†’ <code>PickingSystems</code><li><code>RunFixedMainLoopSystem</code> â†’ <code>RunFixedMainLoopSystems</code><li><code>TransformSystem</code> â†’ <code>TransformSystems</code><li><code>RemoteSet</code> â†’ <code>RemoteSystems</code><li><code>RenderSet</code> â†’ <code>RenderSystems</code><li><code>SpriteSystem</code> â†’ <code>SpriteSystems</code><li><code>StateTransitionSteps</code> â†’ <code>StateTransitionSystems</code><li><code>RenderUiSystem</code> â†’ <code>RenderUiSystems</code><li><code>UiSystem</code> â†’ <code>UiSystems</code><li><code>Animation</code> â†’ <code>AnimationSystems</code><li><code>AssetEvents</code> â†’ <code>AssetEventSystems</code><li><code>TrackAssets</code> â†’ <code>AssetTrackingSystems</code><li><code>UpdateGizmoMeshes</code> â†’ <code>GizmoMeshSystems</code><li><code>InputSystem</code> â†’ <code>InputSystems</code><li><code>InputFocusSet</code> â†’ <code>InputFocusSystems</code><li><code>ExtractMaterialsSet</code> â†’ <code>MaterialExtractionSystems</code><li><code>ExtractMeshesSet</code> â†’ <code>MeshExtractionSystems</code><li><code>RumbleSystem</code> â†’ <code>RumbleSystems</code><li><code>CameraUpdateSystem</code> â†’ <code>CameraUpdateSystems</code><li><code>ExtractAssetsSet</code> â†’ <code>AssetExtractionSystems</code><li><code>Update2dText</code> â†’ <code>Text2dUpdateSystems</code><li><code>TimeSystem</code> â†’ <code>TimeSystems</code><li><code>EventUpdates</code> â†’ <code>EventUpdateSystems</code></ul><p>To improve consistency within the ecosystem, it is recommended for ecosystem crates and users to also adopt the <code>*Systems</code> naming convention for their system sets where applicable.<h3 id=system-run-returns-result><code>System::run</code> returns <code>Result</code> <a class=anchor-link href=#system-run-returns-result>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19145>#19145</a></div></div><p>In order to support fallible systems and parameter-based system skipping like <code>Single</code> and <code>If&LTT></code> in more places, <code>System::run</code> and related methods now return a <code>Result</code> instead of a plain value.<p>If you were calling <code>System::run</code>, <code>System::run_unsafe</code>, <code>System::run_without_applying_deferred</code>, or <code>ReadOnlySystem::run_readonly</code>, the simplest solution is to <code>unwrap()</code> the resulting <code>Result</code>. The only case where an infallible system will return <code>Err</code> is an invalid parameter, such as a missing resource, and those cases used to panic.<p>If you were calling them from a function that returns <code>Result&LTT, BevyError></code>, you can instead use the <code>?</code> operator.<p><code>System::run</code>, <code>System::run_without_applying_deferred</code>, and <code>ReadOnlySystem::run_readonly</code> will now call <code>System::validate_param_unsafe</code> and return <code>Err</code> if validation fails. If you were calling <code>validate_param</code> or <code>validate_param_unsafe</code> before calling one of those, it is no longer necessary. Note that <code>System::run_unsafe</code> still does <em>not</em> perform validation.<p>If you were manually implementing <code>System</code>, the return type to <code>run_unsafe</code> has changed from <code>Out</code> to <code>Result&LTOut, RunSystemError></code>. If you are implementing an infallible system, simply wrap the return value in <code>Ok</code>. If you were implementing a fallible system and had set <code>type Out = Result&LTT, BevyError>;</code>, instead set <code>type Out = T;</code>.<p>If you have a system function that returns <code>Result</code> or <code>!</code> and are not restricting the return type, you may get type inference failures like this:<pre class=z-code><code><span class="z-text z-plain">error[E0283]: type annotations needed
</span><span class="z-text z-plain">    --> lib.rs:100:5
</span><span class="z-text z-plain">     |
</span><span class="z-text z-plain">100  |     IntoSystem::into_system(example_system);
</span><span class="z-text z-plain">     |     ^^^^^^^^^^^^^^^^^^^^^^^ cannot infer type of the type parameter `Out` declared on the trait `IntoSystem`
</span><span class="z-text z-plain">     |
</span><span class="z-text z-plain">note: multiple `impl`s satisfying `core::result::Result<(), bevy_error::BevyError>: function_system::IntoResult<_>` found
</span><span class="z-text z-plain">   --> crates\bevy_ecs\src\system\function_system.rs:597:1
</span></code></pre><p>or<pre class=z-code><code><span class="z-text z-plain">error[E0283]: type annotations needed
</span><span class="z-text z-plain">    --> lib.rs:100:11
</span><span class="z-text z-plain">    |
</span><span class="z-text z-plain">100 |     world.run_system_cached(system).unwrap();
</span><span class="z-text z-plain">    |           ^^^^^^^^^^^^^^^^^ cannot infer type of the type parameter `O` declared on the method `run_system_cached`
</span><span class="z-text z-plain">    |
</span><span class="z-text z-plain">note: multiple `impl`s satisfying `core::result::Result<(), bevy_error::BevyError>: function_system::IntoResult<_>` found
</span><span class="z-text z-plain">   --> crates\bevy_ecs\src\system\function_system.rs:597:1
</span></code></pre><p>A function that returns <code>Result&LTT, BevyError></code> may be considered either a fallible system that returns <code>T</code> or an infallible system that returns <code>Result</code>, and a function that returns <code>!</code> may be considered a system that returns <em>any</em> type. You should be able to resolve them by providing an explicit type for <code>System::Out</code>.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">example_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> Result</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16 - Output type is inferred to be `Result`
</span></span><span class="z-source z-rust"><span class="z-meta z-path z-rust">IntoSystem<span class="z-punctuation z-accessor z-rust">::</span></span>into_system<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>example_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17 - Output type can be either `()` or `Result` and must be written explicitly
</span></span><span class="z-source z-rust"><span class="z-meta z-path z-rust">IntoSystem<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">_</span>, <span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-punctuation z-section z-group z-end z-rust">)</span>, <span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>into_system<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>example_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-meta z-path z-rust">IntoSystem<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">_</span>, <span class="z-support z-type z-rust">Result</span>, <span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>into_system<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>example_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16 - Output type is inferred to be `Result`
</span></span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">run_system_cached</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>example_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17 - Output type can be either `()` or `Result` and must be written explicitly
</span></span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">run_system_cached<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-punctuation z-section z-group z-end z-rust">)</span>, <span class="z-keyword z-operator z-rust">_</span>, <span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>example_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">run_system_cached<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-support z-type z-rust">Result</span>, <span class="z-keyword z-operator z-rust">_</span>, <span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>example_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> or it may be inferred if the output type is specified elsewhere
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">run_system_cached</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>example_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> r<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Result</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">run_system_cached</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>example_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=lightvisibilityclass-renamed-to-clustervisibilityclass><code>LightVisibilityClass</code> renamed to <code>ClusterVisibilityClass</code> <a class=anchor-link href=#lightvisibilityclass-renamed-to-clustervisibilityclass>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19986>#19986</a></div></div><p>When clustered decals were added, they used <code>LightVisibilityClass</code> to share the clustering infrastructure. This revealed that this visibility class wasn't really about lights, but about clustering. It has been renamed to <code>ClusterVisibilityClass</code> and moved to live alongside clustering-specific types.<h3 id=renamed-state-scoped-entities-and-events>Renamed state scoped entities and events <a class=anchor-link href=#renamed-state-scoped-entities-and-events>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18818>#18818</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19435>#19435</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20872>#20872</a></div></div><p>Previously, Bevy provided the <code>StateScoped</code> component and <code>add_state_scoped_event</code> method as a way to remove entities/events when <strong>exiting</strong> a state.<p>However, it can also be useful to have the opposite behavior, where entities/events are removed when <strong>entering</strong> a state. This is now possible with the new <code>DespawnOnEnter</code> component and <code>clear_events_on_enter</code> method.<p>To support this addition, the previous method and component have been renamed. Also, <code>clear_event_on_exit</code> (previously <code>clear_event_on_exit_state</code>) no longer adds the event automatically, so you must call <code>App::add_event</code> manually.<table><thead><tr><th>Before<th>After<tbody><tr><td><code>StateScoped</code><td><code>DespawnOnExit</code><tr><td><code>clear_state_scoped_entities</code><td><code>despawn_entities_on_exit_state</code><tr><td><code>add_state_scoped_event</code><td><code>add_event</code> + <code>clear_events_on_exit</code></table><h3 id=renamed-justifytext-to-justify>Renamed <code>JustifyText</code> to <code>Justify</code> <a class=anchor-link href=#renamed-justifytext-to-justify>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19522>#19522</a></div></div><p><code>JustifyText</code> has been renamed to <code>Justify</code>.<p>The <code>-Text</code> suffix was inconsistent with the names of other <code>bevy_text</code> types and unnecessary since it's natural to assume <code>Justify</code> refers to text justification.<h3 id=remove-default-implementation-of-extend-from-iter-from-relationshipsourcecollection>Remove default implementation of <code>extend_from_iter</code> from <code>RelationshipSourceCollection</code> <a class=anchor-link href=#remove-default-implementation-of-extend-from-iter-from-relationshipsourcecollection>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20255>#20255</a></div></div><p>The <code>extend_from_iter</code> method in the <code>RelationshipSourceCollection</code> trait no longer has a default implementation. If you have implemented a custom relationship source collection, you must now provide your own implementation of this method.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Before: method was optional due to default implementation
</span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">RelationshipSourceCollection <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyCustomCollection</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ... other required methods
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> extend_from_iter was automatically provided
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> After: method is now required
</span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">RelationshipSourceCollection <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyCustomCollection</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ... other required methods
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">extend_from_iter</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">entities</span><span class="z-punctuation z-separator z-rust">:</span> impl <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">IntoIterator</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Item = Entity<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Use your collection's native extend method if available
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">extend</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entities</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Or implement manually if needed:
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> for entity in entities {
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span>     self.add(entity);
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> }
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h3 id=animationgraph-no-longer-supports-raw-assetids><code>AnimationGraph</code> no longer supports raw AssetIds <a class=anchor-link href=#animationgraph-no-longer-supports-raw-assetids>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19615>#19615</a></div></div><p>In previous versions of Bevy, <code>AnimationGraph</code> would serialize <code>Handle&LTAnimationClip></code> as an asset path, and if that wasn't available it would fallback to serializing <code>AssetId&LTAnimationClip></code>. In practice, this was not very useful. <code>AssetId</code> is (usually) a runtime-generated ID. This means for an arbitrary <code>Handle&LTAnimationClip></code>, it was incredibly unlikely that your handle before serialization would correspond to the same asset as after serialization.<p>This confusing behavior has been removed. As a side-effect, any <code>AnimationGraph</code>s you previously saved (via <code>AnimationGraph::save</code>) will need to be re-saved. These legacy <code>AnimationGraph</code>s can still be loaded until the next Bevy version. Loading and then saving the <code>AnimationGraph</code> again will automatically migrate the <code>AnimationGraph</code>.<p>If your <code>AnimationGraph</code> contained serialized <code>AssetId</code>s, you will need to manually load the bytes of the saved graph, deserialize it into <code>SerializedAnimationGraph</code>, and then manually decide how to migrate those <code>AssetId</code>s. Alternatively, you could simply rebuild the graph from scratch and save a new instance. We expect this to be a very rare situation.<h3 id=unify-observerstate-and-observer-components>Unify <code>ObserverState</code> and <code>Observer</code> components <a class=anchor-link href=#unify-observerstate-and-observer-components>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18728>#18728</a></div></div><p><code>ObserverState</code> and <code>Observer</code> have been merged into a single component. now you can use <code>Observer::with_dynamic_runner</code> to build custom Observe.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> observe <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-storage z-modifier z-rust">unsafe</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-path z-rust">Observer<span class="z-punctuation z-accessor z-rust">::</span></span>with_dynamic_runner<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-parameter z-rust">trigger_context</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-parameter z-rust">event_ptr</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-parameter z-rust">trigger_ptr</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> do something
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_event</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>event_a</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>observe</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=take-extract-now-returns-dyn-fnmut-instead-of-dyn-fn><code>take_extract</code> now returns <code>dyn FnMut</code> instead of <code>dyn Fn</code> <a class=anchor-link href=#take-extract-now-returns-dyn-fnmut-instead-of-dyn-fn>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19926>#19926</a></div></div><p>Previously, <code>set_extract</code> accepted any <code>Fn</code>. Now we accept any <code>FnMut</code>. For callers of <code>set_extract</code>, there is no difference since <code>Fn: FnMut</code>.<p>However, callers of <code>take_extract</code> will now be returned <code>Option&LTBox&LTdyn FnMut(&mut World, &mut World) + Send>></code> instead.<h3 id=opengl-es-wgpu-backend-is-no-longer-supported-by-default>OpenGL ES <code>wgpu</code> backend is no longer supported by default <a class=anchor-link href=#opengl-es-wgpu-backend-is-no-longer-supported-by-default>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20793>#20793</a></div></div><p>The <code>gles</code> backend for <code>wgpu</code> is no longer included as a default feature of <code>bevy_render</code>. OpenGL support is still available, but must be explicitly enabled by adding the <code>bevy_render/gles</code> feature to your app. This change reflects the fact that OpenGL support is not tested and that some features may not work as expected or at all. We welcome contributions to improve OpenGL support in the future.<h3 id=labeled-asset-scope-can-now-return-errors><code>labeled_asset_scope</code> can now return errors <a class=anchor-link href=#labeled-asset-scope-can-now-return-errors>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19449>#19449</a></div></div><p><code>labeled_asset_scope</code> now returns a user-specified error type based on their closure. Previously, users would need to fall back to <code>begin_labeled_asset</code> and <code>add_loaded_labeled_asset</code> to handle errors, which is more error-prone. Consider migrating to use <code>labeled_asset_scope</code> if this was you!<p>However, <code>labeled_asset_scope</code> closures that don't return errors now needs to A) return Ok, and B) specify an error type.<p>If your code previously looked like this:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-support z-function z-rust">labeled_asset_scope</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>label<span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">load_context</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">  <span class="z-storage z-type z-rust">let</span> my_asset <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-keyword z-operator z-range z-rust">...</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">  my_asset
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>You can migrate it to:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-path z-rust">labeled_asset_scope<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">_</span>, <span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-punctuation z-section z-group z-end z-rust">)</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>label<span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">load_context</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">  <span class="z-storage z-type z-rust">let</span> my_asset <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-keyword z-operator z-range z-rust">...</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">  <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>my_asset</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=make-scrollposition-newtype-vec2>Make <code>ScrollPosition</code> newtype <code>Vec2</code> <a class=anchor-link href=#make-scrollposition-newtype-vec2>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19881>#19881</a></div></div><p><code>ScrollPosition</code> now newtypes <code>Vec2</code>; its <code>offset_x</code> and <code>offset_y</code> fields have been removed.<h3 id=move-cursor-related-types-from-bevy-winit-to-bevy-window>Move cursor-related types from <code>bevy_winit</code> to <code>bevy_window</code> <a class=anchor-link href=#move-cursor-related-types-from-bevy-winit-to-bevy-window>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20427>#20427</a></div></div><p>In an effort to reduce and untangle dependencies, cursor-related types have been moved from the <code>bevy_winit</code> crate to the <code>bevy_window</code> crate. The following types have been moved as part of this change:<ul><li><code>CursorIcon</code> is now located at <code>bevy::window::CursorIcon</code>.<li><code>CustomCursor</code> is now located at <code>bevy::window::CustomCursor</code>.<li><code>CustomCursorImage</code> is now located at <code>bevy::window::CustomCursorImage</code>.<li><code>CustomCursorUrl</code> is now located at <code>bevy::window::CustomCursorUrl</code>.<li>on the android platform, <code>ANDROID_APP</code> is now located in it's own crate and can be found at <code>bevy::android::ANDROID_APP</code>.</ul><h3 id=extracteduinode-s-stack-index-has-been-renamed-to-z-order-and-is-now-an-f32><code>ExtractedUiNode</code>'s <code>stack_index</code> has been renamed to <code>z_order</code> and is now an <code>f32</code>. <a class=anchor-link href=#extracteduinode-s-stack-index-has-been-renamed-to-z-order-and-is-now-an-f32>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19691>#19691</a></div></div><p><code>ExtractedUiNode</code>â€™s <code>stack_index</code> field has been renamed to <code>z_order</code> and its type changed from <code>u32</code> to <code>f32</code>. Previously <code>stack_index</code> would be converted into an <code>f32</code> after extraction during the <code>Render</code> schedule, then offsets would be applied applied to determine draw order before sorting (lowest value rendered first). For example, a node's fill color is given an offset of <code>0.</code> and a box shadow is given an offset of <code>-0.1</code>, so that the shadow will be drawn behind the node.<p>Changing the field to an <code>f32</code>, enables finer control of the UI draw order by allowing these offsets to be applied during extraction, and fixes a bug affecting the ordering of texture-sliced nodes.<h3 id=changes-to-bevy-s-system-parallelism-strategy>Changes to Bevy's system parallelism strategy <a class=anchor-link href=#changes-to-bevy-s-system-parallelism-strategy>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16885>#16885</a></div></div><p>The scheduler will now prevent systems from running in parallel if there <em>could</em> be an archetype that they conflict on, even if there aren't actually any. To expand on this, previously, the scheduler would look at the entities that exist to determine if there's any overlap. Now, it determines it solely on the basis of the function signatures of the systems that are run. This was done as a performance optimization: while in theory this throws away potential parallelism, in practice, tests on engine and user code found that scheduling overhead dominates parallelism gains with the current multithreaded executor. Swapping to this simpler, more conservative test allows us to speed up these checks and improve resource utilization. There are more improvements planned here, so stay tuned!<p>To understand what this means, consider the following example. These systems will now conflict even if no entity has both <code>Player</code> and <code>Enemy</code> components:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">player_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> Transform, <span class="z-keyword z-operator z-rust">&</span>Player<span class="z-punctuation z-section z-group z-end z-rust">)</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">enemy_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> Transform, <span class="z-keyword z-operator z-rust">&</span>Enemy<span class="z-punctuation z-section z-group z-end z-rust">)</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>To allow them to run in parallel, use <code>Without</code> filters, just as you would to allow both queries in a single system:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Either one of these changes alone would be enough
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">player_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> Transform, <span class="z-keyword z-operator z-rust">&</span>Player<span class="z-punctuation z-section z-group z-end z-rust">)</span>, <span class="z-meta z-generic z-rust">Without<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Enemy<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">enemy_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">query</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Query<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> Transform, <span class="z-keyword z-operator z-rust">&</span>Enemy<span class="z-punctuation z-section z-group z-end z-rust">)</span>, <span class="z-meta z-generic z-rust">Without<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>If you encounter a performance regression in your application due to this change, <em>please</em> open an issue. We would be very interested to understand your use case, see your benchmarking results, and help you mitigate any issues.<h3 id=wgpu-25><code>wgpu</code> 25 <a class=anchor-link href=#wgpu-25>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19563>#19563</a></div></div><p><code>wgpu</code> 25 introduces a number of breaking changes, most notably in the way Bevy is required to handle uniforms with dynamic offsets which are used pervasively in the renderer. Dynamic offsets and uniforms of any kind are no longer allowed to be used in the same bind group as binding arrays. As such, the following changes to the default bind group numbering have been made in 3d:<ul><li><code>@group(0)</code> view binding resources<li><code>@group(1)</code> view resources requiring binding arrays<li><code>@group(2)</code> mesh binding resources<li><code>@group(3)</code> material binding resources</ul><p>Most users who are not using mid-level render APIs will simply need to switch their material bind groups from <code>@group(2)</code> to <code>@group(#{MATERIAL_BIND_GROUP})</code>. The <code>MATERIAL_BIND_GROUP</code> shader def has been added to ensure backwards compatibility in the event the bind group numbering changes again in the future.<p>Exported float constants from shaders without an explicit type declaration like <code>const FOO = 1.0;</code> are no longer supported and must be explicitly typed like <code>const FOO: f32 = 1.0;</code>.<p>See the <a href=https://github.com/gfx-rs/wgpu/blob/trunk/CHANGELOG.md#v2500-2025-04-10>full changelog here</a>.<p>When migrating shaders or other custom rendering code, you may encounter panics like:<pre class=z-code><code><span class="z-text z-plain">wgpu error: Validation Error
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Caused by:
</span><span class="z-text z-plain">  In Device::create_render_pipeline, label = 'pbr_opaque_mesh_pipeline'
</span><span class="z-text z-plain">    Error matching ShaderStages(FRAGMENT) shader requirements against the pipeline
</span><span class="z-text z-plain">      Shader global ResourceBinding { group: 2, binding: 100 } is not available in the pipeline layout
</span><span class="z-text z-plain">        Binding is missing from the pipeline layout
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</span><span class="z-text z-plain">Encountered a panic in system `bevy_render::render_resource::pipeline_cache::PipelineCache::process_pipeline_queue_system`!
</span></code></pre><p>This error is a result of Bevy's bind group indices changing. Identify the shader by searching for the group and binding mentioned, e.g. <code>@group(2) @binding(100)</code>, and follow the above advice to fix the binding group index.<h3 id=anchor-is-now-a-required-component-on-sprite><code>Anchor</code> is now a required component on <code>Sprite</code> <a class=anchor-link href=#anchor-is-now-a-required-component-on-sprite>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18393>#18393</a></div></div><p>The <code>anchor</code> field has been removed from <code>Sprite</code>. Instead the <code>Anchor</code> component is now a required component on <code>Sprite</code>.<p>The anchor variants have been moved to associated constants, following the table below:<table><thead><tr><th>0.16<th>0.17<tbody><tr><td>Anchor::Center<td>Anchor::CENTER<tr><td>Anchor::BottomLeft<td>Anchor::BOTTOM_LEFT<tr><td>Anchor::BottomCenter<td>Anchor::BOTTOM_CENTER<tr><td>Anchor::BottomRight<td>Anchor::BOTTOM_RIGHT<tr><td>Anchor::CenterLeft<td>Anchor::CENTER_LEFT<tr><td>Anchor::CenterRight<td>Anchor::CENTER_RIGHT<tr><td>Anchor::TopLeft<td>Anchor::TOP_LEFT<tr><td>Anchor::TopCenter<td>Anchor::TOP_CENTER<tr><td>Anchor::TopRight<td>Anchor::TOP_RIGHT<tr><td>Anchor::Custom(value)<td>Anchor(value)</table><h3 id=many-render-resources-now-initialized-in-renderstartup>Many render resources now initialized in <code>RenderStartup</code> <a class=anchor-link href=#many-render-resources-now-initialized-in-renderstartup>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19841>#19841</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19885>#19885</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19886>#19886</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19897>#19897</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19898>#19898</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19901>#19901</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19912>#19912</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19926>#19926</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19999>#19999</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20002>#20002</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20024>#20024</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20124>#20124</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20147>#20147</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20184>#20184</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20194>#20194</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20195>#20195</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20208>#20208</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20209>#20209</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20210>#20210</a></div></div><p>Many render resources are <strong>no longer present</strong> during <code>Plugin::finish</code>. Instead they are initialized during <code>RenderStartup</code> (which occurs once the app starts running). If you only access the resource during the <code>Render</code> schedule, then there should be no change. However, if you need one of these render resources to initialize your own resource, you will need to convert your resource initialization into a system.<p>The following are the (public) resources that are now initialized in <code>RenderStartup</code>.<ul><li><code>CasPipeline</code><li><code>FxaaPipeline</code><li><code>SmaaPipelines</code><li><code>TaaPipeline</code><li><code>ShadowSamplers</code><li><code>GlobalClusterableObjectMeta</code><li><code>FallbackBindlessResources</code><li><code>AutoExposurePipeline</code><li><code>MotionBlurPipeline</code><li><code>SkyboxPrepassPipeline</code><li><code>BlitPipeline</code><li><code>DepthOfFieldGlobalBindGroupLayout</code><li><code>DepthPyramidDummyTexture</code><li><code>OitBuffers</code><li><code>PostProcessingPipeline</code><li><code>TonemappingPipeline</code><li><code>BoxShadowPipeline</code><li><code>GradientPipeline</code><li><code>UiPipeline</code><li><code>UiMaterialPipeline&LTM></code><li><code>UiTextureSlicePipeline</code><li><code>ScreenshotToScreenPipeline</code><li><code>VolumetricFogPipeline</code><li><code>DeferredLightingLayout</code><li><code>CopyDeferredLightingIdPipeline</code><li><code>RenderLightmaps</code><li><code>PrepassPipeline</code><li><code>PrepassViewBindGroup</code><li><code>Wireframe3dPipeline</code><li><code>ScreenSpaceReflectionsPipeline</code><li><code>MaterialPipeline</code><li><code>MeshletPipelines</code><li><code>MeshletMeshManager</code><li><code>ResourceManager</code><li><code>Wireframe2dPipeline</code><li><code>Material2dPipeline</code><li><code>SpritePipeline</code><li><code>Mesh2dPipeline</code><li><code>BatchedInstanceBuffer&LTMesh2dUniform></code></ul><p>The vast majority of cases for initializing render resources look like so (in Bevy 0.16):<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">Plugin <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyRenderingPlugin</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">build</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">app</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> App</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Do nothing??
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">finish</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">app</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> App</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>render_app</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_sub_app_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>RenderApp</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-control z-rust">else</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-control z-rust">return</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        render_app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">init_resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>MyRenderResource<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        render_app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_systems</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Render<span class="z-punctuation z-separator z-rust">,</span> my_render_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MyRenderResource</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    ...
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">FromWorld <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyRenderResource</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">from_world</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">Self</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> render_device <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderDevice<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> render_adapter <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderAdapter<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> asset_server <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>AssetServer<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        MyRenderResource <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-operator z-range z-rust">...</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>The two main things to focus on are:<ol><li>The resource implements the <code>FromWorld</code> trait which collects all its dependent resources (most commonly, <code>RenderDevice</code>), and then creates an instance of the resource.<li>The plugin adds its systems and resources in <code>Plugin::finish</code>.</ol><p>First, we need to rewrite our <code>FromWorld</code> implementation as a system. This generally means converting calls to <code>World::resource</code> into system params, and then using <code>Commands</code> to insert the resource. In the above case, that would look like:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Just a regular old system!!
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">init_my_resource</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">commands</span><span class="z-punctuation z-separator z-rust">:</span> Commands,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">render_device</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Res<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderDevice<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">render_adapter</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Res<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderAdapter<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">asset_server</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Res<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>AssetServer<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">insert_resource</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>MyRenderResource <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">        <span class="z-keyword z-operator z-range z-rust">...</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>Each case will be slightly different. Two notes to be wary of:<ol><li>Functions that accept <code>&RenderDevice</code> for example may no longer compile after switching to <code>Res&LTRenderDevice></code>. This can be resolved by passing <code>&render_device</code> instead of <code>render_device</code>.<li>If you are using <code>load_embedded_asset(world, "my_asset.png")</code>, you may need to first add <code>asset_server</code> as a system param, then change this to <code>load_embedded_asset(asset_server.as_ref(), "my_asset.png")</code>.</ol><p>Now that we have our initialization system, we just need to add the system to <code>RenderStartup</code>:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">Plugin <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyRenderingPlugin</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">build</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">app</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> App</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>render_app</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_sub_app_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>RenderApp</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-control z-rust">else</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-control z-rust">return</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        render_app
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_systems</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>RenderStartup<span class="z-punctuation z-separator z-rust">,</span> init_my_resource</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_systems</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Render<span class="z-punctuation z-separator z-rust">,</span> my_render_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> No more finish!!
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>In addition, if your resource requires one of the affected systems above, you will need to use system ordering to ensure your resource initializes after the other system. For example, if your system uses <code>Res&LTUiPipeline></code>, you will need to add an ordering like:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">render_app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_systems</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>RenderStartup<span class="z-punctuation z-separator z-rust">,</span> init_my_resource<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">after</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>init_ui_pipeline</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=gatedreader-and-gatedopener-are-now-private><code>GatedReader</code> and <code>GatedOpener</code> are now private. <a class=anchor-link href=#gatedreader-and-gatedopener-are-now-private>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18473>#18473</a></div></div><p>The <code>GatedReader</code> and <code>GatedOpener</code> for <code>bevy_asset</code> have been made private. These were really only for testing, but were being compiled even in release builds. Now they are guarded by <code>#[cfg(test)]</code>!<p>If you were using this in your own tests, you could fork the <code>GatedReader</code> (it still exists in the Bevy repo!) into your own code, or write your own version (if more useful to you).<h3 id=updated-glam-rand-and-getrandom-versions-with-new-failures-when-building-for-web>Updated <code>glam</code>, <code>rand</code> and <code>getrandom</code> versions with new failures when building for web <a class=anchor-link href=#updated-glam-rand-and-getrandom-versions-with-new-failures-when-building-for-web>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18047>#18047</a></div></div><p>We've upgraded <code>glam</code> and the other math crates (<code>encase</code>, <code>hexasphere</code>) that move in lockstep to the latest versions. With newer versions of <code>glam</code> & <code>encase</code>, the updated versions don't seem to have introduced breakages, though as always, best to consult their docs <a href=https://docs.rs/glam/latest/glam/>1</a> <a href=https://docs.rs/encase/0.11.0/encase/>2</a> for any changes.<p>This has also upgraded the version of <code>rand</code> and <code>getrandom</code> that Bevy relies on. <code>rand</code> changes are more extensive, with changes such as <code>thread_rng()</code> -> <code>rng()</code>, <code>from_entropy()</code> -> <code>from_os_rng()</code>, and so forth. <code>RngCore</code> is now split into infallible <code>RngCore</code> and fallible <code>TryRngCore</code>, and the <code>distributions</code> module has been renamed to <code>distr</code>. Most of this affects only internals, and doesn't directly affect Bevy's APIs. For the full set of changes, see <code>rand</code> <a href=https://rust-random.github.io/book/update-0.9.html>migration notes</a>.<p><code>getrandom</code> is also updated, and will require additional configuration when building Bevy for WASM/web browsers. <strong>This will affect you even if you are not using <code>rand</code> or <code>getrandom</code> directly,</strong> as <code>glam</code> (and thus <code>bevy_math</code>) will pull it in.<p>You may encounter an error like:<pre class="language-toml z-code" data-lang=toml><code class=language-toml data-lang=toml><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">error</span><span class="z-invalid z-illegal z-key z-toml">:</span><span class="z-invalid z-illegal z-key z-toml"> </span></span><span class="z-invalid z-illegal z-keyval z-toml">the wasm*-unknown-unknown targets are not supported by default;</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">to</span><span class="z-invalid z-illegal z-key z-toml"> </span><span class="z-entity z-name z-tag z-toml">enable</span><span class="z-invalid z-illegal z-key z-toml"> </span><span class="z-entity z-name z-tag z-toml">support</span><span class="z-invalid z-illegal z-key z-toml">,</span><span class="z-invalid z-illegal z-key z-toml"> </span></span><span class="z-invalid z-illegal z-keyval z-toml">add this to your `Cargo.toml`:</span>
</span><span class="z-source z-toml">
</span><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">dependencies</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">getrandom</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>0.3<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-array z-begin z-toml">[</span><span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>wasm_js<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-definition z-array z-end z-toml">]</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span></code></pre><p>This is due to a breaking change in how <code>getrandom</code> handles entropy generation. For security reasons, this is no longer specified via feature flags, as any crate in your dependency tree could quietly enable additional entropy sources.<p>Quoting from the <code>getrandom</code> docs on <a href="https://github.com/rust-random/getrandom?tab=readme-ov-file#opt-in-backends">WebAssembly support in <code>getrandom</code></a> <a href="https://github.com/rust-random/getrandom?tab=readme-ov-file#webassembly-support">2</a>:<blockquote><p>To enable getrandom's functionality on wasm32-unknown-unknown using the Web Crypto methods described above via wasm-bindgen, do both of the following:<ol><li>Use the wasm_js feature flag, i.e. getrandom = { version = "0.3", features = ["wasm_js"] }. On its own, this only makes the backend available. (As a side effect this will make your Cargo.lock significantly larger if you are not already using wasm-bindgen, but otherwise enabling this feature is harmless.)<li>Set RUSTFLAGS='--cfg getrandom_backend="wasm_js"' (see above).</ol></blockquote><p>Note that if you were previously setting the <a href=https://doc.rust-lang.org/cargo/reference/environment-variables.html><code>RUSTFLAGS</code> environment variable</a> for any reason, this will override any previous settings: you need to add this to your existing list instead.<p>If you were using the community-provided <a href=https://github.com/TheBevyFlock/bevy_cli>Bevy CLI</a> to easily create builds of your game for different platforms (including web), make sure to update to v0.1.0-alpha.2 or later, which will <a href=https://thebevyflock.github.io/bevy_cli/cli/web/getrandom.html>automatically configure <code>RUSTFLAGS</code> for you</a>.<h3 id=overflowclipbox-s-default-is-now-paddingbox><code>OverflowClipBox</code>'s default is now <code>PaddingBox</code> <a class=anchor-link href=#overflowclipbox-s-default-is-now-paddingbox>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18935>#18935</a></div></div><p>The default variant for <code>OverflowClipBox</code> is now <code>PaddingBox</code>. The default value for <code>OverflowClipMargin::visual_box</code> is now <code>OverflowClipBox::PaddingBox</code>.<h3 id=event-trait-split-rename><code>Event</code> trait split / Rename <a class=anchor-link href=#event-trait-split-rename>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19647>#19647</a></div></div><p>"Buffered events" (things sent/read using <code>EventWriter</code> / <code>EventReader</code>) are now no longer referred to as "events", in the interest of conceptual clarity and learn-ability (see the release notes for rationale). "Event" as a concept (and the <code>Event</code> trait) are now used solely for "observable events". "Buffered events" are now known as "messages" and use the <code>Message</code> trait. <code>EventWriter</code>, <code>EventReader</code>, and <code>Events&LTE></code>, are now known as <code>MessageWriter</code>, <code>MessageReader</code>, and <code>Messages&LTM></code>. Types can be <em>both</em> "messages" and "events" by deriving both <code>Message</code> and <code>Event</code>, but we expect most types to only be used in one context or the other.<h3 id=deprecated-simple-executor>Deprecated Simple Executor <a class=anchor-link href=#deprecated-simple-executor>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18753>#18753</a></div></div><p>Bevy has deprecated <code>SimpleExecutor</code>, one of the <code>SystemExecutor</code>s in Bevy alongside <code>SingleThreadedExecutor</code> and <code>MultiThreadedExecutor</code> (which aren't going anywhere any time soon).<p>The <code>SimpleExecutor</code> leaves performance on the table compared to the other executors in favor of simplicity. Specifically, <code>SimpleExecutor</code> applies any commands a system produces right after it finishes, so every system starts with a clean <code>World</code> with no pending commands. As a result, the default <code>SimpleExecutor</code> runs all systems in the order they are added to the schedule, though more ordering constraints can be applied, like <code>before</code>, <code>after</code>, <code>chain</code>, etc. In other executors, these ordering onstraints also inform the executor exactly where to apply commands. For example, if system <code>A</code> produces commands and runs <code>before</code> system <code>B</code>, <code>A</code>'s commands will be applied before <code>B</code> starts. However, the <code>before</code> ordering is implicit in <code>SimpleExecutor</code> if <code>A</code> is added to the schedule before <code>B</code>.<p>The dueling behavior between ordering systems based on when they were added to a schedule as opposed to using ordering constraints is difficult to maintain and can be confusing, especially for new users. But, if you have a strong preference for the existing behavior of <code>SimpleExecutor</code>, please make an issue and we can discuss your needs.<p>If you were using <code>SimpleExecutor</code>, consider upgrading to <code>SingleThreadedExecutor</code> instead, or try <code>MultiThreadedExecutor</code> if it fits the schedule. The <code>MultiThreadedExecutor</code> is great at large schedules and async heavy work, and the <code>SingleThreadedExecutor</code> is good at smaller schedules or schedules that have fewer parallelizable systems. So what was <code>SimpleExecutor</code> good at? Not much. That's why we plan to remove it. Removing it will reduce some maintenance and consistency burdens, allowing us to focus on more exciting features!<p>When migrating, you might uncover bugs where one system depends on another's commands but is not ordered to reflect that. These bugs can be fixed by making those implicit orderings explicit via constraints like <code>before</code>, <code>after</code>, <code>chain</code>, etc. If finding all of those implicit but necessary orderings is unrealistic, <code>chain</code> can also be used to mimic the behavior of the <code>SimpleExecutor</code>. Again, if you run into trouble migrating, feel free to open an issue!<h3 id=reflectasset-now-uses-untypedassetid-instead-of-untypedhandle><code>ReflectAsset</code> now uses <code>UntypedAssetId</code> instead of <code>UntypedHandle</code> <a class=anchor-link href=#reflectasset-now-uses-untypedassetid-instead-of-untypedhandle>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19606>#19606</a></div></div><p>Previously, <code>ReflectAsset</code> methods all required having <code>UntypedHandle</code>. The only way to get an <code>UntypedHandle</code> through this API was with <code>ReflectAsset::add</code>. <code>ReflectAsset::ids</code> was not very useful in this regard.<p>Now, all methods have been changed to accept <code>impl Into&LTUntypedAssetId></code>, which matches our regular <code>Assets&LTT></code> API. This means you may need to change how you are calling these methods.<p>For example, if your code previously looked like:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> my_handle<span class="z-punctuation z-separator z-rust">:</span> UntypedHandle<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> my_asset <span class="z-keyword z-operator z-assignment z-rust">=</span> reflect_asset<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world<span class="z-punctuation z-separator z-rust">,</span> my_handle</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>You can migrate it to:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> my_handle<span class="z-punctuation z-separator z-rust">:</span> UntypedHandle<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> my_asset <span class="z-keyword z-operator z-assignment z-rust">=</span> reflect_asset<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world<span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-bitwise z-rust">&</span>my_handle</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">unwrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=replaced-textfont-constructor-methods-with-from-impls>Replaced <code>TextFont</code> constructor methods with <code>From</code> impls <a class=anchor-link href=#replaced-textfont-constructor-methods-with-from-impls>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20335>#20335</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20450>#20450</a></div></div><p>The <code>TextFont::from_font</code> and <code>TextFont::from_line_height</code> constructor methods have been removed in favor of <code>From</code> trait implementations.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> text_font <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">TextFont<span class="z-punctuation z-accessor z-rust">::</span></span>from_font<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>font_handle</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> text_font <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">TextFont<span class="z-punctuation z-accessor z-rust">::</span></span>from_line_height<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>line_height</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> text_font <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">TextFont<span class="z-punctuation z-accessor z-rust">::</span></span>from<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>font_handle</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> text_font <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">TextFont<span class="z-punctuation z-accessor z-rust">::</span></span>from<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>line_height</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=vectorspace-implementations><code>VectorSpace</code> implementations <a class=anchor-link href=#vectorspace-implementations>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19194>#19194</a></div></div><p>Previously, implementing <code>VectorSpace</code> for a type required your type to use or at least interface with <code>f32</code>. This made implementing <code>VectorSpace</code> for double-precision types (like <code>DVec3</code>) less meaningful and useful, requiring lots of casting. <code>VectorSpace</code> has a new required associated type <code>Scalar</code> that's bounded by a new trait <code>ScalarField</code>. <code>bevy_math</code> implements this trait for <code>f64</code> and <code>f32</code> out of the box, and <code>VectorSpace</code> is now implemented for <code>DVec[N]</code> types.<p>If you manually implemented <code>VectorSpace</code> for any type, you'll need to implement <code>Scalar</code> for it. If you were working with single-precision floating-point types and you want the exact behavior from before, set it to <code>f32</code>.<h3 id=improve-error-when-using-run-system-command-with-a-systemid-of-wrong-type>Improve error when using <code>run_system</code> command with a <code>SystemId</code> of wrong type <a class=anchor-link href=#improve-error-when-using-run-system-command-with-a-systemid-of-wrong-type>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19011>#19011</a></div></div><p>Added a new error to <code>RegisteredSystemError</code> to inform of use of <code>run_system</code> command and its variants with a <code>SystemId</code> of wrong type.<h3 id=extract-ui-text-colors-per-glyph>Extract UI text colors per glyph <a class=anchor-link href=#extract-ui-text-colors-per-glyph>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20245>#20245</a></div></div><p>The UI renderer now extracts text colors per glyph and transforms per text section. <code>color: LinearRgba</code> and <code>translation: Vec2</code> have been added to <code>ExtractedGlyph</code>. The <code>transform</code> field has moved from <code>ExtractedGlyph</code> and <code>ExtractedUiNode</code> to <code>ExtractedUiItem</code>. The <code>rect</code> field has moved from <code>ExtractedUiNode</code> to <code>ExtractedUiItem</code>.<h3 id=textureformat-pixel-size-now-returns-a-result>TextureFormat::pixel_size now returns a Result <a class=anchor-link href=#textureformat-pixel-size-now-returns-a-result>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20574>#20574</a></div></div><p>The <code>TextureFormat::pixel_size()</code> method now returns a <code>Result&LTusize, TextureAccessError></code> instead of <code>usize</code>.<p>This change was made because not all texture formats have a well-defined pixel size (e.g. compressed formats). Previously, calling this method on such formats could lead to runtime panics. The new return type makes the API safer and more explicit about this possibility.<p>To migrate your code, you will need to handle the <code>Result</code> returned by <code>pixel_size()</code>.<h3 id=entities-api-changes><code>Entities</code> API changes <a class=anchor-link href=#entities-api-changes>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19350>#19350</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19433>#19433</a></div></div><p><code>Entities::flush</code> now also asks for metadata about the flush operation that will be stored for the flushed entities. For the source location, <code>MaybeLocation::caller()</code> can be used; the tick should be retrieved from the world.<p>Additionally, flush now gives <code>&mut EntityIdLocation</code> instead of <code>&mut EntityLocation</code> access. <code>EntityIdLocation</code> is an alias for <code>Option&LTEntityLocation></code>. This replaces invalid locations with <code>None</code>. It is possible for an <code>Entity</code> id to be allocated/reserved but not yet have a location. This is used in commands for example, and this reality is more transparent with an <code>Option</code>. This extends to other interfaces: <code>Entities::free</code> now returns <code>Option&LTEntityIdLocation></code> instead of <code>Option&LTEntityLocation></code>. <code>Entities::get</code> remains unchanged, but you can access an <code>Entity</code>'s <code>EntityIdLocation</code> through the new <code>Entities::get_id_location</code>.<h3 id=relationship-method-set-risky>Relationship method set_risky <a class=anchor-link href=#relationship-method-set-risky>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19601>#19601</a></div></div><p>The trait <code>Relationship</code> received a new method, <code>set_risky</code>. It is used to alter the entity ID of the entity that contains its <code>RelationshipTarget</code> counterpart. This is needed to leave <a href=https://docs.rs/bevy/latest/bevy/ecs/relationship/trait.Relationship.html#derive>other data you can store in these components</a> unchanged at operations that reassign the relationship target, for example <code>EntityCommands::add_related</code>. Previously this could have caused the data to be reset to its default value which may not be what you wanted to happen.<p>Manually overwriting the component is still possible everywhere the full component is inserted:<pre class="language-rs z-code" data-lang=rs><code class=language-rs data-lang=rs><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">relationship</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">relationship_target <span class="z-keyword z-operator z-rust">=</span> CarOwner</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">OwnedCar</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">relationship</span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">owner</span><span class="z-punctuation z-separator z-type z-rust">:</span> Entity,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">first_owner</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Entity<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> None if `owner` is the first one
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Component</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">relationship_target</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">relationship <span class="z-keyword z-operator z-rust">=</span> OwnedCar</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">CarOwner</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Vec</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Entity<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> me_entity_mut <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>me_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> if `car_entity` already contains `OwnedCar`, then the first owner remains unchanged
</span></span><span class="z-source z-rust">me_entity_mut<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">add_one_related<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>OwnedCar<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>car_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> if `car_entity` already contains `OwnedCar`, then the first owner is overwritten with None here
</span></span><span class="z-source z-rust">car_entity_mut<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">insert</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>OwnedCar <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    owner<span class="z-punctuation z-separator z-rust">:</span> me_entity<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    first_owner<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">None</span> <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> I swear it is not stolen officer!
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>The new method should not be called by user code as that can invalidate the relationship it had or will have.<p>If you implement <code>Relationship</code> manually (which is strongly discouraged) then this method needs to overwrite the <code>Entity</code> used for the relationship.<h3 id=unified-system-state-flag>Unified system state flag <a class=anchor-link href=#unified-system-state-flag>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19506>#19506</a></div></div><p>Now the system have a unified <code>SystemStateFlags</code> to represent its different states.<p>If your code previously looked like this:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">System <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyCustomSystem</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ...
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">is_send</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">bool</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-constant z-language z-rust">false</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">is_exclusive</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">bool</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-constant z-language z-rust">true</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">has_deferred</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">bool</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-constant z-language z-rust">false</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ....
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>You should migrate it to:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">System <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyCustomSystem</span></span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ...
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">flags</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> SystemStateFlags</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> non-send , exclusive , no deferred
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-path z-rust">SystemStateFlags<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-constant z-other z-rust">NON_SEND</span> <span class="z-keyword z-operator z-bitwise z-rust">|</span> <span class="z-meta z-path z-rust">SystemStateFlags<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-constant z-other z-rust">EXCLUSIVE</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ...
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h3 id=dynamicbundle><code>DynamicBundle</code> <a class=anchor-link href=#dynamicbundle>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20772>#20772</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20877>#20877</a></div></div><p>In order to reduce the stack size taken up by spawning and inserting large bundles, the way the (mostly internal) trait <code>DynamicBundle</code> gets called has changed significantly:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-storage z-type z-trait z-rust">trait</span> <span class="z-entity z-name z-trait z-rust">DynamicBundle</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-type z-rust">type</span> <span class="z-entity z-name z-type z-rust">Effect</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> hidden in the docs
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">get_components</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">func</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> impl FnMut<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-variable z-parameter z-rust">StorageType</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-parameter z-rust">OwningPtr</span><'_></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Effect</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-storage z-type z-trait z-rust">trait</span> <span class="z-entity z-name z-trait z-rust">DynamicBundle</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-type z-rust">type</span> <span class="z-entity z-name z-type z-rust">Effect</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">unsafe</span> <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">get_components</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">ptr</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-variable z-parameter z-rust">func</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> impl FnMut<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-variable z-parameter z-rust">StorageType</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-variable z-parameter z-rust">MovingPtr</span><'_></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">unsafe</span> <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">apply_effect</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">ptr</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-meta z-generic z-rust">MaybeUninit<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-variable z-parameter z-rust">entity</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> EntityWorldMut</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>To prevent unnecessary copies to the stack, <code>get_components</code> now takes a <code>MovingPtr<'_, Self></code> instead of <code>self</code> by value.<p><code>MovingPtr&LTT></code> is a safe, typed, box-like pointer that owns the data it points to, but not the underlying memory: that means the owner of a <code>MovingPtr&LTT></code> can freely move parts of the data out and doesn't have to worry about de-allocating memory. Much like <code>Box&LTT></code>, <code>MovingPtr&LTT></code> implements <code>Deref</code> and <code>DerefMut</code> for easy access to the stored type, when it's safe to do so. To decompose the value inside of the <code>MovingPtr&LTT></code> into its fields without copying them to the stack, you can use the <code>deconstruct_moving_ptr!</code> macro to give you <code>MovingPtr&LTU></code>s to each field specified:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-generic z-rust"><span class="z-entity z-name z-struct z-rust">MySpecialBundle</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>A<span class="z-punctuation z-separator z-rust">:</span> Bundle, B<span class="z-punctuation z-separator z-rust">:</span> Bundle<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span></span><span class="z-meta z-struct z-rust"> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">a</span><span class="z-punctuation z-separator z-type z-rust">:</span> A,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">b</span><span class="z-punctuation z-separator z-type z-rust">:</span> B,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> my_ptr<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-meta z-generic z-rust">MySpecialBundle<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">u32</span>, <span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-keyword z-operator z-range z-rust">...</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">deconstruct_moving_ptr!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> MySpecialBundle <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> a<span class="z-punctuation z-separator z-rust">,</span> b </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> my_ptr<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> a_ptr<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-storage z-type z-rust">u32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> a<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> b_ptr<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> b<span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Similar to <code>Box::into_inner</code>, <code>MovingPtr&LTT></code> also has a method <code>MovingPtr::read</code> for moving the whole value out of the pointer onto the stack:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> a<span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">u32</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> a_ptr<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">read</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> b<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">String</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> b_ptr<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">read</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p><code>apply_effect</code> is a new method that takes the job of the old <code>BundleEffect</code> trait, and gets called once after <code>get_components</code> for any <code>B::Effect: !NoBundleEffect</code>. Since <code>get_components</code> might have already partially moved out some of the fields of the bundle, <code>apply_effect</code> takes a <code>MovingPtr<'_, MaybeUninit&LTSelf>></code> and implementers must make sure not to create any references to fields that are no longer initialized. Likewise, implementers of <code>get_components</code> must take care not to move out fields that will be needed in <code>apply_effect</code>. <code>deconstruct_moving_ptr!</code> can be used to selectively move out fields, which can then be forgotten with <code>mem::forget</code> to be valid for the subsequent call to <code>apply_effect</code>. The associated type <code>Effect</code> remains as a vestigial marker to keep track of whether <code>apply_effect</code> needs to be called for any <code>B::Effect: !NoBundleEffect</code>.<h3 id=exclusive-systems-may-not-be-used-as-observers>Exclusive systems may not be used as observers <a class=anchor-link href=#exclusive-systems-may-not-be-used-as-observers>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19033>#19033</a></div></div><p>Exclusive systems may no longer be used as observers. This was never sound, as the engine keeps references alive during observer invocation that would be invalidated by <code>&mut World</code> access, but was accidentally allowed. Instead of <code>&mut World</code>, use either <code>DeferredWorld</code> if you do not need structural changes, or <code>Commands</code> if you do.<h3 id=entityclonerbuilder-split>EntityClonerBuilder Split <a class=anchor-link href=#entityclonerbuilder-split>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19649>#19649</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19977>#19977</a></div></div><p><code>EntityClonerBuilder</code> is now generic and has different methods depending on the generic.<p>To get the wanted one, <code>EntityCloner::build</code> got split too:<ul><li><code>EntityCloner::build_opt_out</code> to get <code>EntityClonerBuilder&LTOptOut></code><li><code>EntityCloner::build_opt_in</code> to get <code>EntityClonerBuilder&LTOptIn></code></ul><p>The first is used to clone all components possible and optionally <em>opting out</em> of some. The second is used to only clone components as specified by <em>opting in</em> for them.<pre class="language-rs z-code" data-lang=rs><code class=language-rs data-lang=rs><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> builder <span class="z-keyword z-operator z-assignment z-rust">=</span> EntityCloner<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">build</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">allow_all</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">deny<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>ComponentThatShouldNotBeCloned<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>source_entity<span class="z-punctuation z-separator z-rust">,</span> target_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> builder <span class="z-keyword z-operator z-assignment z-rust">=</span> EntityCloner<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">build</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">deny_all</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">allow<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>ComponentThatShouldBeCloned<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>source_entity<span class="z-punctuation z-separator z-rust">,</span> target_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> builder <span class="z-keyword z-operator z-assignment z-rust">=</span> EntityCloner<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">build_opt_out</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">deny<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>ComponentThatShouldNotBeCloned<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>source_entity<span class="z-punctuation z-separator z-rust">,</span> target_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> builder <span class="z-keyword z-operator z-assignment z-rust">=</span> EntityCloner<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">build_opt_in</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">allow<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>ComponentThatShouldBeCloned<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">builder<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>source_entity<span class="z-punctuation z-separator z-rust">,</span> target_entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Still, using <code>EntityClonerBuilder::finish</code> will return a non-generic <code>EntityCloner</code>. This change is done because the behavior of the two is too different to share the same struct and same methods and mixing them caused bugs.<p>The methods of the two builder types are different to 0.16 and to each other now:<h4 id=opt-out-variant>Opt-Out variant <a class=anchor-link href=#opt-out-variant>#</a></h4><ul><li>Still offers variants of the <code>deny</code> methods.<li>No longer offers <code>allow</code> methods, you need to be exact with denying components.<li>Offers now the <code>insert_mode</code> method to configure if components are cloned if they already exist at the target.<li>Required components of denied components are no longer considered. Denying <code>A</code>, which requires <code>B</code>, does not imply <code>B</code> alone would not be useful at the target. So if you do not want to clone <code>B</code> too, you need to deny it explicitly. This also means there is no <code>without_required_components</code> method anymore as that would be redundant.<li>It is now the other way around: Denying <code>A</code>, which is required <em>by</em> <code>C</code>, will now also deny <code>C</code>. This can be bypassed with the new <code>without_required_by_components</code> method.</ul><h4 id=opt-in-variant>Opt-In variant <a class=anchor-link href=#opt-in-variant>#</a></h4><ul><li>Still offers variants of the <code>allow</code> methods.<li>No longer offers <code>deny</code> methods, you need to be exact with allowing components.<li>Offers now <code>allow_if_new</code> method variants that only clone this component if the target does not contain it. If it does, required components of it will also not be cloned, except those that are also required by one that is actually cloned.<li>Still offers the <code>without_required_components</code> method.</ul><h4 id=common-methods>Common methods <a class=anchor-link href=#common-methods>#</a></h4><p>All other methods <code>EntityClonerBuilder</code> had in 0.16 are still available for both variants:<ul><li><code>with_default_clone_fn</code><li><code>move_components</code><li><code>clone_behavior</code> variants<li><code>linked_cloning</code></ul><h4 id=unified-id-filtering>Unified id filtering <a class=anchor-link href=#unified-id-filtering>#</a></h4><p>Previously <code>EntityClonerBuilder</code> supported filtering by 2 types of ids: <code>ComponentId</code> and <code>TypeId</code>, the functions taking in <code>IntoIterator</code> for them. Since now <code>EntityClonerBuilder</code> supports filtering by <code>BundleId</code> as well, the number of method variations would become a bit too unwieldy. Instead, all id filtering methods were unified into generic <code>deny_by_ids/allow_by_ids(_if_new)</code> methods, which allow to filter components by <code>TypeId</code>, <code>ComponentId</code>, <code>BundleId</code> and their <code>IntoIterator</code> variations.<h4 id=other-affected-apis>Other affected APIs <a class=anchor-link href=#other-affected-apis>#</a></h4><table><thead><tr><th>0.16<th>0.17<tbody><tr><td><code>EntityWorldMut::clone_with</code><td><code>EntityWorldMut::clone_with_opt_out</code> <code>EntityWorldMut::clone_with_opt_in</code><tr><td><code>EntityWorldMut::clone_and_spawn_with</code><td><code>EntityWorldMut::clone_and_spawn_with_opt_out</code> <code>EntityWorldMut::clone_and_spawn_with_opt_in</code><tr><td><code>EntityCommands::clone_with</code><td><code>EntityCommands::clone_with_opt_out</code> <code>EntityCommands::clone_with_opt_in</code><tr><td><code>EntityCommands::clone_and_spawn_with</code><td><code>EntityCommands::clone_and_spawn_with_opt_out</code> <code>EntityCommands::clone_and_spawn_with_opt_in</code><tr><td><code>entity_command::clone_with</code><td><code>entity_command::clone_with_opt_out</code> <code>entity_command::clone_with_opt_in</code></table><h3 id=changes-to-type-registration-for-reflection>Changes to type registration for reflection <a class=anchor-link href=#changes-to-type-registration-for-reflection>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15030>#15030</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20435>#20435</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20893>#20893</a></div></div><p>Calling <code>.register_type</code> has long been a nuisance for Bevy users: both library authors and end users. This step was previously required in order to register reflected type information in the <code>TypeRegistry</code>.<p>In Bevy 0.17 however, types which implement <code>Reflect</code> are now automatically registered, with the help of some compiler magic. You should be able to remove almost all of your <code>register_type</code> calls. This comes with a few caveats however:<ol><li>Automatic type registration is gated by feature flags.<li>There are two approaches to do this: one has incomplete platform support, while the other relies on a specific project structure.<li>Generic types are not automatically registered, and must still be manually registered.</ol><p>In order for Bevy to automatically register your types, you need to turn on the <code>reflect_auto_register</code> feature, or the fallback <code>reflect_auto_register_static</code>. The <code>reflect_auto_register</code> feature is part of Bevy's default features, and can be overridden by the <code>reflect_auto_register_static</code> feature flag. Be aware that the <code>reflect_auto_register_static</code> feature comes with some caveats for project structure: check the docs for <a href=https://docs.rs/bevy/0.17.0-rc.1/bevy/reflect/macro.load_type_registrations.html>load_type_registrations!</a> and follow the <a href=https://github.com/bevyengine/bevy/tree/main/examples/reflection/auto_register_static><code>auto_register_static</code> example</a>.<p>We recommend that you:<ol><li>Enable <code>reflect_auto_register</code> in your application code, CI and in examples/tests. You can enable <code>bevy</code> features for tests only by adding a matching copy of <code>bevy</code> to <code>dev-dependencies</code> with the needed features enabled.<li>Do not enable the <code>reflect_auto_register</code> feature or the fallback <code>reflect_auto_register_static</code> in your library code.<li>As a library author, you can safely remove all non-generic <code>.register_type</code> calls.<li>As a user, if you run into an unregistered generic type with the correct feature enabled, file a bug with the project that defined the offending type, and workaround it by calling <code>.register_type</code> manually.<li>If you are on an unsupported platform but need reflection support, try the <code>reflect_autoregister_static</code> feature, and consider working upstream to add support for your platform in <code>inventory</code>. As a last resort, you can still manually register all of the needed types in your application code.</ol><h3 id=composable-specialization>Composable Specialization <a class=anchor-link href=#composable-specialization>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17373>#17373</a></div></div><p>The existing pipeline specialization APIs (<code>SpecializedRenderPipeline</code> etc.) have been replaced with a single <code>Specializer</code> trait and <code>Variants</code> collection:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-trait z-rust">trait</span> <span class="z-entity z-name z-trait z-rust">Specializer</span>&LTT: Specializable>: Send + Sync + 'static <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-type z-rust">type</span> <span class="z-entity z-name z-type z-rust">Key</span><span class="z-punctuation z-separator z-rust">:</span> SpecializerKey<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">specialize</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">key</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Key,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">descriptor</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">T</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Descriptor,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    </span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">Canonical<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Key<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, BevyError<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-trait z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-generic z-rust"><span class="z-entity z-name z-struct z-rust">Variants</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>T<span class="z-punctuation z-separator z-rust">:</span> Specializable, S<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Specializer<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>T<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span></span><span class="z-meta z-struct z-rust"></span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> ... </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>For more info on specialization, see the docs for <code>bevy_render::render_resources::Specializer</code><h4 id=mutation-and-base-descriptors>Mutation and Base Descriptors <a class=anchor-link href=#mutation-and-base-descriptors>#</a></h4><p>The main difference between the old and new trait is that instead of <em>producing</em> a pipeline descriptor, <code>Specializer</code>s <em>mutate</em> existing descriptors based on a key. As such, <code>Variants::new</code> takes in a "base descriptor" to act as the template from which the specializer creates pipeline variants.<p>When migrating, the "static" parts of the pipeline (that don't depend on the key) should become part of the base descriptor, while the specializer itself should only change the parts demanded by the key. In the full example below, instead of creating the entire pipeline descriptor the specializer only changes the msaa sample count and the bind group layout.<h4 id=composing-specializers>Composing Specializers <a class=anchor-link href=#composing-specializers>#</a></h4><p><code>Specializer</code>s can also be <em>composed</em> with the included derive macro to combine their effects! This is a great way to encapsulate and reuse specialization logic, though the rest of this guide will focus on migrating "standalone" specializers.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MsaaSpecializer</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>...</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-generic z-rust">Specialize<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderPipeline<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MsaaSpecializer</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span><span class="z-keyword z-operator z-range z-rust">...</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MeshLayoutSpecializer</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>...</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-generic z-rust">Specialize<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderPipeline<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MeshLayoutSpecializer</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span><span class="z-keyword z-operator z-range z-rust">...</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Specializer</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">specialize</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">RenderPipeline</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MySpecializer</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">msaa</span><span class="z-punctuation z-separator z-type z-rust">:</span> MsaaSpecializer,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">mesh_layout</span><span class="z-punctuation z-separator z-type z-rust">:</span> MeshLayoutSpecializer,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h4 id=misc-changes>Misc Changes <a class=anchor-link href=#misc-changes>#</a></h4><p>The analogue of <code>SpecializedRenderPipelines</code>, <code>Variants</code>, is no longer a Bevy <code>Resource</code>. Instead, the cache should be stored in a user-created <code>Resource</code> (shown below) or even in a <code>Component</code> depending on the use case.<h4 id=full-migration-example>Full Migration Example <a class=anchor-link href=#full-migration-example>#</a></h4><p>Before:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Resource</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MyPipeline</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">layout</span><span class="z-punctuation z-separator z-type z-rust">:</span> BindGroupLayout,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">layout_msaa</span><span class="z-punctuation z-separator z-type z-rust">:</span> BindGroupLayout,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">vertex</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust">Handle<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Shader<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">fragment</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust">Handle<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Shader<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> before
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Clone<span class="z-punctuation z-separator z-rust">,</span> Copy<span class="z-punctuation z-separator z-rust">,</span> PartialEq<span class="z-punctuation z-separator z-rust">,</span> Eq<span class="z-punctuation z-separator z-rust">,</span> Hash</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MyPipelineKey</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">msaa</span><span class="z-punctuation z-separator z-type z-rust">:</span> Msaa,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">FromWorld <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyPipeline</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">from_world</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">Self</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> render_device <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderDevice<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> asset_server <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>AssetServer<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> layout <span class="z-keyword z-operator z-assignment z-rust">=</span> render_device<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">create_bind_group_layout</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-range z-rust">...</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> layout_msaa <span class="z-keyword z-operator z-assignment z-rust">=</span> render_device<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">create_bind_group_layout</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-range z-rust">...</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> vertex <span class="z-keyword z-operator z-assignment z-rust">=</span> asset_server<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">load</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>vertex.wgsl<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> fragment <span class="z-keyword z-operator z-assignment z-rust">=</span> asset_server<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">load</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>fragment.wgsl<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">Self</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            layout<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            layout_msaa<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            vertex<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            fragment<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">SpecializedRenderPipeline <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyPipeline</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-type z-rust">type</span> <span class="z-entity z-name z-type z-rust">Key</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> MyPipelineKey<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">specialize</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">key</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Key</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> RenderPipelineDescriptor</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        RenderPipelineDescriptor <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            label<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>my_pipeline<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            layout<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-macro z-rust">vec!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">                <span class="z-keyword z-control z-rust">if</span> key<span class="z-punctuation z-accessor z-dot z-rust">.</span>msaa<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">samples</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-comparison z-rust">></span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                    <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>layout_msaa<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-control z-rust">else</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                    <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>layout<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">            <span class="z-punctuation z-section z-group z-end z-rust">]</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            vertex<span class="z-punctuation z-separator z-rust">:</span> VertexState <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                shader<span class="z-punctuation z-separator z-rust">:</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>vertex<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            multisample<span class="z-punctuation z-separator z-rust">:</span> MultisampleState <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                count<span class="z-punctuation z-separator z-rust">:</span> key<span class="z-punctuation z-accessor z-dot z-rust">.</span>msaa<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">samples</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            fragment<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>FragmentState <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                shader<span class="z-punctuation z-separator z-rust">:</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>fragment<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                targets<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-macro z-rust">vec!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>ColorTargetState <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                    format<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">TextureFormat<span class="z-punctuation z-accessor z-rust">::</span></span>Rgba8Unorm<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                    blend<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">None</span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                    write_mask<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">ColorWrites<span class="z-punctuation z-accessor z-rust">::</span></span>all<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust">render_app
</span><span class="z-source z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">init_resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>MyPipeline<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">init_resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">SpecializedRenderPipelines<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>MySpecializer<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>After:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Resource</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MyPipeline</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> the base_descriptor and specializer each hold onto the static
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> wgpu resources (layout, shader handles), so we don't need
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> explicit fields for them here. However, real-world cases
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> may still need to expose them as fields to create bind groups
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> from, for example.
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">variants</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-meta z-generic z-rust">Variants<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderPipeline, MySpecializer<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MySpecializer</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">layout</span><span class="z-punctuation z-separator z-type z-rust">:</span> BindGroupLayout,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">layout_msaa</span><span class="z-punctuation z-separator z-type z-rust">:</span> BindGroupLayout,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Clone<span class="z-punctuation z-separator z-rust">,</span> Copy<span class="z-punctuation z-separator z-rust">,</span> PartialEq<span class="z-punctuation z-separator z-rust">,</span> Eq<span class="z-punctuation z-separator z-rust">,</span> Hash<span class="z-punctuation z-separator z-rust">,</span> SpecializerKey</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MyPipelineKey</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">msaa</span><span class="z-punctuation z-separator z-type z-rust">:</span> Msaa,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">FromWorld <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyPipeline</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">from_world</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">Self</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> render_device <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderDevice<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> asset_server <span class="z-keyword z-operator z-assignment z-rust">=</span> world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>AssetServer<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> layout <span class="z-keyword z-operator z-assignment z-rust">=</span> render_device<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">create_bind_group_layout</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-range z-rust">...</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> layout_msaa <span class="z-keyword z-operator z-assignment z-rust">=</span> render_device<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">create_bind_group_layout</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-range z-rust">...</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> vertex <span class="z-keyword z-operator z-assignment z-rust">=</span> asset_server<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">load</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>vertex.wgsl<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> fragment <span class="z-keyword z-operator z-assignment z-rust">=</span> asset_server<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">load</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>fragment.wgsl<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> base_descriptor <span class="z-keyword z-operator z-assignment z-rust">=</span> RenderPipelineDescriptor <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            label<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>my_pipeline<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            vertex<span class="z-punctuation z-separator z-rust">:</span> VertexState <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                shader<span class="z-punctuation z-separator z-rust">:</span> vertex<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">                <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            fragment<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">Some</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>FragmentState <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                shader<span class="z-punctuation z-separator z-rust">:</span> fragment<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-keyword z-operator z-range z-rust">..</span><span class="z-support z-function z-rust">default</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> variants <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Variants<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">            MySpecializer <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                layout<span class="z-punctuation z-separator z-rust">:</span> layout<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                layout_msaa<span class="z-punctuation z-separator z-rust">:</span> layout_msaa<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">            base_descriptor<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust">        </span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">Self</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> variants </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-generic z-rust">Specializer<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>RenderPipeline<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MySpecializer</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-type z-rust">type</span> <span class="z-entity z-name z-type z-rust">Key</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> MyKey<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">specialize</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">key</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Key,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">        <span class="z-variable z-parameter z-rust">descriptor</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> RenderPipeline,
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    </span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">Canonical<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Key<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, BevyError<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        descriptor<span class="z-punctuation z-accessor z-dot z-rust">.</span>multisample<span class="z-punctuation z-accessor z-dot z-rust">.</span>count <span class="z-keyword z-operator z-assignment z-rust">=</span> key<span class="z-punctuation z-accessor z-dot z-rust">.</span>msaa<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">samples</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> layout <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-keyword z-control z-rust">if</span> key<span class="z-punctuation z-accessor z-dot z-rust">.</span>msaa<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">samples</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-comparison z-rust">></span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>layout_msaa<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-control z-rust">else</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>layout<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        descriptor<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">set_layout</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">0</span><span class="z-punctuation z-separator z-rust">,</span> layout</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>key</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust">render_app<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">init_resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>MyPipeline<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span></code></pre><h3 id=entry-enum-is-now-componententry><code>Entry</code> enum is now <code>ComponentEntry</code> <a class=anchor-link href=#entry-enum-is-now-componententry>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19517>#19517</a></div></div><p>The <code>Entry</code> enum in <code>bevy::ecs::world</code> has been renamed to <code>ComponentEntry</code>, to avoid name clashes with <code>hash_map</code>, <code>hash_table</code> and <code>hash_set</code> <code>Entry</code> types.<p>Correspondingly, the nested <code>OccupiedEntry</code> and <code>VacantEntry</code> enums have been renamed to <code>OccupiedComponentEntry</code> and <code>VacantComponentEntry</code>.<h3 id=state-scoped-entities-are-now-always-enabled-implicitly>State-scoped entities are now always enabled implicitly <a class=anchor-link href=#state-scoped-entities-are-now-always-enabled-implicitly>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19354>#19354</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20883>#20883</a></div></div><p>State scoped entities is now always enabled, and as a consequence, <code>app.enable_state_scoped_entities::&LTState>()</code> is no longer needed. It has been marked as deprecated and does nothing when called.<p>The attribute <code>#[states(scoped_entities)]</code> has been removed. You can safely remove it from your code without replacement.<h3 id=required-components-refactor>Required components refactor <a class=anchor-link href=#required-components-refactor>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20110>#20110</a></div></div><p>The required components feature has been reworked to be more consistent around the priority of the required components and fix some soundness issues. In particular:<ul><li>the priority of required components will now always follow a priority given by the depth-first/preorder traversal of the dependency tree. This was mostly the case before with a couple of exceptions that we are now fixing: <ul><li>when deriving the <code>Component</code> trait, sometimes required components at depth 1 had priority over components at depth 2 even if they came after in the depth-first ordering;<li>registering runtime required components followed a breadth-first ordering and used the wrong inheritance depth for derived required components.</ul><li>uses of the inheritance depth were removed from the <code>RequiredComponent</code> struct and from the methods for registering runtime required components, as it's not unused for the depth-first ordering;<li><code>Component::register_required_components</code>, <code>RequiredComponents::register</code> and <code>RequiredComponents::register_by_id</code> are now <code>unsafe</code>;<li><code>RequiredComponentConstructor</code>'s only field is now private for safety reasons.</ul><p>The <code>Component::register_required_components</code> method has also changed signature. It now takes the <code>ComponentId</code> of the component currently being registered and a single other parameter <code>RequiredComponentsRegistrator</code> which combines the old <code>components</code> and <code>required_components</code> parameters, since exposing both of them was unsound. As previously discussed the <code>inheritance_depth</code> is now useless and has been removed, while the <code>recursion_check_stack</code> has been moved into <code>ComponentsRegistrator</code> and will be handled automatically.<h3 id=view-transformations-wgsl-deprecated-in-favor-of-view-wgsl>view_transformations.wgsl deprecated in favor of view.wgsl <a class=anchor-link href=#view-transformations-wgsl-deprecated-in-favor-of-view-wgsl>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20313>#20313</a></div></div><p>All functions in view_transformations.wgsl have been replaced and deprecated.<p>To migrate, a straight-forward copy-paste inlining of the deprecated function's new body suffices, as they all now call the new api internally.<p>For example, if you had before:<pre class="language-wgsl z-code" data-lang=wgsl><code class=language-wgsl data-lang=wgsl><span class="z-source z-wgsl"><span class="z-invalid z-deprecated z-wgsl">#import</span> <span class="z-variable z-other z-wgsl">bevy_pbr</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-variable z-other z-wgsl">view_transformations</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-keyword z-other z-declarations-and-types z-wgsl">let</span> <span class="z-variable z-other z-wgsl">world_pos</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-variable z-other z-wgsl">view_transformations</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-meta z-function z-wgsl"><span class="z-entity z-name z-function z-wgsl">position_view_to_world</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">view_pos</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span></code></pre><p>Now it would be:<pre class="language-wgsl z-code" data-lang=wgsl><code class=language-wgsl data-lang=wgsl><span class="z-source z-wgsl"><span class="z-invalid z-deprecated z-wgsl">#import</span> <span class="z-variable z-other z-wgsl">bevy_render</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-variable z-other z-wgsl">view</span>
</span><span class="z-source z-wgsl">
</span><span class="z-source z-wgsl"><span class="z-keyword z-other z-declarations-and-types z-wgsl">let</span> <span class="z-variable z-other z-wgsl">world_pos</span> <span class="z-keyword z-operator z-assignment z-equal z-wgsl">=</span> <span class="z-variable z-other z-wgsl">view</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-meta z-function z-wgsl"><span class="z-entity z-name z-function z-wgsl">position_view_to_world</span><span class="z-punctuation z-brackets z-round z-wgsl">(</span><span class="z-variable z-other z-wgsl">view_pos</span><span class="z-punctuation z-comma z-wgsl">,</span> <span class="z-variable z-other z-wgsl">view_bindings</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-keyword z-operator z-type z-annotation z-wgsl">:</span><span class="z-variable z-other z-wgsl">view</span><span class="z-keyword z-operator z-access z-dot z-wgsl">.</span><span class="z-variable z-other z-wgsl">world_from_view</span><span class="z-punctuation z-brackets z-round z-wgsl">)</span></span><span class="z-punctuation z-semi z-wgsl">;</span>
</span></code></pre><p>This was done to make it possible to pass in custom view bindings, and allow code reuse.<p><code>view_transformations.wgsl</code> will be deleted in 0.18.<h3 id=replace-gilrs-accesskitadapters-and-winitwindows-non-send-resources>Replace <code>Gilrs</code>, <code>AccessKitAdapters</code>, and <code>WinitWindows</code> non-send resources <a class=anchor-link href=#replace-gilrs-accesskitadapters-and-winitwindows-non-send-resources>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18386>#18386</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/17730>#17730</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19575>#19575</a></div></div><p>We are <a href=https://discord.com/channels/691052431525675048/1332109626962874468>working</a> to move <code>!Send</code> data out of the ECS, in order to simplify internal implementation, reduce the risk of soundness problems and unblock features such as resources-as-entities and improved scheduling.<p>For now, the API for user-provided <code>NonSend</code> types is unchanged, but we are considering forcing all users to migrate to a solution similar to the one discussed below.<h4 id=first-party-nonsend-resources-replaced>First-party <code>NonSend</code> Resources Replaced <a class=anchor-link href=#first-party-nonsend-resources-replaced>#</a></h4><p>Internally, we have replaced the following resources:<ul><li><code>Gilrs</code> - <em>For wasm32 only, other platforms are unchanged -</em> Replaced with <code>bevy_gilrs::GILRS</code><li><code>WinitWindows</code> - Replaced with <code>bevy_winit::WINIT_WINDOWS</code><li><code>AccessKitAdapters</code> - Replaced with <code>bevy_winit::ACCESS_KIT_ADAPTERS</code></ul><p>Each of these are now using <code>thread_local</code>s to store the data and are temporary solutions to storing <code>!Send</code> data. Even though <code>thread_local</code>s are thread safe, they should not be accessed from other threads. If they are accessed from other threads, the data will be uninitialized in each non-main thread, which isn't very useful.<p>Here is an example of how the data can now be accessed. This example will use <code>WINIT_WINDOWS</code> as an example, but the same technique can be applied to the others:<h5 id=immutable-access>Immutable Access <a class=anchor-link href=#immutable-access>#</a></h5><pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy_winit<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-constant z-other z-rust">WINIT_WINDOWS</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-keyword z-operator z-range z-rust">...</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-constant z-other z-rust">WINIT_WINDOWS</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_borrow</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">winit_windows</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> do things with `winit_windows`
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h5 id=mutable-access>Mutable Access <a class=anchor-link href=#mutable-access>#</a></h5><pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy_winit<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-constant z-other z-rust">WINIT_WINDOWS</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-keyword z-operator z-range z-rust">...</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-constant z-other z-rust">WINIT_WINDOWS</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_borrow_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">winit_windows</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> do things with `winit_windows`
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>If a borrow is attempted while the data is borrowed elsewhere, the method will panic.<h4 id=nonsend-systems>NonSend Systems <a class=anchor-link href=#nonsend-systems>#</a></h4><p>The use of a <code>NonSend</code> or <code>NonSendMut</code> resource in a system would force the system to execute on the main thread. However, when using the new <code>thread_local</code> pattern, we still need to prevent systems from running on non-main threads. To do this, you can now use <code>bevy_ecs::system::NonSendMarker</code> as a system parameter:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy_ecs<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">system<span class="z-punctuation z-accessor z-rust">::</span></span>NonSendMarker<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">my_system</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">_non_send_marker</span><span class="z-punctuation z-separator z-rust">:</span> NonSendMarker,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-constant z-other z-rust">ACCESS_KIT_ADAPTERS</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">with_borrow_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">adapters</span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> do things with adapters
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>To prevent a panic, if any of the <code>!Send</code> resource replacements mentioned in this document are used in a system, the system should <em>always</em> be marked as <code>!Send</code> with <code>bevy_ecs::system::NonSendMarker</code>.<h3 id=componentsregistrator-no-longer-implements-derefmut><code>ComponentsRegistrator</code> no longer implements <code>DerefMut</code> <a class=anchor-link href=#componentsregistrator-no-longer-implements-derefmut>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/14791>#14791</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15458>#15458</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15269>#15269</a></div></div><p><code>ComponentsRegistrator</code> no longer implements <code>DerefMut&LTTarget = Components></code>, meaning you won't be able to get a <code>&mut Components</code> from it. The only two methods on <code>Components</code> that took <code>&mut self</code> (<code>any_queued_mut</code> and <code>num_queued_mut</code>) have been reimplemented on <code>ComponentsRegistrator</code>, meaning you won't need to migrate them. Other usages of <code>&mut Components</code> were unsupported.<h3 id=query-items-can-borrow-from-query-state>Query items can borrow from query state <a class=anchor-link href=#query-items-can-borrow-from-query-state>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/15396>#15396</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19720>#19720</a></div></div><p>The <code>QueryData::Item</code> associated type and the <code>QueryItem</code> and <code>ROQueryItem</code> type aliases now have an additional lifetime parameter corresponding to the <code>'s</code> lifetime in <code>Query</code>. The <code>QueryData::fetch()</code> and <code>QueryFilter::filter_fetch()</code> methods have a new parameter taking a <code>&'s WorldQuery::State</code>. Manual implementations of <code>WorldQuery</code> and <code>QueryData</code> will need to update the method signatures to include the new lifetimes. Other uses of the types will need to be updated to include a lifetime parameter, although it can usually be passed as <code>'_</code>. In particular, <code>ROQueryItem</code> is used when implementing <code>RenderCommand</code>.<p>Before:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">render</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">item</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span>P,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">view</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">ROQueryItem<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span>, <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>ViewQuery<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">entity</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">ROQueryItem<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span>, <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>ItemQuery<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">param</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">SystemParamItem<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span>, '<span class="z-keyword z-operator z-rust">_</span>, <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Param<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">pass</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-meta z-generic z-rust">TrackedRenderPass<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> RenderCommandResult</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">render</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">item</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span>P,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">view</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">ROQueryItem<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span>, '<span class="z-keyword z-operator z-rust">_</span>, <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>ViewQuery<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">entity</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Option</span><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-meta z-generic z-rust">ROQueryItem<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span>, '<span class="z-keyword z-operator z-rust">_</span>, <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>ItemQuery<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">param</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">SystemParamItem<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span>, '<span class="z-keyword z-operator z-rust">_</span>, <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Param<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust">    <span class="z-variable z-parameter z-rust">pass</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-meta z-generic z-rust">TrackedRenderPass<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-modifier z-lifetime z-rust">'w</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> RenderCommandResult</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><hr><p>Methods on <code>QueryState</code> that take <code>&mut self</code> may now result in conflicting borrows if the query items capture the lifetime of the mutable reference. This affects <code>get()</code>, <code>iter()</code>, and others. To fix the errors, first call <code>QueryState::update_archetypes()</code>, and then replace a call <code>state.foo(world, param)</code> with <code>state.query_manual(world).foo_inner(param)</code>. Alternately, you may be able to restructure the code to call <code>state.query(world)</code> once and then make multiple calls using the <code>Query</code>.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> state<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">QueryState<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-keyword z-operator z-rust">_</span>, <span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-keyword z-operator z-range z-rust">...</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> d1 <span class="z-keyword z-operator z-assignment z-rust">=</span> state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world<span class="z-punctuation z-separator z-rust">,</span> e1</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> d2 <span class="z-keyword z-operator z-assignment z-rust">=</span> state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world<span class="z-punctuation z-separator z-rust">,</span> e2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span> <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Error: cannot borrow `state` as mutable more than once at a time
</span></span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span><span class="z-constant z-other z-placeholder z-rust">{d1:?}</span><span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span><span class="z-constant z-other z-placeholder z-rust">{d2:?}</span><span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust">state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">update_archetypes</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> d1 <span class="z-keyword z-operator z-assignment z-rust">=</span> state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_manual</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world<span class="z-punctuation z-separator z-rust">,</span> e1</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> d2 <span class="z-keyword z-operator z-assignment z-rust">=</span> state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_manual</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world<span class="z-punctuation z-separator z-rust">,</span> e2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> OR
</span></span><span class="z-source z-rust">state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">update_archetypes</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> d1 <span class="z-keyword z-operator z-assignment z-rust">=</span> state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">query_manual</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_inner</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>e1</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> d2 <span class="z-keyword z-operator z-assignment z-rust">=</span> state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">query_manual</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_inner</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>e2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> OR
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> query <span class="z-keyword z-operator z-assignment z-rust">=</span> state<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">query</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> d1 <span class="z-keyword z-operator z-assignment z-rust">=</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_inner</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>e1</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> d1 <span class="z-keyword z-operator z-assignment z-rust">=</span> query<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">get_inner</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>e2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span><span class="z-constant z-other z-placeholder z-rust">{d1:?}</span><span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span><span class="z-constant z-other z-placeholder z-rust">{d2:?}</span><span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=non-generic-access>Non-generic <code>Access</code> <a class=anchor-link href=#non-generic-access>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20288>#20288</a></div></div><p>Now that <code>archetype_component_id</code> has been removed, <code>Access</code>, <code>AccessFilters</code>, <code>FilteredAccess</code>, and <code>FilteredAccessSet</code> were only ever parameterized by <code>ComponentId</code>. To simplify use of those types, the generic parameter has been removed. Remove the <code>&LTComponent></code> generic from any use of those types.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">update_component_access</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">state</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>State, <span class="z-variable z-parameter z-rust">access</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> <span class="z-meta z-generic z-rust">FilteredAccess<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>ComponentId<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">update_component_access</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">state</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>State, <span class="z-variable z-parameter z-rust">access</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> FilteredAccess</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h3 id=component-lifecycle-reorganization>Component lifecycle reorganization <a class=anchor-link href=#component-lifecycle-reorganization>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19543>#19543</a></div></div><p>To improve documentation, discoverability and internal organization, we've gathered all of the component lifecycle-related code we could and moved it into a dedicated <code>lifecycle</code> module.<p>The lifecycle / observer types (<code>Add</code>, <code>Insert</code>, <code>Remove</code>, <code>Replace</code>, <code>Despawn</code>) have been moved from the <code>bevy_ecs::world</code> to <code>bevy_ecs::lifecycle</code>.<p>The same move has been done for the more internal (but public) <code>ComponentId</code> constants: <code>ADD</code>, <code>INSERT</code>, <code>REMOVE</code>, <code>REPLACE</code>, <code>DESPAWN</code>.<p>The code for hooks (<code>HookContext</code>, <code>ComponentHook</code>, <code>ComponentHooks</code>) has been extracted from the very long <code>bevy_ecs::components</code> module, and now lives in the <code>bevy_ecs::lifecycle</code> module.<p>The <code>RemovedComponents</code> <code>SystemParam</code>, along with the public <code>RemovedIter</code>, <code>RemovedIterWithId</code> and <code>RemovedComponentEvents</code> have also been moved into this module as they serve a similar role. All references to <code>bevy_ecs::removal_detection</code> can be replaced with <code>bevy_ecs::lifecycle</code>.<h3 id=polylines-and-polygons-are-no-longer-const-generic>Polylines and Polygons are no longer const-generic <a class=anchor-link href=#polylines-and-polygons-are-no-longer-const-generic>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20250>#20250</a></div></div><p><code>Polyline2d</code>, <code>Polyline3d</code>, <code>Polygon</code>, and <code>ConvexPolygon</code> are no longer const-generic and now implement <code>Meshable</code> for direct mesh generation. These types now use <code>Vec</code> instead of arrays internally and will therefore allocate and are no longer <code>no_std</code> compatible.<p>If you need these types to be <code>no_std</code> and/or const-generic, please file an issue explaining your use case and we can consider creating fixed side-count polygon/polyline variants.<h3 id=changes-to-the-default-error-handler-mechanism>Changes to the default error handler mechanism <a class=anchor-link href=#changes-to-the-default-error-handler-mechanism>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18810>#18810</a></div></div><p>We've improved the implementation of Bevy's default error handling. The performance overhead has been reduced, and as a result it is always enabled. The <code>configurable_error_handler</code> feature no longer exists: simply remove it from your list of enabled features.<p>Additionally, worlds can now have different default error handlers, so there is no longer a truly global handler.<p>Replace uses of <code>GLOBAL_ERROR_HANDLER</code> with <code>App::set_error_handler(handler)</code>. For worlds that do not directly belong to an <code>App</code>/<code>SubApp</code>, insert the <code>DefaultErrorHandler(handler)</code> resource.<h3 id=removed-deprecated-batch-spawning-methods>Removed Deprecated Batch Spawning Methods <a class=anchor-link href=#removed-deprecated-batch-spawning-methods>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18148>#18148</a></div></div><p>The following deprecated functions have been removed:<ul><li><code>Commands::insert_or_spawn_batch</code><li><code>World::insert_or_spawn_batch</code><li><code>World::insert_or_spawn_batch_with_caller</code></ul><p>These functions, when used incorrectly, could cause major performance problems and generally violated the privacy of the ECS internals in ways that the Bevy maintainers were not prepared to support long-term. They were deprecated in 0.16 due to their potential for misuse, as the retained render world removed Bevy's own uses of these methods.<p>Instead of allocating entities with specific identifiers, consider one of the following:<ol><li><p>Instead of despawning entities, insert the <code>Disabled</code> component, and instead of respawning them at particular ids, use <code>try_insert_batch</code> or <code>insert_batch</code> and remove <code>Disabled</code>.</p><li><p>Instead of giving special meaning to an entity id, simply use <code>spawn_batch</code> and ensure entity references are valid when despawning.</p><li><p>Use your own stable identifier and a map to <code>Entity</code> identifiers, with the help of the <code>EntityMapper</code> trait.</p></ol><h3 id=stop-storing-access-in-systems>Stop storing access in systems <a class=anchor-link href=#stop-storing-access-in-systems>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19496>#19496</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19477>#19477</a></div></div><p>Bevy used to store component access in all systems, even though it was only used for top-level systems in schedules. To reduce memory usage, the component access is now stored in the schedule instead.<p>The trait methods <code>System::component_access</code> and <code>System::component_access_set</code> have been removed. Instead, the access is returned from <code>System::initialize</code>. If you were implementing <code>System</code> manually, the <code>initialize</code> method should return the access instead of storing it. If you were calling <code>component_access</code> or <code>component_access_set</code> on a system that you initialized yourself, you will need to store the access yourself.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> system <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">IntoSystem<span class="z-punctuation z-accessor z-rust">::</span></span>into_system<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>your_system</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust">system<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">initialize</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> access <span class="z-keyword z-operator z-assignment z-rust">=</span> system<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">component_access</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> component_access_set <span class="z-keyword z-operator z-assignment z-rust">=</span> system<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">initialize</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> access <span class="z-keyword z-operator z-assignment z-rust">=</span> component_access_set<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">combined_access</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p><code>SystemMeta</code> no longer stores <code>FilteredAccessSet&LTComponentId></code>. It is instead passed as a separate parameter when initializing a <code>SystemParam</code>.<p>To better share logic between <code>SystemParam</code> and <code>SystemParamBuilder</code>, <code>SystemParam::init_state</code> has been split into <code>init_state</code>, which creates the state value, and <code>init_access</code>, which calculates the access. <code>SystemParamBuilder::build</code> now only creates the state, and <code>SystemParam::init_access</code> will be called to calculate the access for built parameters.<p>If you were implementing <code>SystemParam</code> manually, you will need to separate the logic into two methods and change any uses of <code>system_meta.component_access_set(_mut)</code> to the new <code>component_access_set</code> parameter. Note that <code>init_state</code> no longer has access to <code>SystemMeta</code> or <code>component_access_set</code>, and <code>init_access</code> only has <code>&state</code>, so the state can no longer depend on the system.<p>If you were calling <code>init_state</code> manually, you will need to call <code>init_access</code> afterwards.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> param_state <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">P<span class="z-punctuation z-accessor z-rust">::</span></span>init_state<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world<span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> meta</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> param_state <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">P<span class="z-punctuation z-accessor z-rust">::</span></span>init_state<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> component_access_set <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">FilteredAccessSet<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-meta z-path z-rust">P<span class="z-punctuation z-accessor z-rust">::</span></span>init_access<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&</span>param_state<span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> meta<span class="z-punctuation z-separator z-rust">,</span> <span class="z-keyword z-operator z-bitwise z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> component_access_set<span class="z-punctuation z-separator z-rust">,</span> world</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=new-zstd-backend>New <code>zstd</code> backend <a class=anchor-link href=#new-zstd-backend>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19793>#19793</a></div></div><p>A more performant zstd backend has been added for texture decompression. To enable it, disable default-features and enable feature "zstd_c". If you have default-features disabled and use functionality that requires zstd decompression ("tonemapping_luts" or "ktx2"), you must choose a zstd implementation with one of the following feature flags: "zstd_c" (faster) or "zstd_rust" (safer)<h4 id=migration-guide>Migration Guide <a class=anchor-link href=#migration-guide>#</a></h4><p>If you previously used the <code>zstd</code> feature explicitly, it has been renamed to <code>zstd_rust</code>:<pre class="language-toml z-code" data-lang=toml><code class=language-toml data-lang=toml><span class="z-source z-toml"><span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> 0.16</span>
</span><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">dependencies</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">bevy</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>0.16<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-array z-begin z-toml">[</span><span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>zstd<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-definition z-array z-end z-toml">]</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span><span class="z-source z-toml">
</span><span class="z-source z-toml"><span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> 0.17 - Use the safe Rust implementation:</span>
</span><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">dependencies</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">bevy</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>0.17<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-array z-begin z-toml">[</span><span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>zstd_rust<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-definition z-array z-end z-toml">]</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span><span class="z-source z-toml">
</span><span class="z-source z-toml"><span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> 0.17 - Or use the faster C implementation:</span>
</span><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">dependencies</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">bevy</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>0.17<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-array z-begin z-toml">[</span><span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>zstd_c<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span><span class="z-punctuation z-definition z-array z-end z-toml">]</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span></code></pre><p>If you have default-features disabled and use functionality that requires zstd decompression ("tonemapping_luts" or "ktx2"), you must choose a zstd implementation with one of the following feature flags: "zstd_c" (faster) or "zstd_rust" (safer).<h3 id=remove-archetypecomponentid>Remove <code>ArchetypeComponentId</code> <a class=anchor-link href=#remove-archetypecomponentid>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19143>#19143</a></div></div><p>Scheduling no longer uses <code>archetype_component_access</code> or <code>ArchetypeComponentId</code>. To reduce memory usage and simplify the implementation, all uses of them have been removed. Since we no longer need to update access before a system runs, <code>Query</code> now updates it state when the system runs instead of ahead of time.<p><code>SystemParam::validate_param</code> now takes <code>&mut Self::State</code> instead of <code>&Self::State</code> so that queries can update their state during validation.<p>The trait methods <code>System::update_archetype_component_access</code> and <code>SystemParam::new_archetype</code> have been removed. They are no longer necessary, so calls to them can be removed. If you were implementing the traits manually, move any logic from those methods into <code>System::validate_param_unsafe</code>, <code>System::run_unsafe</code>, <code>SystemParam::validate_param</code>, or <code>SystemParam::get_param</code>, which can no longer rely on <code>update_archetype_component_access</code> being called first.<p>The following methods on <code>SystemState</code> have been deprecated:<ul><li><code>update_archetypes</code> - Remove calls, as they no longer do anything<li><code>update_archetypes_unsafe_world_cell</code> - Remove calls, as they no longer do anything<li><code>get_manual</code> - Replace with <code>get</code>, as there is no longer a difference<li><code>get_manual_mut</code> - Replace with <code>get_mut</code>, as there is no longer a difference<li><code>get_unchecked_mut</code> - Replace with <code>get_unchecked</code>, as there is no longer a difference</ul><h3 id=rendertarget-error-handling>RenderTarget error handling <a class=anchor-link href=#rendertarget-error-handling>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20503>#20503</a></div></div><p><code>NormalizedRenderTargetExt::get_render_target_info</code> now returns a <code>Result</code>, with the <code>Err</code> variant indicating which render target (image, window, etc) failed to load its metadata.<p>This should mostly be treated as a hard error, since it indicates the rendering state of the app is broken.<h3 id=renamed-brp-methods>Renamed BRP methods <a class=anchor-link href=#renamed-brp-methods>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19377>#19377</a></div></div><p>Most Bevy Remote Protocol methods have been renamed to be more explicit. The word <code>destroy</code> has also been replaced with <code>despawn</code> to match the rest of the engine.<table><thead><tr><th>Old<th>New<tbody><tr><td><code>bevy/query</code><td><code>world.query</code><tr><td><code>bevy/spawn</code><td><code>world.spawn_entity</code><tr><td><code>bevy/destroy</code><td><code>world.despawn_entity</code><tr><td><code>bevy/reparent</code><td><code>world.reparent_entities</code><tr><td><code>bevy/get</code><td><code>world.get_components</code><tr><td><code>bevy/insert</code><td><code>world.insert_components</code><tr><td><code>bevy/remove</code><td><code>world.remove_components</code><tr><td><code>bevy/list</code><td><code>world.list_components</code><tr><td><code>bevy/mutate</code><td><code>world.mutate_components</code><tr><td><code>bevy/get+watch</code><td><code>world.get_components+watch</code><tr><td><code>bevy/list+watch</code><td><code>world.list_components+watch</code><tr><td><code>bevy/get_resource</code><td><code>world.get_resources</code><tr><td><code>bevy/insert_resource</code><td><code>world.insert_resources</code><tr><td><code>bevy/remove_resource</code><td><code>world.remove_resources</code><tr><td><code>bevy/list_resources</code><td><code>world.list_resources</code><tr><td><code>bevy/mutate_resource</code><td><code>world.mutate_resources</code><tr><td><code>registry/schema</code><td><code>registry.schema</code></table><h3 id=taa-is-no-longer-experimental>TAA is no longer experimental <a class=anchor-link href=#taa-is-no-longer-experimental>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18349>#18349</a></div></div><p>TAA is no longer experimental.<p><code>TemporalAntiAliasPlugin</code> no longer needs to be added to your app to use TAA. It is now part of <code>DefaultPlugins</code>, via <code>AntiAliasPlugin</code>.<p>As part of this change, the import paths for <code>TemporalAntiAliasNode</code>, <code>TemporalAntiAliasing</code> and <code>TemporalAntiAliasPlugin</code> have changed from <code>bevy::anti_alias::experimental::taa</code> to <code>bevy::anti_alias::taa</code>: if you want to add <code>TemporalAntiAliasing</code> to a Camera, you can now find it at <code>bevy::anti_alias::taa::TemporalAntiAliasing</code>.<p><code>TemporalAntiAliasing</code> now uses <code>MipBias</code> as a required component in the main world, instead of overriding it manually in the render world.<h3 id=textshadow-has-been-moved-to-bevy-ui-widget-text><code>TextShadow</code> has been moved to <code>bevy::ui::widget::text</code> <a class=anchor-link href=#textshadow-has-been-moved-to-bevy-ui-widget-text>#</a></h3><div class=heading-meta></div><p><code>TextShadow</code> has been moved to <code>bevy::ui::widget::text</code>.<h3 id=remove-bundle-register-required-components>Remove <code>Bundle::register_required_components</code> <a class=anchor-link href=#remove-bundle-register-required-components>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19967>#19967</a></div></div><p>This method was effectively dead-code as it was never used by the ECS to compute required components, hence it was removed. if you were overriding its implementation you can just remove it, as it never did anything. If you were using it in any other way, please open an issue.<h3 id=observer-event-api-changes>Observer / Event API Changes <a class=anchor-link href=#observer-event-api-changes>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20731>#20731</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19440>#19440</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19596>#19596</a></div></div><p>The observer "trigger" API has changed a bit to improve clarity and type-safety.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Old
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_observer</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">trigger</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Trigger<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>OnAdd, Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">info!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Spawned player {}<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> trigger<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">target</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> New
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_observer</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">add</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">On<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Add, Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">info!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Spawned player {}<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> add<span class="z-punctuation z-accessor z-dot z-rust">.</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>The <code>Trigger</code> type used inside observers has been renamed to <code>On</code> to encourage developers to think about this parameter <em>as</em> the event. We also recommend naming the variable after the event type (ex: <code>add</code>).<p>To reduce repetition and improve readability, the <code>OnAdd</code>, <code>OnInsert</code>, <code>OnReplace</code>, <code>OnRemove</code>, and <code>OnDespawn</code> observer events have also been renamed to <code>Add</code>, <code>Insert</code>, <code>Replace</code>, <code>Remove</code>, and <code>Despawn</code> respectively. In rare cases where the <code>Add</code> event conflicts with the <code>std::ops::Add</code> trait, you may need to disambiguate, for example by using <code>ops::Add</code> for the trait. We encourage removing the "On" from custom events named <code>OnX</code>.<p>Types implementing <code>Event</code> can no longer be triggered from _all contexts. By default <code>Event</code> is a "global" / "target-less" event.<p>Events that target an entity should now derive <code>EntityEvent</code>, and they will now store the target entity <em>on</em> the event type, which is accessible via <code>EntityEvent::event_target</code>. Additionally, <code>world.trigger_targets</code> has been removed in favor of a single <code>world.trigger</code> API:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Old
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Event</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Explode</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger_targets</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Explode<span class="z-punctuation z-separator z-rust">,</span> entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> New
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">EntityEvent</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Explode</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">entity</span><span class="z-punctuation z-separator z-type z-rust">:</span> Entity
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Explode <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> entity </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Triggering an entity event for multiple entities now requires multiple calls to <code>trigger</code>:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Old
</span></span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger_targets</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Explode<span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>e1<span class="z-punctuation z-separator z-rust">,</span> e2<span class="z-punctuation z-section z-group z-end z-rust">]</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> New - Variant 1
</span></span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Explode <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> entity<span class="z-punctuation z-separator z-rust">:</span> e1 </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Explode <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> entity<span class="z-punctuation z-separator z-rust">:</span> e2 </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> New - Variant 2
</span></span><span class="z-source z-rust"><span class="z-keyword z-control z-rust">for</span> entity <span class="z-keyword z-operator z-rust">in</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span>e1<span class="z-punctuation z-separator z-rust">,</span> e2<span class="z-punctuation z-section z-group z-end z-rust">]</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Explode <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> entity </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></code></pre><p><code>On::target()</code> no longer exists for all event types. Instead, you should prefer accessing the "target entity" field on the events that target entities:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Old
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_observer</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">trigger</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Trigger<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Explode<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">info!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>{} exploded!<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> trigger<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">target</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> New
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_observer</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">explode</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">On<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Explode<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">info!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>{} exploded!<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> explode<span class="z-punctuation z-accessor z-dot z-rust">.</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> you can also use `EntityEvent::event_target`, but we encourage
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> using direct field access when possible, for better documentation and clarity.
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">info!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>{} exploded!<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> explode<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">event_target</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>"Propagation functions", such as <code>On::propagate</code> are now <em>only</em> available on <code>On&LTE></code> when <code>E: EntityEvent&LTTrigger = PropagateEntityTrigger></code>.<p>Enabling propagation is now down using, which defaults to <code>ChildOf</code> propagation:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">EntityEvent</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">entity_event</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">propagate</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Click</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">entity</span><span class="z-punctuation z-separator z-type z-rust">:</span> Entity,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>Setting a custom propagation <code>Traversal</code> implementation now uses <code>propagate</code> instead of <code>traversal</code>:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> OLd
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Event</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">event</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">traversal <span class="z-keyword z-operator z-rust">=</span> &'static ChildOf</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Click</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> New
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">EntityEvent</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">entity_event</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">propagate <span class="z-keyword z-operator z-rust">=</span> &'static ChildOf</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Click</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">entity</span><span class="z-punctuation z-separator z-type z-rust">:</span> Entity,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>Animation events (used in <code>AnimationPlayer</code>) must now derive <code>AnimationEvent</code>. Accessing the animation player entity is now done via the <code>trigger()</code>.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Old
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Event</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">SayMessage</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>String</span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust">animation<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_event</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">2</span><span class="z-punctuation z-separator z-rust">,</span> SayMessage<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>hello<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_string</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>animation_player</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">observe</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">trigger</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Trigger<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>SayMessage<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>played on<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> trigger<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">target</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> New
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">AnimationEvent</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">SayMessage</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>String</span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust">animation<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_event</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-constant z-numeric z-float z-rust">2</span><span class="z-punctuation z-separator z-rust">,</span> SayMessage<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>hello<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_string</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">entity_mut</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>animation_player</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">observe</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">say_message</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">On<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>SayMessage<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>played on<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> say_message<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span>animation_player<span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre><p>For "component lifecycle events", accessing <em>all</em> of the components that triggered the event has changed:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Old
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_observer</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">trigger</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">Trigger<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>OnAdd, Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">info!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>{}<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> trigger<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">components</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> New
</span></span><span class="z-source z-rust">commands<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_observer</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">add</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">On<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>Add, Player<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    <span class="z-support z-macro z-rust">info!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>{}<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-separator z-rust">,</span> add<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">trigger</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span>components</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><h3 id=manual-entity-creation-and-representation>Manual Entity Creation and Representation <a class=anchor-link href=#manual-entity-creation-and-representation>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18704>#18704</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19121>#19121</a></div></div><p>An entity is made of two parts: and index and a generation. Both have changes:<h4 id=index>Index <a class=anchor-link href=#index>#</a></h4><p><code>Entity</code> no longer stores its index as a plain <code>u32</code> but as the new <code>EntityRow</code>, which wraps a <code>NonMaxU32</code>. Previously, <code>Entity::index</code> could be <code>u32::MAX</code>, but that is no longer a valid index. As a result, <code>Entity::from_raw</code> was renamed to <code>Entity::from_row</code> and now takes <code>EntityRow</code> as a parameter instead of <code>u32</code>. You can use <code>Entity::from_raw_u32</code> which is identical to the previous <code>Entity::from_raw</code>, except that it now returns <code>Option</code> where the result is <code>None</code> if <code>u32::MAX</code> is passed.<p>Bevy made this change because it puts a niche in the <code>EntityRow</code> type which makes <code>Option&LTEntityRow></code> half the size of <code>Option&LTu32></code>. This is used internally to open up performance improvements to the ECS.<p>Although you probably shouldn't be making entities manually, it is sometimes useful to do so for tests. To migrate tests, use:<pre class="language-diff z-code" data-lang=diff><code class=language-diff data-lang=diff><span class="z-source z-diff"><span class="z-markup z-deleted z-diff"><span class="z-punctuation z-definition z-deleted z-diff">-</span> let entity = Entity::from_raw(1);
</span></span><span class="z-source z-diff"><span class="z-markup z-inserted z-diff"><span class="z-punctuation z-definition z-inserted z-diff">+</span> let entity = Entity::from_raw_u32(1).unwrap();
</span></span></code></pre><p>If you are creating entities manually in production, don't do that! Use <code>Entities::alloc</code> instead. But if you must create one manually, either reuse a <code>EntityRow</code> you know to be valid by using <code>Entity::from_row</code> and <code>Entity::row</code>, or handle the error case of <code>None</code> returning from <code>Entity::from_raw_u32(my_index)</code>.<h4 id=generation>Generation <a class=anchor-link href=#generation>#</a></h4><p>An entity's generation is no longer a <code>NonZeroU32</code>. Instead, it is an <code>EntityGeneration</code>. Internally, this stores a <code>u32</code>, but that might change later.<p>Working with the generation directly has never been recommended, but it is sometimes useful to do so in tests. To create a generation do <code>EntityGeneration::FIRST.after_versions(expected_generation)</code>. To use this in tests, do <code>assert_eq!(entity.generation(), EntityGeneration::FIRST.after_versions(expected_generation))</code>.<h4 id=removed-interfaces>Removed Interfaces <a class=anchor-link href=#removed-interfaces>#</a></h4><p>The <code>identifier</code> module and all its contents have been removed. These features have been slimmed down and rolled into <code>Entity</code>.<p>This means that where <code>Result&LTT, IdentifierError></code> was returned, <code>Option&LTT></code> is now returned.<h4 id=functionality>Functionality <a class=anchor-link href=#functionality>#</a></h4><p>It is well documented that both the bit format, serialization, and <code>Ord</code> implementations for <code>Entity</code> are subject to change between versions. Those have all changed in this version.<p>For entity ordering, the order still prioritizes an entity's generation, but after that, it now considers higher index entities less than lower index entities.<p>The changes to serialization and the bit format are directly related. Effectively, this means that all serialized and transmuted entities will not work as expected and may crash. To migrate, invert the lower 32 bits of the 64 representation of the entity, and subtract 1 from the upper bits. Again, this is still subject to change, and serialized scenes may break between versions.<h4 id=length-representation>Length Representation <a class=anchor-link href=#length-representation>#</a></h4><p>Because the maximum index of an entity is now <code>NonZeroU32::MAX</code>, the maximum number of entities (and length of unique entity row collections) is <code>u32::MAX</code>. As a result, a lot of APIs that returned <code>usize</code> have been changed to <code>u32</code>.<p>These include:<ul><li><code>Archetype::len</code><li><code>Table::entity_count</code></ul><h4 id=other-kinds-of-entity-rows>Other kinds of entity rows <a class=anchor-link href=#other-kinds-of-entity-rows>#</a></h4><p>Since the <code>EntityRow</code> is a <code>NonMaxU32</code>, <code>TableRow</code> and <code>ArchetypeRow</code> have been given the same treatment. They now wrap a <code>NonMaxU32</code>, allowing more performance optimizations.<p>Additionally, they have been given new, standardized interfaces:<ul><li><code>fn new(NonMaxU32)</code><li><code>fn index(self) -> usize</code><li><code>fn index_u32(self) -> u32</code></ul><p>The other interfaces for these types have been removed. Although it's not usually recommended to be creating these types manually, if you run into any issues migrating here, please open an issue. If all else fails, <code>TableRow</code> and <code>ArchetypeRow</code> are <code>repr(transparent)</code>, allowing careful transmutations.<h3 id=rendertargetinfo-s-default-scale-factor-has-been-changed-to-1>RenderTargetInfo's default <code>scale_factor</code> has been changed to <code>1.</code> <a class=anchor-link href=#rendertargetinfo-s-default-scale-factor-has-been-changed-to-1>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/21082>#21082</a></div></div><p>The default for <code>RenderTargetInfo</code>'s <code>scale_factor</code> field is now <code>1.</code>.<h3 id=rendergraphapp-renamed-to-rendergraphext><code>RenderGraphApp</code> renamed to <code>RenderGraphExt</code> <a class=anchor-link href=#rendergraphapp-renamed-to-rendergraphext>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19912>#19912</a></div></div><p><code>RenderGraphApp</code> has been renamed to <code>RenderGraphExt</code>. Rename this for cases where you are explicitly importing this trait.<h3 id=window-resolution-constructors>Window Resolution Constructors <a class=anchor-link href=#window-resolution-constructors>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20582>#20582</a></div></div><p>The <code>WindowResolution</code> type stores the width and height as <code>u32</code>. Previously, this type could only be constructed with <code>f32</code>, which were immediately converted to <code>u32</code>. Now, <code>WindowResolution</code> can be constructed with <code>u32</code>s directly, and the pointless <code>f32</code> conversion has been removed.<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-path z-rust">WindowResolution<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">1920.</span><span class="z-constant z-numeric z-float z-rust">0</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-float z-rust">1080.</span><span class="z-constant z-numeric z-float z-rust">0</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> becomes
</span></span><span class="z-source z-rust"><span class="z-meta z-path z-rust">WindowResolution<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">1920</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1080</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-path z-rust">WindowResolution<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>some_uvec2<span class="z-punctuation z-accessor z-dot z-rust">.</span>x <span class="z-keyword z-operator z-rust">as</span> <span class="z-storage z-type z-rust">f32</span><span class="z-punctuation z-separator z-rust">,</span> some_uvec2<span class="z-punctuation z-accessor z-dot z-rust">.</span>y <span class="z-keyword z-operator z-rust">as</span> <span class="z-storage z-type z-rust">f32</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> becomes
</span></span><span class="z-source z-rust"><span class="z-meta z-path z-rust">WindowResolution<span class="z-punctuation z-accessor z-rust">::</span></span>from<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>some_uvec2</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust">window_resolution<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-float z-rust">1920.</span><span class="z-constant z-numeric z-float z-rust">0</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-float z-rust">1080.</span><span class="z-constant z-numeric z-float z-rust">0</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> becomes
</span></span><span class="z-source z-rust">window_resolution<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">1920</span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1080</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">into</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></code></pre><h3 id=specialized-ui-transform>Specialized UI transform <a class=anchor-link href=#specialized-ui-transform>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/16615>#16615</a></div></div><p>Bevy UI now uses specialized 2D UI transform components <code>UiTransform</code> and <code>UiGlobalTransform</code> in place of <code>Transform</code> and <code>GlobalTransform</code>.<p><code>UiTransform</code> is a 2D-only equivalent of Transform with a responsive translation in <code>Val</code>s. <code>UiGlobalTransform</code> newtypes <code>Affine2</code> and is updated in <code>ui_layout_system</code>.<p><code>Node</code> now requires <code>UiTransform</code> instead of <code>Transform</code>. <code>UiTransform</code> requires <code>UiGlobalTransform</code>.<p>The <code>UiTransform</code> equivalent of the <code>Transform</code>:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">Transform <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    translation<span class="z-punctuation z-separator z-rust">:</span> Vec3 <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> x<span class="z-punctuation z-separator z-rust">,</span> y<span class="z-punctuation z-separator z-rust">,</span> z </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    rotation<span class="z-punctuation z-separator z-rust">:</span><span class="z-meta z-path z-rust">Quat<span class="z-punctuation z-accessor z-rust">::</span></span>from_rotation_z<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>radians</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    scale<span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></code></pre><p>is<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">UiTransform <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    translation<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">Val2<span class="z-punctuation z-accessor z-rust">::</span></span>px<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>x<span class="z-punctuation z-separator z-rust">,</span> y</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    rotation<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust">Rot2<span class="z-punctuation z-accessor z-rust">::</span></span>from_rotation<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>radians</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust">    scale<span class="z-punctuation z-separator z-rust">:</span> scale<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">xy</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span><span class="z-source z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></code></pre><p>In previous versions of Bevy <code>ui_layout_system</code> would overwrite UI node's <code>Transform::translation</code> each frame. <code>UiTransform</code>s aren't overwritten and there is no longer any need for systems that cache and rewrite the transform for translated UI elements.<p>If you were relying on the <code>z</code> value of the <code>GlobalTransform</code>, this can be derived from <code>UiStack</code> instead.<h3 id=checkchangeticks-parameter-in-system-check-change-tick><code>CheckChangeTicks</code> parameter in <code>System::check_change_tick</code> <a class=anchor-link href=#checkchangeticks-parameter-in-system-check-change-tick>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19274>#19274</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19600>#19600</a></div></div><p><code>System::check_change_tick</code> took a <code>Tick</code> parameter to update internal ticks. This is needed to keep queried components filtered by their change tick reliably not be matched if their last change or add and the system's last run was very long ago. This is also needed for similar methods involving the system's ticks for the same reason.<p>This parameter is now a <code>CheckChangeTicks</code> type that can be passed to the now-public <code>Tick::check_tick</code> in case you maintain these yourself in manual <code>System</code> implementations.<p>If you need a <code>CheckChangeTicks</code> value, for example because you call one of the above methods manually, you can observe it. Here is an example where it is used on a schedule stored in a resource, which will pass it on to the <code>System::check_change_tick</code> of its systems.<pre class="language-rs z-code" data-lang=rs><code class=language-rs data-lang=rs><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy_ecs<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">prelude<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">bevy_ecs<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">component<span class="z-punctuation z-accessor z-rust">::</span></span>CheckChangeTicks<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Resource</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">CustomSchedule</span></span><span class="z-meta z-struct z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>Schedule</span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> world <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">World<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">add_observer</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-variable z-parameter z-rust">check</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">On<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>CheckChangeTicks<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-storage z-modifier z-rust">mut</span> <span class="z-variable z-parameter z-rust">schedule</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">ResMut<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>CustomSchedule<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust">    schedule<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-constant z-numeric z-float z-rust">0.</span><span class="z-support z-function z-rust">check_change_ticks</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-arithmetic z-rust">*</span>check</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>The observers are triggered by <code>World::check_change_ticks</code> which every schedule calls before running. This method also returns an <code>Option&LTCheckChangeTicks></code> which is <code>Some</code> in case it was time to check the ticks.<h3 id=transform-and-globaltransform-compute-matrix-rename>Transform and GlobalTransform::compute_matrix rename <a class=anchor-link href=#transform-and-globaltransform-compute-matrix-rename>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19643>#19643</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19646>#19646</a></div></div><p><code>GlobalTransform::compute_matrix</code> has been renamed to <code>GlobalTransform::to_matrix</code> because it does not compute anything, it simply moves data into a different type. <code>Transform::compute_matrix</code> has been renamed to <code>Transform::to_matrix</code> for consistency with <code>GlobalTransform</code>.<h3 id=compressed-image-saver-feature>Compressed image saver feature <a class=anchor-link href=#compressed-image-saver-feature>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19789>#19789</a></div></div><p>The compressed image saver has been gated behind its own dedicated feature flag now. If you were using it, you need to enable the "compressed_image_saver" feature.<h3 id=change-filters-container-of-logdiagnosticsstate-to-hashset>Change filters container of <code>LogDiagnosticsState</code> to <code>HashSet</code> <a class=anchor-link href=#change-filters-container-of-logdiagnosticsstate-to-hashset>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19323>#19323</a></div></div><p><code>LogDiagnosticsState</code>'s filter container and the argument of <code>LogDiagnosticPlugin::filtered</code> is now a <code>HashSet</code> rather than a <code>Vec</code>.<h3 id=fullscreen-shader-handle-replaced-with-fullscreenshader><code>FULLSCREEN_SHADER_HANDLE</code> replaced with <code>FullscreenShader</code> <a class=anchor-link href=#fullscreen-shader-handle-replaced-with-fullscreenshader>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19426>#19426</a></div></div><p><code>FULLSCREEN_SHADER_HANDLE</code> and <code>fullscreen_shader_vertex_state</code> have been replaced by the <code>FullscreenShader</code> resource. Users of either of these will need to call <code>FullscreenShader::shader</code> or <code>FullscreenShader::to_vertex_state</code> respectively. You may need to clone <code>FullscreenShader</code> out of the render world to store an instance that you can use later (e.g., if you are attempting to use the fullscreen shader inside a <code>SpecializedRenderPipeline</code> implementation).<p>For example, if your previous code looked like this:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MyPipeline</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">  <span class="z-variable z-other z-member z-rust">some_bind_group</span><span class="z-punctuation z-separator z-type z-rust">:</span> BindGroupLayout,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">FromWorld <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyPipeline</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">from_world</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">render_world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">Self</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> some_bind_group <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-comment z-block z-rust"><span class="z-punctuation z-definition z-comment z-rust">/*</span> ... RenderDevice stuff <span class="z-punctuation z-definition z-comment z-rust">*/</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">Self</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">      some_bind_group<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">SpecializedRenderPipeline <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyPipeline</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">specialize</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">key</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Key</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> RenderPipelineDescriptor</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    RenderPipelineDescriptor <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">      vertex<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-function z-rust">fullscreen_shader_vertex_state</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">      <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ... other stuff
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>You can migrate your code to:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">MyPipeline</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">  <span class="z-variable z-other z-member z-rust">some_bind_group</span><span class="z-punctuation z-separator z-type z-rust">:</span> BindGroupLayout,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">  <span class="z-variable z-other z-member z-rust">fullscreen_shader</span><span class="z-punctuation z-separator z-type z-rust">:</span> FullscreenShader,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">FromWorld <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyPipeline</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">from_world</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">render_world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> <span class="z-storage z-type z-rust">Self</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> some_bind_group <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-comment z-block z-rust"><span class="z-punctuation z-definition z-comment z-rust">/*</span> ... RenderDevice stuff <span class="z-punctuation z-definition z-comment z-rust">*/</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">Self</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">      some_bind_group<span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">      fullscreen_shader<span class="z-punctuation z-separator z-rust">:</span> render_world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-meta z-path z-rust">resource<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>FullscreenShader<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">clone</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span> </span><span class="z-meta z-impl z-rust">SpecializedRenderPipeline <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MyPipeline</span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">  <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">specialize</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-keyword z-operator z-rust">&</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">key</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-path z-rust"><span class="z-storage z-type z-rust"><span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-accessor z-rust">::</span></span></span>Key</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-></span> RenderPipelineDescriptor</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    RenderPipelineDescriptor <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">      vertex<span class="z-punctuation z-separator z-rust">:</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>fullscreen_shader<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_vertex_state</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">      <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> ... other stuff
</span></span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>This is just one example. Pipelines may be initialized in different ways, but the primary strategy is clone out the <code>FullscreenShader</code> resource from the render world, and call <code>to_vertex_state</code> to use it as the vertex shader.<h3 id=smooth-normals-implementation-changed>Smooth normals implementation changed <a class=anchor-link href=#smooth-normals-implementation-changed>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/18552>#18552</a></div></div><p>In Bevy 0.16, <code>Mesh</code> smooth normal calculation used a triangle area-weighted algorithm. In 0.17, the area-weighted algorithm was moved to separate methods, the default implementation was switched to a corner angle-weighted algorithm, and <code>Mesh::compute_custom_smooth_normals</code> was added for other cases.<p>The angle-weighted method is more suitable for growing or shrinking a mesh along its vertex normals, such as when generating an outline mesh. It also results in more expected lighting behavior for some meshes. In most cases, the difference will be small and no change is needed. However, the new default is somewhat slower, and does not always produce the result desired by an artist. If you preferred the lighting in 0.16, or have a significant performance regression, or needed area-weighted normals for any other reason, you can switch to the new dedicated area-weighted methods.<pre class="language-diff z-code" data-lang=diff><code class=language-diff data-lang=diff><span class="z-source z-diff">// Only if the new smooth normals algorithm is unsatisfactory:
</span><span class="z-source z-diff">
</span><span class="z-source z-diff">let mut mesh = Mesh::new(PrimitiveTopology::TriangleList, default())
</span><span class="z-source z-diff">    .with_inserted_attribute(Mesh::ATTRIBUTE_POSITION, positions)
</span><span class="z-source z-diff"><span class="z-markup z-deleted z-diff"><span class="z-punctuation z-definition z-deleted z-diff">-</span>    .with_computed_smooth_normals();
</span></span><span class="z-source z-diff"><span class="z-markup z-inserted z-diff"><span class="z-punctuation z-definition z-inserted z-diff">+</span>    .with_computed_area_weighted_normals;
</span></span><span class="z-source z-diff">
</span><span class="z-source z-diff"><span class="z-markup z-deleted z-diff"><span class="z-punctuation z-definition z-deleted z-diff">-</span> mesh.compute_smooth_normals();
</span></span><span class="z-source z-diff"><span class="z-markup z-inserted z-diff"><span class="z-punctuation z-definition z-inserted z-diff">+</span> mesh.compute_area_weighted_normals();
</span></span></code></pre><p>As part of this change, the helper functions <code>face_normal</code> and <code>face_area_normal</code>, were renamed to <code>triangle_normal</code> and <code>triangle_area_normal</code> respectively to better reflect the fact that they do not take an entire geometric face into account.<pre class="language-diff z-code" data-lang=diff><code class=language-diff data-lang=diff><span class="z-source z-diff"><span class="z-markup z-deleted z-diff"><span class="z-punctuation z-definition z-deleted z-diff">-</span> use bevy::render::mesh::face_normal;
</span></span><span class="z-source z-diff"><span class="z-markup z-inserted z-diff"><span class="z-punctuation z-definition z-inserted z-diff">+</span> use bevy::render::mesh::triangle_normal;
</span></span><span class="z-source z-diff"><span class="z-markup z-deleted z-diff"><span class="z-punctuation z-definition z-deleted z-diff">-</span> let normal = face_normal(a, b, c);
</span></span><span class="z-source z-diff"><span class="z-markup z-inserted z-diff"><span class="z-punctuation z-definition z-inserted z-diff">+</span> let normal = triangle_normal(a, b, c);
</span></span><span class="z-source z-diff">
</span><span class="z-source z-diff"><span class="z-markup z-deleted z-diff"><span class="z-punctuation z-definition z-deleted z-diff">-</span> use bevy::render::mesh::face_area_normal;
</span></span><span class="z-source z-diff"><span class="z-markup z-inserted z-diff"><span class="z-punctuation z-definition z-inserted z-diff">+</span> use bevy::render::mesh::triangle_area_normal;
</span></span><span class="z-source z-diff"><span class="z-markup z-deleted z-diff"><span class="z-punctuation z-definition z-deleted z-diff">-</span> let normal = face_area_normal(a, b, c);
</span></span><span class="z-source z-diff"><span class="z-markup z-inserted z-diff"><span class="z-punctuation z-definition z-inserted z-diff">+</span> let normal = triangle_area_normal(a, b, c);
</span></span></code></pre><h3 id=spawnablelist><code>SpawnableList</code> <a class=anchor-link href=#spawnablelist>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20772>#20772</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20877>#20877</a></div></div><p>In order to reduce the stack size taken up by spawning and inserting large bundles, <code>SpawnableList</code> now takes a <code>MovingPtr&LTT></code> as the self-type for the <code>spawn</code> function:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">spawn</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World, <span class="z-variable z-parameter z-rust">entity</span><span class="z-punctuation z-separator z-rust">:</span> Entity</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> list <span class="z-keyword z-operator z-assignment z-rust">=</span> Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>my_bundle</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">list<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>world<span class="z-punctuation z-separator z-rust">,</span> entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">spawn</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">self</span>: <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World, <span class="z-variable z-parameter z-rust">entity</span><span class="z-punctuation z-separator z-rust">:</span> Entity</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> list <span class="z-keyword z-operator z-assignment z-rust">=</span> Spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>my_bundle</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">move_as_ptr!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>list</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-meta z-path z-rust">SpawnableList<span class="z-punctuation z-accessor z-rust">::</span></span>spawn<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>list<span class="z-punctuation z-separator z-rust">,</span> world<span class="z-punctuation z-separator z-rust">,</span> entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>This change also means that <code>SpawnableList</code> must now also be <code>Sized</code>!<p><code>MovingPtr&LTT></code> is a safe, typed, box-like pointer that owns the data it points to, but not the underlying memory: that means the owner of a <code>MovingPtr&LTT></code> can freely move parts of the data out and doesn't have to worry about de-allocating memory. Much like <code>Box&LTT></code>, <code>MovingPtr&LTT></code> implements <code>Deref</code> and <code>DerefMut</code> for easy access to the stored type, when it's safe to do so. To decompose the value inside of the <code>MovingPtr&LTT></code> into its fields without copying them to the stack, you can use the <code>deconstruct_moving_ptr!</code> macro to give you <code>MovingPtr&LTU></code>s to each field specified:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-generic z-rust"><span class="z-entity z-name z-struct z-rust">MySpawnableList</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>A<span class="z-punctuation z-separator z-rust">:</span> Bundle, B<span class="z-punctuation z-separator z-rust">:</span> Bundle<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span></span><span class="z-meta z-struct z-rust"> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">a</span><span class="z-punctuation z-separator z-type z-rust">:</span> A,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-variable z-other z-member z-rust">b</span><span class="z-punctuation z-separator z-type z-rust">:</span> B,
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> my_ptr<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-meta z-generic z-rust">MySpawnableList<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span><span class="z-storage z-type z-rust">u32</span>, <span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-keyword z-operator z-range z-rust">...</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">deconstruct_moving_ptr!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-type z-rust">let</span> MySpawnableList <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> a<span class="z-punctuation z-separator z-rust">,</span> b </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> my_ptr<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> a_ptr<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-storage z-type z-rust">u32</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> a<span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> b_ptr<span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> b<span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>Similar to <code>Box::into_inner</code>, <code>MovingPtr&LTT></code> also has a method <code>MovingPtr::read</code> for moving the whole value out of the pointer onto the stack:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> a<span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">u32</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> a_ptr<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">read</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> b<span class="z-punctuation z-separator z-rust">:</span> <span class="z-support z-type z-rust">String</span> <span class="z-keyword z-operator z-assignment z-rust">=</span> b_ptr<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">read</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>To create a <code>MovingPtr&LTT></code> from a value, you can use the <code>move_as_ptr!</code> macro:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> my_value <span class="z-keyword z-operator z-assignment z-rust">=</span> MySpawnableList <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> a<span class="z-punctuation z-separator z-rust">:</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">42</span><span class="z-storage z-type z-numeric z-rust">u32</span><span class="z-punctuation z-separator z-rust">,</span> b<span class="z-punctuation z-separator z-rust">:</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">"</span>Hello<span class="z-punctuation z-definition z-string z-end z-rust">"</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_string</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-support z-macro z-rust">move_as_ptr!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>my_value</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> <span class="z-keyword z-operator z-rust">_</span><span class="z-punctuation z-separator z-rust">:</span> MovingPtr <span class="z-keyword z-operator z-assignment z-rust">=</span> my_value<span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre><p>This macro works by shadowing the original variable name with the newly created <code>MovingPtr&LTT></code>. <code>MovingPtr&LTT></code> can also be created manually with the <code>unsafe</code> method <code>MovingPtr::from_value</code>, which takes a <code>&mut</code> to an initialized <code>MaybeUninit&LTT></code>, which the <code>MovingPtr&LTT></code> takes ownership of: the <code>MaybeUninit&LTT></code> should be treated as uninitialized after the <code>MovingPtr&LTT></code> has been used!<p>To migrate your implementations of <code>SpawnableList</code> to the new API, you will want to read the <code>this</code> parameter to spawn or insert any bundles stored within:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">
</span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-storage z-type z-impl z-rust">impl</span></span><span class="z-meta z-impl z-rust"><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>R<span class="z-punctuation z-separator z-rust">:</span> Relationship<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span></span><span class="z-meta z-impl z-rust"> <span class="z-meta z-generic z-rust">SpawnableList<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>R<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> <span class="z-keyword z-other z-rust">for</span></span><span class="z-meta z-impl z-rust"> <span class="z-entity z-name z-impl z-rust">MySpawnableList</span><span class="z-meta z-generic z-rust"><span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>A<span class="z-punctuation z-separator z-rust">:</span> Bundle, B<span class="z-punctuation z-separator z-rust">:</span> Bundle<span class="z-punctuation z-definition z-generic z-end z-rust">></span></span> </span><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.16
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">spawn</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">self</span>, <span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World, <span class="z-variable z-parameter z-rust">entity</span><span class="z-punctuation z-separator z-rust">:</span> Entity</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> MySpawnableList <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> a<span class="z-punctuation z-separator z-rust">,</span> b </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-variable z-language z-rust">self</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">R<span class="z-punctuation z-accessor z-rust">::</span></span>from<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> a<span class="z-punctuation z-separator z-rust">,</span> b</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> 0.17
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">spawn</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">this</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World, <span class="z-variable z-parameter z-rust">entity</span><span class="z-punctuation z-separator z-rust">:</span> Entity</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-type z-rust">let</span> MySpawnableList <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> a<span class="z-punctuation z-separator z-rust">,</span> b </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> this<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">read</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">R<span class="z-punctuation z-accessor z-rust">::</span></span>from<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> a<span class="z-punctuation z-separator z-rust">,</span> b</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-impl z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><p>or only read the fields you need with <code>deconstruct_moving_ptr!</code>:<pre class="language-rust z-code" data-lang=rust><code class=language-rust data-lang=rust><span class="z-source z-rust">    <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">spawn</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">this</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-meta z-generic z-rust">MovingPtr<span class="z-punctuation z-definition z-generic z-begin z-rust"><</span>'<span class="z-keyword z-operator z-rust">_</span>, <span class="z-storage z-type z-rust">Self</span><span class="z-punctuation z-definition z-generic z-end z-rust">></span></span>, <span class="z-variable z-parameter z-rust">world</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&</span><span class="z-storage z-modifier z-rust">mut</span> World, <span class="z-variable z-parameter z-rust">entity</span><span class="z-punctuation z-separator z-rust">:</span> Entity</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">        <span class="z-storage z-modifier z-rust">unsafe</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> `a` is read, but `b` will be dropped in place without being copied to the stack
</span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-support z-macro z-rust">deconstruct_moving_ptr!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">                <span class="z-storage z-type z-rust">let</span> MySpawnableList <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> a<span class="z-punctuation z-separator z-rust">,</span> b<span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">_</span> </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> this<span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-group z-rust"><span class="z-meta z-block z-rust">            </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            <span class="z-storage z-type z-rust">let</span> a <span class="z-keyword z-operator z-assignment z-rust">=</span> a<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">read</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">            world<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">spawn</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-path z-rust">R<span class="z-punctuation z-accessor z-rust">::</span></span>from<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>entity</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> a</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-meta z-block z-rust">        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre><h3 id=changes-to-bevy-tasks-feature-flags>Changes to <code>bevy_tasks</code> feature flags <a class=anchor-link href=#changes-to-bevy-tasks-feature-flags>#</a></h3><div class=heading-meta><div><span class=heading-meta__title>PRs:</span><a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/19019>#19019</a>, <a class=heading-meta__item href=https://github.com/bevyengine/bevy/pull/20369>#20369</a></div></div><p>Various feature flags in <code>bevy_tasks</code> have been simplified, thanks to the addition of <code>bevy_platform::cfg</code>:<ul><li>Removed <code>critical-section</code> feature (it was just a re-export of bevy_platform anyway)<li>Removed <code>std</code> and <code>web</code> features, relying on <code>bevy_platform::cfg</code> to check for availability.<li>Added <code>futures-lite</code> feature to provide access to the <code>block_on</code> implementation from <code>futures-lite</code>.<li>Added a fallback implementation of <code>block_on</code> that just busy-waits.<li>Moved <code>wasm-bindgen</code> related dependencies out of <code>bevy_tasks</code> and moved them into <code>bevy_platform</code> under a new exports module.<li>Made <code>async-io</code> implicit feature explicit.</ul><p>Any <code>std</code>, <code>web</code> or <code>critical-section</code> feature flags that you've enabled for <code>bevy_tasks</code> in your project can simply be removed.<p>If you need access to <code>wasm-bindgen</code> functionality that was previously in <code>bevy_tasks</code>, you can find them in <code>bevy_platform</code>. However, note that the re-exports of various web-related crates (<code>js_sys</code>, <code>wasm_bindgen</code> and <code>wasm_bindgen_futures</code>) are not intended for external consumption. Instead, pull your own dependencies to these crates, making sure the version used matches to ensure interoperability.</div><div class="docs-footer print:hidden"><nav class=docs-footer__nav><a class="docs-footer__link docs-footer__link--next" data-docs-nav-next href=/learn/migration-guides/0-15-to-0-16/> <div class=docs-footer__label><div class=docs-footer__dir>Next</div> 0.15 to 0.16</div> <i class="docs-footer__chevron icon icon--chevron-right"></i> </a><a class="docs-footer__link docs-footer__link--prev" data-docs-nav-previous href=/learn/migration-guides/0-17-to-0-18/> <div class=docs-footer__label><div class=docs-footer__dir>Previous</div> 0.17 to 0.18</div> <i class="docs-footer__chevron icon icon--chevron-left"></i> </a></nav><div class=docs-footer__edit-wrapper><a class=docs-footer__edit href=https://github.com/bevyengine/bevy-website/edit/main/content/learn/migration-guides/0.16-to-0.17.md> <i class="icon icon--pencil"></i> Improve this page </a><a href="https://github.com/bevyengine/bevy-website/issues/new?template=docs.md&title=Issue%20on%20page%200.16%20to%200.17" class=docs-footer__edit> <i class="icon icon--github"></i> Report issue </a></div></div></div></div></div></div></div></main><footer class=print:hidden><div class=footer__social-container><a class=footer__social href=https://github.com/bevyengine/bevy title=GitHub> <img alt="GitHub logo" height=24 src=/assets/github-mark-white.svg width=24> </a><a class=footer__social href=https://discord.gg/bevy title=Discord> <img alt="Discord logo" height=24 src=/assets/discord.svg width=24> </a><a class=footer__social href=https://bsky.app/profile/bevy.org title=Bluesky> <img alt="Bluesky logo" height=24 src=/assets/bluesky.svg width=24> </a><a class=footer__social href=https://mastodon.social/@bevy title=Mastodon> <img alt="Mastodon logo" height=24 src=/assets/mastodon-logo-purple.svg width=24> </a><a class=footer__social href=https://www.reddit.com/r/bevy/ title=Reddit> <img alt="Reddit logo" height=24 src=/assets/reddit.svg width=24> </a><a class=footer__social href=https://itch.io/games/tag-bevy title=itch.io> <img alt="itch.io logo" height=24 src=/assets/itchio-textless.svg width=24> </a><a title="Bevy news feed" class=footer__social href=/atom.xml> <img alt="Bevy news feed" height=24 src=/assets/feed.svg width=24> </a></div></footer></div><script>const search_params=new URLSearchParams(window.location.search);if(search_params.has(`show_drafts`)||document.cookie.indexOf(`show_drafts`)>=0){let a=`show_drafts`;if(search_params.get(a)===`0`){document.cookie=`show_drafts=;path=/;expires=Thu, 01 Jan 1970 00:00:00 UTC`}else{document.cookie=`show_drafts=1;path=/`;document.body.classList.add(a)}}</script>